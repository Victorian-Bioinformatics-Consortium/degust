(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){require("./lib/bootstrap-tour.js");require("./lib/numeric-1.2.6.js");require("./slider.coffee");require("./gene_table.coffee");require("./parcoords.coffee");require("./ma_plot.coffee");require("./heatmap.coffee");require("./pca.coffee");require("./kegg.coffee");require("./tour.coffee");require("./edit-list.coffee");require("./compare.coffee")},{"./compare.coffee":2,"./edit-list.coffee":3,"./gene_table.coffee":4,"./heatmap.coffee":5,"./kegg.coffee":6,"./lib/bootstrap-tour.js":7,"./lib/numeric-1.2.6.js":8,"./ma_plot.coffee":9,"./parcoords.coffee":10,"./pca.coffee":11,"./slider.coffee":12,"./tour.coffee":13}],2:[function(require,module,exports){var BackendCommon,WithBackendAnalysis,WithBackendNoAnalysis,WithoutBackend,activate_ma_plot,activate_parcoords,activate_pca_plot,blue_to_brown,calc_kegg_colours,calc_max_parcoords_width,colour_by_ec,colour_by_pval,colour_cat20,comparer,do_sort,done_loading,expr_filter,expr_plot,fcThreshold,fc_div,fdrThreshold,g_backend,g_data,g_tour_setup,gene_table,gene_table_dblclick,gene_table_filter,gene_table_mouseout,gene_table_mouseover,get_default_plot_typ,guess_link,guess_link_info,h_runfilters,heatmap,html_escape,init,init_charts,init_download_link,init_page,init_search,init_slider,kegg,kegg_filter,kegg_mouseover,kegg_selected,ma_plot,may_set_plot_var,numGenesSlider,numGenesThreshold,num_loading,parcoords,pcaDimension,pcaDimsSlider,pca_plot,process_dge_data,process_kegg_data,redraw_plot,render_fail_page,render_main_page,render_page,requested_kegg,searchStr,set_gene_table,show_counts,show_r_code,skipGenesSlider,skipGenesThreshold,start_loading,update_data,update_flags,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};num_loading=0;start_loading=function(){num_loading+=1;$("#loading").show();return $("#dge-pc,#dge-ma,#dge-pca").css("opacity",.4)};done_loading=function(){num_loading-=1;if(num_loading===0){$("#loading").hide();return $("#dge-pc,#dge-ma,#dge-pca").css("opacity",1)}};html_escape=function(str){return $("<div/>").text(str).html()};WithoutBackend=function(){function WithoutBackend(settings,process_dge_data){this.settings=settings;this.process_dge_data=process_dge_data;$(".conditions").hide();$(".config").hide();$("a.show-r-code").hide()}WithoutBackend.prototype.request_init_data=function(){var _this=this;start_loading();if(this.settings.csv_data){log_info("Using embedded csv");return this._data_ready(this.settings.csv_data)}else{return d3.text(this.settings.csv_file,"text/csv",function(err,dat){log_info("Downloaded csv");log_debug("Downloaded csv",dat,err);if(err){log_error(err);return}return _this._data_ready(dat)})}};WithoutBackend.prototype._data_ready=function(dat){var data;if(this.settings.csv_format){data=d3.csv.parse(dat)}else{data=d3.tsv.parse(dat)}this.process_dge_data(data,this.settings.columns);return done_loading()};WithoutBackend.prototype.request_kegg_data=function(callback){return log_error("Get KEGG data not supported without backend")};return WithoutBackend}();BackendCommon=function(){BackendCommon.config_url=function(){return"config.html?code="+window.my_code};BackendCommon.script=function(params){return"r-json.cgi?code="+window.my_code+(params?"&"+params:"")};function BackendCommon(settings,configured){this.settings=settings;if(!configured){window.location=BackendCommon.config_url()}if(this.settings["locked"]){$("a.config").hide()}else{$("a.config").removeClass("hide");$("a.config").attr("href",BackendCommon.config_url())}}BackendCommon.prototype.request_kegg_data=function(callback){return d3.tsv(BackendCommon.script("query=kegg_titles"),function(err,ec_data){log_info("Downloaded kegg : rows="+ec_data.length);log_debug("Downloaded kegg : rows="+ec_data.length,ec_data,err);return callback(ec_data)})};return BackendCommon}();WithBackendNoAnalysis=function(){function WithBackendNoAnalysis(settings,process_dge_data){this.settings=settings;this.process_dge_data=process_dge_data;this.backend=new BackendCommon(this.settings,this.settings.fc_columns.length>0);$(".conditions").hide();$("a.show-r-code").hide()}WithBackendNoAnalysis.prototype.request_kegg_data=function(callback){return this.backend.request_kegg_data(callback)};WithBackendNoAnalysis.prototype.request_init_data=function(){var req,_this=this;req=BackendCommon.script("query=csv");start_loading();return d3.text(req,function(err,dat){var data,data_cols;log_info("Downloaded DGE CSV: len="+dat.length);done_loading();if(err){log_error(err);return}if(_this.settings.csv_format){data=d3.csv.parse(dat)}else{data=d3.tsv.parse(dat)}log_info("Parsed DGE CSV : rows="+data.length);log_debug("Parsed DGE CSV : rows="+data.length,data,err);data_cols=_this.settings.info_columns.map(function(n){return{idx:n,name:n,type:"info"}});data_cols.push({idx:"_dummy",type:"primary",name:_this.settings.primary_name});_this.settings.fc_columns.forEach(function(n){return data_cols.push({idx:n,type:"fc",name:n})});data_cols.push({idx:_this.settings.fdr_column,name:_this.settings.fdr_column,type:"fdr"});data_cols.push({idx:_this.settings.avg_column,name:_this.settings.avg_column,type:"avg"});if(_this.settings.ec_column!=null){data_cols.push({idx:_this.settings.ec_column,name:"EC",type:"ec"})}if(_this.settings.link_column!=null){data_cols.push({idx:_this.settings.link_column,name:"link",type:"link"})}return _this.process_dge_data(data,data_cols)})};return WithBackendNoAnalysis}();WithBackendAnalysis=function(){function WithBackendAnalysis(settings,process_dge_data){var _this=this;this.settings=settings;this.process_dge_data=process_dge_data;this.backend=new BackendCommon(this.settings,this.settings.replicates.length>0);$(".conditions").show();$("a.show-r-code").show();$("select#dge-method").click(function(e){return _this._select_sample()})}WithBackendAnalysis.prototype.request_kegg_data=function(callback){return this.backend.request_kegg_data(callback)};WithBackendAnalysis.prototype.request_init_data=function(){return this._init_condition_selector()};WithBackendAnalysis.prototype._request_dge_data=function(){var columns,method,req,_this=this;columns=this.current_selection;if(columns.length<=1){return}method=this._get_dge_method();req=BackendCommon.script("query=dge&method="+method+"&fields="+encodeURIComponent(JSON.stringify(columns)));start_loading();return d3.csv(req,function(err,data){var data_cols,pri;log_info("Downloaded DGE counts : rows="+data.length);log_debug("Downloaded DGE counts : rows="+data.length,data,err);done_loading();if(err){log_error(err);return}data_cols=_this.settings.info_columns.map(function(n){return{idx:n,name:n,type:"info"}});pri=true;columns.forEach(function(n){var typ;typ=pri?"primary":"fc";data_cols.push({idx:n,type:typ,name:n});return pri=false});data_cols.push({idx:"adj.P.Val",name:"FDR",type:"fdr"});data_cols.push({idx:"AveExpr",name:"AveExpr",type:"avg"});if(_this.settings.ec_column!=null){data_cols.push({idx:_this.settings.ec_column,name:"EC",type:"ec"})}if(_this.settings.link_column!=null){data_cols.push({idx:_this.settings.link_column,name:"link",type:"link"})}_this.settings.replicates.forEach(function(_arg){var name,reps;name=_arg[0],reps=_arg[1];return reps.forEach(function(rep){return data_cols.push({idx:rep,name:rep,type:"count",parent:name})})});return _this.process_dge_data(data,data_cols)})};WithBackendAnalysis.prototype.request_r_code=function(callback){var columns,method,req;columns=this.current_selection;method=this._get_dge_method();req=BackendCommon.script("query=dge_r_code&method="+method+"&fields="+encodeURIComponent(JSON.stringify(columns)));return d3.text(req,function(err,data){log_debug("Downloaded R Code : len="+data.length,data,err);return callback(data)})};WithBackendAnalysis.prototype._get_dge_method=function(){return $("select#dge-method option:selected").val()};WithBackendAnalysis.prototype._set_dge_method=function(method){return $("select#dge-method").val(method)};WithBackendAnalysis.prototype._select_sample=function(e){var current_dge_method,_this=this;current_dge_method=this._get_dge_method();return new EditList({elem:".conditions",apply:function(){return _this._update_samples()},cancel:function(){_this._set_selected_cols(_this.current_selection);return _this._set_dge_method(current_dge_method)}})};WithBackendAnalysis.prototype._update_selected_cols=function(){var cols,_this=this;cols=[];$("#files input:checked").each(function(i,n){var name;name=$(n).data("rep");return cols.push(name)});return this.current_selection=cols};WithBackendAnalysis.prototype._set_selected_cols=function(cols){var _this=this;return $("#files input:checkbox").each(function(i,n){var name;name=$(n).data("rep");return $(n).prop("checked",__indexOf.call(cols,name)>=0)})};WithBackendAnalysis.prototype._update_samples=function(){this._update_selected_cols();return this._request_dge_data()};WithBackendAnalysis.prototype._init_condition_selector=function(){var init_select,_this=this;init_select=this.settings["init_select"]||[];$.each(this.settings.replicates,function(i,rep){var div,name;name=rep[0];div=$("<label>\n <input type='checkbox' title='Select this condition' data-placement='right'> "+name+"\n</label>");$("#files").append(div);return $("input",div).data("rep",name)});$("#files input").change(function(e){return _this._select_sample(e)});this._set_selected_cols(init_select);return this._update_samples()};return WithBackendAnalysis}();blue_to_brown=d3.scale.linear().domain([0,.05,1]).range(["brown","steelblue","steelblue"]).interpolate(d3.interpolateLab);colour_cat20=d3.scale.category20().domain([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]);colour_by_ec=function(ec_col){return function(row){return colour_cat20(row[ec_col])}};colour_by_pval=function(col){return function(d){return blue_to_brown(d[col])}};parcoords=null;ma_plot=null;pca_plot=null;expr_plot=null;gene_table=null;kegg=null;heatmap=null;g_data=null;g_backend=null;requested_kegg=false;show_counts="no";fdrThreshold=1;fcThreshold=0;numGenesThreshold=50;numGenesSlider=null;skipGenesThreshold=50;skipGenesSlider=null;pcaDimension=1;pcaDimsSlider=null;searchStr="";kegg_filter=[];h_runfilters=null;g_tour_setup=false;kegg_mouseover=function(obj){var ec,ec_col,row,rows,_i,_len,_ref;ec=obj.id;rows=[];ec_col=g_data.column_by_type("ec");if(ec_col===null){return}_ref=g_data.get_data();for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];if(row[ec_col]===ec){rows.push(row)}}return expr_plot.highlight(rows)};gene_table_mouseover=function(item){var ec_col;expr_plot.highlight([item]);ec_col=g_data.column_by_type("ec");return kegg.highlight(item[ec_col])};gene_table_mouseout=function(){expr_plot.unhighlight();$("#gene-info").html("");return kegg.unhighlight()};guess_link_info=[{re:/^ENS/,link:"http://ensembl.org/Multi/Search/Results?q=%s;site=ensembl"},{re:/^CG/,link:"http://flybase.org/cgi-bin/uniq.html?species=Dmel&cs=yes&db=fbgn&caller=genejump&context=%s"},{re:/^/,link:"http://www.ncbi.nlm.nih.gov/gene/?&term=%s"}];guess_link=function(info){var o,_i,_len;if(info==null){return}for(_i=0,_len=guess_link_info.length;_i<_len;_i++){o=guess_link_info[_i];if(info.match(o.re)){return o.link}}return null};gene_table_dblclick=function(item){var cols,info,link;cols=g_data.columns_by_type(["link"]);if(cols.length===0){cols=g_data.columns_by_type(["info"])}if(cols.length>0){info=item[cols[0].idx];link=settings.link_url!=null?settings.link_url:guess_link(info);log_debug("Dbl click.  Using info/link",info,link);if(link!=null){link=link.replace(/%s/,info);window.open(link);return window.focus()}}};get_default_plot_typ=function(){if(g_data.columns_by_type(["fc","primary"]).length>2){return"parcoords"}else{return"ma"}};may_set_plot_var=function(typ){if(typ===get_default_plot_typ()){return set_hash_var({plot:null})}else{return set_hash_var({plot:typ})}};activate_parcoords=function(){may_set_plot_var("parcoords");expr_plot=parcoords;$("#dge-ma,#dge-pca").hide();$("#dge-pc").show();$("#select-pc").addClass("active");$("#select-ma,#select-pca").removeClass("active");$(".ma-fc-col-opt").hide();$(".pca-opts").hide();heatmap.enabled(true);return update_data()};activate_ma_plot=function(){may_set_plot_var("ma");expr_plot=ma_plot;$("#dge-pc,#dge-pca").hide();$("#dge-ma").show();$("#select-ma").addClass("active");$("#select-pc,#select-pca").removeClass("active");$(".ma-fc-col-opt").show();$(".pca-opts").hide();heatmap.enabled(true);return update_data()};activate_pca_plot=function(){may_set_plot_var("mds");expr_plot=pca_plot;$("#dge-pc,#dge-ma").hide();$("#dge-pca").show();$("#select-pca").addClass("active");$("#select-pc,#select-ma").removeClass("active");$(".ma-fc-col-opt").hide();heatmap.enabled(false);$(".pca-opts").show();numGenesSlider.set_max(100,1,g_data.get_data().length,true);skipGenesSlider.set_max(0,0,g_data.get_data().length,true);return update_data()};calc_max_parcoords_width=function(){var w;w=$(".container").width();if($(".conditions").is(":visible")){w-=$(".conditions").outerWidth(true)}if($("div.filter").is(":visible")){return w-=$("div.filter").outerWidth(true)}};init_charts=function(){var _this=this;gene_table=new GeneTable({elem:"#grid",elem_info:"#grid-info",sorter:do_sort,mouseover:gene_table_mouseover,mouseout:gene_table_mouseout,dblclick:gene_table_dblclick,filter:gene_table_filter});parcoords=new ParCoords({elem:"#dge-pc",width:calc_max_parcoords_width(),filter:expr_filter});ma_plot=new MAPlot({elem:"#dge-ma",filter:expr_filter});pca_plot=new GenePCA({elem:"#dge-pca",filter:expr_filter,gene_table:gene_table,sel_dimension:function(d){return pcaDimsSlider.set_val(+d,true)},params:function(){return{skip:+skipGenesThreshold,num:+numGenesThreshold,dims:[+pcaDimension,+pcaDimension+1]}}});kegg=new Kegg({elem:"div#kegg-image",mouseover:kegg_mouseover,mouseout:function(){return expr_plot.unhighlight()}});parcoords.on("brush",function(d){gene_table.set_data(d);return heatmap.schedule_update(d)});ma_plot.on("brush",function(d){gene_table.set_data(d);return heatmap.schedule_update(d)});return heatmap=new Heatmap({elem:"#heatmap",width:$(".container").width(),mouseover:function(d){var col,msg,_i,_len,_ref;expr_plot.highlight([d]);msg="";_ref=g_data.columns_by_type(["info"]);for(_i=0,_len=_ref.length;_i<_len;_i++){col=_ref[_i];msg+="<span class='lbl'>"+col.name+": </span><span>"+d[col.idx]+"</span>"}return $("#heatmap-info").html(msg)},mouseout:function(d){expr_plot.unhighlight();return $("#heatmap-info").html("")}})};comparer=function(x,y){if(x===y){return 0}else{if(x>y){return 1}else{return-1}}};do_sort=function(args){var column;column=g_data.column_by_idx(args.sortCol.field);return gene_table.sort(function(r1,r2){var r,x,y,_ref,_ref1;r=0;x=r1[column.idx];y=r2[column.idx];if((_ref=column.type)==="fc_calc"){r=comparer(Math.abs(x),Math.abs(y))}else if((_ref1=column.type)==="fdr"){r=comparer(x,y)}else{r=comparer(x,y)}return r*(args.sortAsc?1:-1)})};set_gene_table=function(data){var column_keys,columns;column_keys=g_data.columns_by_type(["info","fdr"]);column_keys=column_keys.concat(g_data.columns_by_type("fc_calc"));columns=column_keys.map(function(col){return{id:col.idx,name:col.name,field:col.idx,sortable:true,formatter:function(i,c,val,m,row){var _ref,_ref1;if((_ref=col.type)==="fc_calc"){return fc_div(val,col,row)}else if((_ref1=col.type)==="fdr"){if(val<.01){return val.toExponential(2)}else{return val.toFixed(2)}}else{return val}}}});return gene_table.set_data(data,columns)};fc_div=function(n,column,row){var colour,countStr,count_columns,vals;colour=n>.1?"pos":n<-.1?"neg":"";countStr="";if(show_counts==="yes"){count_columns=g_data.assoc_column_by_type("count",column.name);vals=count_columns.map(function(c){return row[c.idx]});countStr="<span class='counts'>("+vals+")</span>"}else if(show_counts==="cpm"){count_columns=g_data.assoc_column_by_type("count",column.name);vals=count_columns.map(function(c){var tot;tot=g_data.get_total(c);return(1e6*row[c.idx]/tot).toFixed(1)});countStr="<span class='counts'>("+vals+")</span>"}return"<div class='"+colour+"'>"+n.toFixed(2)+countStr+"</div>"};gene_table_filter=function(item){var col,str,_i,_len,_ref;if(searchStr===""){return true}_ref=g_data.columns_by_type("info");for(_i=0,_len=_ref.length;_i<_len;_i++){col=_ref[_i];str=item[col.idx];if(str!=null&&typeof str==="string"&&str.toLowerCase().indexOf(searchStr)>=0){return true}}return false};expr_filter=function(row){var ec_col,extent_fc,fc,pval_col,_ref;if(fcThreshold>0){fc=g_data.columns_by_type("fc").map(function(c){return row[c.idx]});extent_fc=d3.extent(fc.concat([0]));if(Math.abs(extent_fc[0]-extent_fc[1])<fcThreshold){return false}}pval_col=g_data.columns_by_type("fdr")[0];if(row[pval_col.idx]>fdrThreshold){return false}if(kegg_filter.length>0){ec_col=g_data.column_by_type("ec");return _ref=row[ec_col],__indexOf.call(kegg_filter,_ref)>=0}return true};init_search=function(){return $(".tab-search input").keyup(function(e){Slick.GlobalEditorLock.cancelCurrentEdit();if(e.which===27){this.value=""}searchStr=this.value.toLowerCase();$(this).toggleClass("active",searchStr!=="");return gene_table.refresh()})};init_download_link=function(){return $("a#csv-download").on("click",function(e){var cols,items,keys,rows;e.preventDefault();items=gene_table.get_data();if(items.length===0){return}cols=g_data.columns_by_type(["info","fc_calc","count","fdr"]);keys=cols.map(function(c){return c.name});rows=items.map(function(r){return cols.map(function(c){return r[c.idx]})});return window.open("data:text/csv,"+escape(d3.csv.format([keys].concat(rows))),"file.csv")})};redraw_plot=function(){return expr_plot.brush()};init_slider=function(){var fcSlider,fdrSlider,x;fdrSlider=new Slider({id:"#fdrSlider",input_id:"input.fdr-fld",step_values:[0,1e-6,1e-5,1e-4,.001,.01,.02,.03,.04,.05,.1,1],val:fdrThreshold,validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0||n>1)},on_change:function(v){Slick.GlobalEditorLock.cancelCurrentEdit();if(fdrThreshold!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return fdrThreshold=v}}});$(".shortcut-fdr a").click(function(){return fdrSlider.set_val($(this).data("val"),true)});fcSlider=new Slider({id:"#fcSlider",input_id:"input.fc-fld",step_values:function(){var _i,_results;_results=[];for(x=_i=0;_i<=5;x=_i+=.01){_results.push(Number(x.toFixed(2)))}return _results}(),val:fcThreshold,validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0)},on_change:function(v){Slick.GlobalEditorLock.cancelCurrentEdit();if(fcThreshold!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return fcThreshold=v}}});$(".shortcut-fc a").click(function(){return fcSlider.set_val($(this).data("val"),true)});numGenesSlider=new Slider({id:"#numGenesSlider",input_id:"input.num-genes-fld",val:numGenesThreshold,validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0)},on_change:function(v){Slick.GlobalEditorLock.cancelCurrentEdit();if(numGenesThreshold!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return numGenesThreshold=v}}});skipGenesSlider=new Slider({id:"#skipGenesSlider",input_id:"input.skip-genes-fld",val:skipGenesThreshold,validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0)},on_change:function(v){Slick.GlobalEditorLock.cancelCurrentEdit();if(skipGenesThreshold!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return skipGenesThreshold=v}}});pcaDimsSlider=new Slider({id:"#pcaDimsSlider",input_id:"input.pca-dims-fld",step_values:[1,2,3,4,5,6,7,8,9,10],val:pcaDimension,fmt:function(v){return v+" vs "+(v+1)},validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0)},on_change:function(v){if(pcaDimension!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return pcaDimension=v}}});$("#fc-relative").change(function(e){return update_data()});$("#ma-fc-col").change(function(e){return update_data()});return $("#show-counts").change(function(e){update_flags();return gene_table.invalidate()})};calc_kegg_colours=function(){var col,dir,ec,ec_col,ec_dirs,fc_cols,row,v,_i,_j,_len,_len1,_ref;ec_dirs={};ec_col=g_data.column_by_type("ec");if(ec_col===null){return}fc_cols=g_data.columns_by_type("fc_calc").slice(1);_ref=g_data.get_data();for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];ec=row[ec_col];if(!ec){continue}for(_j=0,_len1=fc_cols.length;_j<_len1;_j++){col=fc_cols[_j];v=row[col.idx];dir=v>.1?"up":v<-.1?"down":"same";if(!ec_dirs[ec]){ec_dirs[ec]=dir}if(ec_dirs[ec]!==dir){ec_dirs[ec]="mixed"}}}return ec_dirs};kegg_selected=function(){var code,ec_colours,set_filter,title;code=$("select#kegg option:selected").val();title=$("select#kegg option:selected").text();set_filter=function(ec){kegg_filter=ec;return update_data()};if(!code){return set_filter([])}else{ec_colours=calc_kegg_colours();kegg.load(code,ec_colours,set_filter);return $("div#kegg-image").dialog({width:500,height:600,title:title,position:{my:"right top",at:"right top+60",of:$("body")}})}};process_kegg_data=function(ec_data){var ec_col,have_ec,opts,row,_i,_len,_ref;if(requested_kegg){return}requested_kegg=true;opts="<option value=''>--- No pathway selected ---</option>";have_ec={};ec_col=g_data.column_by_type("ec");_ref=g_data.get_data();for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];have_ec[row[ec_col]]=1}ec_data.forEach(function(row){var ec,num,_j,_len1,_ref1;num=0;_ref1=row.ec.split(" ").filter(function(s){return s.length>0});for(_j=0,_len1=_ref1.length;_j<_len1;_j++){ec=_ref1[_j];if(have_ec[ec]){num++}}if(num>0){return opts+="<option value='"+row.code+"'>"+row.title+" ("+num+")</option>"}});$("select#kegg").html(opts);return $(".kegg-filter").show()};process_dge_data=function(data,columns){var col,i,opts,set_plot,_i,_j,_len,_len1,_ref,_ref1;g_data=new GeneData(data,columns);opts="";_ref=g_data.columns_by_type(["fc","primary"]);for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){col=_ref[i];opts+="<option value='"+i+"'>"+html_escape(col.name)+"</option>"}opts+="<option value='-1'>Average</option>";$("select#fc-relative").html(opts);opts="";_ref1=g_data.columns_by_type(["fc","primary"]);for(i=_j=0,_len1=_ref1.length;_j<_len1;i=++_j){col=_ref1[i];opts+="<option value='"+i+"' "+(i===1?"selected":"")+">"+html_escape(col.name)+"</option>"}$("select#ma-fc-col").html(opts);if(g_data.column_by_type("ec")===null){$(".kegg-filter").hide()}else if(!requested_kegg){g_backend.request_kegg_data(process_kegg_data)}if(g_data.columns_by_type("count").length===0){$(".show-counts-opt").hide();$("#select-pca").hide()}else{$(".show-counts-opt").show();$("#select-pca").show()}set_plot=function(typ){switch(typ){case"mds":activate_pca_plot();return true;case"ma":activate_ma_plot();return true;case"parcoords":activate_parcoords();return true;default:return false}};set_plot(get_hash_vars()["plot"])||set_plot(get_default_plot_typ());if(!g_tour_setup){g_tour_setup=true;return setup_tour(settings.show_tour!=null?settings.show_tour:true)}};update_flags=function(){return show_counts=$("select#show-counts option:selected").val()};update_data=function(){var col,color,cols,count_cols,dims,ec_col,extent,fc_relative,heatmap_dims,heatmap_extent,ma_fc,pval_col;update_flags();fc_relative=$("select#fc-relative option:selected").val();if(fc_relative<0){fc_relative="avg"}else{fc_relative=g_data.columns_by_type(["fc","primary"])[fc_relative]}g_data.set_relative(fc_relative);dims=g_data.columns_by_type("fc_calc");ec_col=g_data.column_by_type("ec");pval_col=g_data.column_by_type("fdr");color=colour_by_pval(pval_col);extent=ParCoords.calc_extent(g_data.get_data(),dims);if(expr_plot===parcoords){parcoords.update_data(g_data.get_data(),dims,extent,color)}else if(expr_plot===ma_plot){ma_fc=$("select#ma-fc-col option:selected").val();ma_fc=g_data.columns_by_type(["fc","primary"])[ma_fc].name;col=g_data.columns_by_type("fc_calc").filter(function(c){return c.name===ma_fc});if(col.length!==1){log_error("Can't find proper column for MA-plot")}ma_plot.update_data(g_data.get_data(),col,g_data.columns_by_type("avg"),color,g_data.columns_by_type("info"),pval_col)}else if(expr_plot===pca_plot){cols=g_data.columns_by_type("fc_calc").map(function(c){return c.name});count_cols=g_data.columns_by_type("count").filter(function(c){return cols.indexOf(c.parent)>=0});pca_plot.update_data(g_data.get_data(),count_cols)}set_gene_table(g_data.get_data());if(heatmap.enabled()){heatmap_dims=g_data.columns_by_type("fc_calc_avg");heatmap_extent=ParCoords.calc_extent(g_data.get_data(),heatmap_dims);heatmap.update_columns(heatmap_dims,heatmap_extent,pval_col);heatmap.schedule_update(g_data.get_data())}return expr_plot.brush()};show_r_code=function(){return g_backend.request_r_code(function(d){$("div#code-modal .modal-body pre").text(d);return $("div#code-modal").modal()})};render_page=function(template){var body,opts;opts={asset_base:settings.asset_base||"",home_link:settings.home_link||"index.html"};body=$(template(opts));$("#replace-me").replaceWith(body);$("#main-loading").hide();setup_nav_bar();return $("[title]").tooltip()};render_main_page=function(){return render_page(require("../templates/compare-body.hbs"))};render_fail_page=function(){return render_page(require("../templates/fail.hbs"))};init_page=function(use_backend){var title;render_main_page();g_data=new GeneData([],[]);if(use_backend){if(settings.analyze_server_side){g_backend=new WithBackendAnalysis(settings,process_dge_data)}else{g_backend=new WithBackendNoAnalysis(settings,process_dge_data)}}else{g_backend=new WithoutBackend(settings,process_dge_data)}title=settings.name||"Unnamed";$(".exp-name").text(title);document.title=title;if(settings["fdrThreshold"]!==void 0){fdrThreshold=settings["fdrThreshold"]}if(settings["fcThreshold"]!==void 0){fcThreshold=settings["fcThreshold"]}$("select#kegg").change(kegg_selected);$("#select-pc a").click(function(e){e.preventDefault();return activate_parcoords()});$("#select-ma a").click(function(e){e.preventDefault();return activate_ma_plot()});$("#select-pca a").click(function(e){e.preventDefault();return activate_pca_plot()});$("a.show-r-code").click(function(e){e.preventDefault();return show_r_code()});init_charts();init_search();init_slider();init_download_link();return g_backend.request_init_data()};init=function(){var code;code=get_url_vars()["code"];if(code==null){return init_page(false)}else{window.my_code=code;return $.ajax({type:"GET",url:BackendCommon.script("query=settings"),dataType:"json"}).done(function(json){window.settings=json;return init_page(true)}).fail(function(x){var pre;log_error("Failed to get settings!",x);render_fail_page();pre=$("<pre></pre>");pre.text("Error failed to get settings : "+x.responseText);return $(".error-msg").append(pre)})}};$(document).ready(function(){return init()})},{"../templates/compare-body.hbs":14,"../templates/fail.hbs":15}],3:[function(require,module,exports){var EditList;EditList=function(){function EditList(opts){this.opts=opts;this.elem=$(this.opts.elem);if(this.elem.data("edit")){return}this._enable()}EditList.prototype._enable=function(){var apply_btn,cancel_btn,offset,_this=this;this.elem.data("edit",true);this.elem.addClass("edit-elem");cancel_btn=$("<button class='btn btn-default btn-sm'>Cancel</button>");apply_btn=$("<button class='btn btn-primary btn-sm'>Apply</button>");this.buttons=$('<div class="edit-btns">');this.buttons.append(cancel_btn);this.buttons.append(apply_btn);this.elem.append(this.buttons);cancel_btn.click(function(){return _this._cancel()});apply_btn.click(function(){return _this._apply()});this.over=$('<div class="edit-overlay">');this.elem_back=$('<div class="edit-backdrop">');offset=this.elem.offset();offset.top=offset.top-4;offset.left=offset.left-4;this.elem_back.width(this.elem.innerWidth()+8).height(this.elem.innerHeight()+8).offset(offset);$("body").append(this.over);return $("body").append(this.elem_back)};EditList.prototype._cancel=function(){this._done();return this.opts.cancel()};EditList.prototype._apply=function(){this._done();return this.opts.apply()};EditList.prototype._done=function(){this.elem.data("edit",false);this.elem.removeClass("edit-elem");this.buttons.remove();this.over.remove();return this.elem_back.remove()};return EditList}();window.EditList=EditList},{}],4:[function(require,module,exports){var GeneTable;GeneTable=function(){function GeneTable(opts){var grid_options,_this=this;this.opts=opts;grid_options={enableCellNavigation:true,enableColumnReorder:false,multiColumnSort:false,forceFitColumns:true,enableTextSelectionOnCells:true};this.dataView=new Slick.Data.DataView;this.grid=new Slick.Grid(this.opts.elem,this.dataView,[],grid_options);if(this.opts.filter){this.dataView.setFilter(this.opts.filter)}this.dataView.onRowCountChanged.subscribe(function(e,args){_this.grid.updateRowCount();_this.grid.render();return _this._update_info()});this.dataView.onRowsChanged.subscribe(function(e,args){_this.grid.invalidateRows(args.rows);return _this.grid.render()});this.grid.onSort.subscribe(function(e,args){return _this.opts.sorter(args)});this.grid.onViewportChanged.subscribe(function(e,args){return _this._update_info()});if(this.opts.mouseover){this.grid.onMouseEnter.subscribe(function(e,args){var d,i;i=_this.grid.getCellFromEvent(e).row;d=_this.dataView.getItem(i);return _this.opts.mouseover(d)})}if(this.opts.mouseout){this.grid.onMouseLeave.subscribe(function(e,args){return _this.opts.mouseout()})}if(this.opts.dblclick){this.grid.onDblClick.subscribe(function(e,args){return _this.opts.dblclick(_this.grid.getDataItem(args.row))})}}GeneTable.prototype.sort=function(sorter){return this.dataView.sort(sorter)};GeneTable.prototype.get_data=function(){return this.dataView.getItems()};GeneTable.prototype.set_data=function(data,columns){var _this=this;if(columns){return scheduler.schedule_now("gene_table",function(){return _this.set_data_now(data,columns)})}else{return scheduler.schedule("gene_table",function(){return _this.set_data_now(data)})}};GeneTable.prototype.set_data_now=function(data,columns){this.dataView.beginUpdate();if(columns){this.grid.setColumns([])}this.dataView.setItems(data);this.dataView.reSort();this.dataView.endUpdate();if(columns){return this.grid.setColumns(columns)}};GeneTable.prototype.refresh=function(){return this.dataView.refresh()};GeneTable.prototype.invalidate=function(){return this.grid.invalidate()};GeneTable.prototype._update_info=function(){var btm,view;view=this.grid.getViewport();btm=d3.min([view.bottom,this.dataView.getLength()]);return $(this.opts.elem_info).html("Showing "+view.top+".."+btm+" of "+this.dataView.getLength())};return GeneTable}();window.GeneTable=GeneTable},{}],5:[function(require,module,exports){var Heatmap,calc_order;calc_order=function(e){var best_d,best_i,calc_extreme_point,columns,d,data,dist,i,message_after,order,order_ids,r,row,t1,used,_i,_ref,_ref1,_this=this;_ref=e.data,data=_ref[0],columns=_ref[1];t1=new Date;if(data==null){self.postMessage({error:"Data missing"});return}if(columns==null){self.postMessage({error:"Columns missing"});return}if(data!=null&&data.length===0){self.postMessage({done:[]});return}dist=function(r1,r2){var c,s,v,_i,_len;s=0;for(_i=0,_len=columns.length;_i<_len;_i++){c=columns[_i];v=r1[c.idx]-r2[c.idx];s+=v*v}return s};calc_extreme_point=function(){var centroid,d,i,k,max_d,max_i,tot,v,_i,_ref1,_this=this;centroid=[];tot=0;data.forEach(function(r){columns.map(function(c){var _name;centroid[_name=c.idx]||(centroid[_name]=0);return centroid[c.idx]+=r[c.idx]});return tot+=1});for(k in centroid){v=centroid[k];centroid[k]=v/tot}max_i=0;max_d=0;for(i=_i=0,_ref1=data.length-1;0<=_ref1?_i<=_ref1:_i>=_ref1;i=0<=_ref1?++_i:--_i){d=dist(centroid,data[i]);
if(d>max_d){max_d=d;max_i=i}}return max_i};used={};order=[calc_extreme_point()];used[order[0]]=true;message_after=0;while(order.length<data.length){if(message_after++>=50){message_after=0;postMessage({upto:order.length})}row=data[order[order.length-1]];best_i=best_d=null;for(i=_i=0,_ref1=data.length-1;0<=_ref1?_i<=_ref1:_i>=_ref1;i=0<=_ref1?++_i:--_i){if(used[i]){continue}r=data[i];d=dist(row,r);if(!best_d||d<best_d){best_d=d;best_i=i}}order.push(best_i);used[best_i]=true}order_ids=order.map(function(i){return data[i].id});return postMessage({done:order_ids,took:new Date-t1})};Heatmap=function(){function Heatmap(opts){var _base,_base1,_base2,_base3,_base4,_this=this;this.opts=opts;if((_base=this.opts).h_pad==null){_base.h_pad=20}if((_base1=this.opts).h==null){_base1.h=50}if((_base2=this.opts).width==null){_base2.width=1e3}if((_base3=this.opts).label_width==null){_base3.label_width=120}if((_base4=this.opts).limit==null){_base4.limit=this.opts.width-this.opts.label_width}this.svg=d3.select(this.opts.elem).append("svg");this.svg.append("g").attr("class","labels");this.svg.append("g").attr("class","genes").attr("transform","translate("+opts.label_width+",0)");this.svg.attr("width",this.opts.width).attr("height",100);this.info=this.svg.append("text").attr("class","info").attr("x",this.opts.width-200).attr("y",10);this.legend=d3.select(this.opts.elem).append("svg").attr("class","legend").attr("width",this.opts.width).attr("height",58);this.worker=new WorkerWrapper(calc_order,function(d){return _this._worker_callback(d)});this._enabled=true}Heatmap.prototype.enabled=function(enabled){if(enabled!=null){this._enabled=enabled;return $(this.opts.elem).toggle(enabled)}else{return this._enabled}};Heatmap.prototype._make_legend=function(){var axis,g,rects,sc,stepToVal,steps,v,vals,width,_this=this;this.legend.selectAll("*").remove();this.legend.append("text").attr("x",this.opts.width-110).attr("y",20).attr("text-anchor","end").text("Heatmap log-fold-change ");width=100;steps=width;stepToVal=d3.scale.linear().domain([0,steps-1]).range([-this.max,this.max]);vals=function(){var _i,_results;_results=[];for(v=_i=0;0<=steps?_i<steps:_i>steps;v=0<=steps?++_i:--_i){_results.push(v)}return _results}();g=this.legend.append("g").attr("transform","translate("+(this.opts.width-width)+",0)");rects=g.selectAll("rect").data(vals);rects.enter().append("rect").attr("x",function(v){return v*1*width/steps}).attr("height",30).attr("width",1*width/steps).style("fill",function(v){return _this.colorScale(stepToVal(v))});sc=d3.scale.linear().domain([-this.max,this.max]).range([0,width]);axis=d3.svg.axis().scale(sc).orient("bottom").tickSize(5);return g.append("g").attr("transform","translate(0, 30)").call(axis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-0.4em").attr("transform","rotate(-90)")};Heatmap.prototype.set_order=function(order){this.order=order};Heatmap.prototype._show_calc_info=function(str){return this.info.text(str)};Heatmap.prototype._worker_callback=function(d){if(d.error!=null){log_error("Worker error : "+d.error)}if(d.upto!=null){this._show_calc_info("Clustered "+d.upto+" of "+this.data.length)}if(d.done!=null){this.order=d.done;this._render_heatmap();this._show_calc_info("")}if(d.took!=null){return log_debug("calc_order: took="+d.took+"ms for "+this.data.length+" points")}};Heatmap.prototype._calc_order=function(){return this.worker.start([this.data,this.columns.map(function(c){return{idx:c.idx}})])};Heatmap.prototype._thinking=function(bool){return this.svg.select("g.genes").attr("opacity",bool?.4:1)};Heatmap.prototype.schedule_update=function(data){if(data){this.data=data}if(this.data==null||this.columns==null||!this._enabled){return}this._thinking(true);return this._calc_order()};Heatmap.prototype.update_columns=function(columns,extent,sel_column){var cols,_this=this;this.columns=columns;this.sel_column=sel_column;this.max=d3.max(extent.map(Math.abs));this.colorScale=d3.scale.linear().domain([-this.max,0,this.max]).range(["blue","white","red"]);cols=this.svg.select(".labels").selectAll(".label").data(this.columns);cols.enter().append("text").attr("class","label");cols.exit().remove();cols.attr("x",this.opts.label_width).attr("y",function(d,i){return i*_this.opts.h+_this.opts.h/2}).attr("text-anchor","end").text(function(d){return d.name});return this._make_legend()};Heatmap.prototype._render_heatmap=function(){var cells,d,genes,id,kept_data,num_kept,row_ids,sorted,w,_i,_j,_len,_len1,_ref,_ref1,_this=this;this._thinking(false);kept_data={};sorted=this.data.slice(0);sorted.sort(function(a,b){return a[_this.sel_column]-b[_this.sel_column]});_ref=sorted.slice(0,+(this.opts.limit-1)+1||9e9);for(_i=0,_len=_ref.length;_i<_len;_i++){d=_ref[_i];kept_data[d.id]=d}row_ids={};num_kept=0;_ref1=this.order||data.map(function(d){return d.id});for(_j=0,_len1=_ref1.length;_j<_len1;_j++){id=_ref1[_j];if(kept_data[id]){row_ids[id]=num_kept;num_kept+=1}}this.svg.attr("width",this.opts.width).attr("height",this.opts.h_pad+this.opts.h*this.columns.length);w=d3.min([this.opts.h,(this.opts.width-this.opts.label_width)/num_kept]);genes=this.svg.select(".genes").selectAll("g.gene").data(d3.values(kept_data));genes.enter().append("g").attr("class","gene");genes.exit().remove();cells=genes.selectAll(".cell").data(function(d){var c,i,res,_ref2;if(row_ids[d.id]==null){log_info("missing row_ids["+d.id+"]");return}res=[];_ref2=_this.columns;for(i in _ref2){c=_ref2[i];res.push({row:row_ids[d.id],col:i,score:d[c.idx],id:d.id})}return res},function(d){return d.col});cells.enter().append("rect").attr("class","cell");cells.attr("x",function(d){return d.row*w}).attr("y",function(d){return d.col*_this.opts.h}).attr("width",w).attr("height",this.opts.h).style("fill",function(d){return _this.colorScale(d.score)});cells.exit().remove();if(this.opts.mouseover){genes.on("mouseover",this.opts.mouseover)}if(this.opts.mouseout){return genes.on("mouseout",this.opts.mouseout)}};Heatmap.prototype._create_brush=function(w){var brush,gBrush,x,_this=this;x=d3.scale.identity().domain([0,this.opts.width-this.opts.label_width]);brush=d3.svg.brush().x(x).on("brushend",function(){var d,data,ex;ex=brush.extent();data=_this.svg.selectAll("rect.cell").data();return d=data.filter(function(d){return d.col==="0"&&ex[0]<=d.row*w&&ex[1]>=d.row*w})});this.svg.select("g.brush").remove();gBrush=this.svg.append("g").attr("class","brush").attr("transform","translate("+this.opts.label_width+",0)").call(brush);return gBrush.selectAll("rect").attr("height",100*this.opts.h_pad+this.opts.h*this.columns.length)};return Heatmap}();window.Heatmap=Heatmap},{}],6:[function(require,module,exports){var Kegg;Kegg=function(){function Kegg(opts){this.opts=opts;this.ec_visible={}}Kegg.prototype.load=function(code,ec_colours,ec_cb){var _this=this;this.ec_colours=ec_colours;this.img_x=void 0;this.kegg_data=void 0;this.img_url="kegg/pathway/map/map"+code+".gif";$(this.opts.elem).html("<div id='kegg-container'></div>");$("<img/>").attr("src",this.img_url).load(function(e){_this.img_x=e.target.width;_this.img_y=e.target.height;return _this.draw_ec()});return d3.xml("kegg/kgml/map/map"+code+".xml",function(data){return _this.xml_loaded(data,ec_cb)})};Kegg.prototype.xml_loaded=function(xml,ec_cb){var ec_codes;this.kegg_data=this.xml_to_list(xml);if(ec_cb){ec_codes=[];ec_codes=this.kegg_data.map(function(o){return o.id});if(ec_cb){ec_cb(ec_codes)}}return this.draw_ec()};Kegg.prototype.draw_ec=function(){var ec_boxes,_this=this;if(!this.kegg_data||!this.img_x){return}d3.select("div#kegg-container").html("");this.svg=d3.select("div#kegg-container").append("svg").attr("viewBox","1 1 "+this.img_x+" "+this.img_y).attr("width","100%").attr("height","100%");this.svg.append("image").attr("xlink:href",this.img_url).attr("width",this.img_x).attr("height",this.img_y);ec_boxes=this.svg.selectAll(".ec").data(this.kegg_data,function(o){return o.id});ec_boxes.enter().append("rect").attr("class","ec").attr("x",function(o){return o.x-o.width/2}).attr("y",function(o){return o.y-o.height/2}).attr("width",function(o){return o.width}).attr("height",function(o){return o.height}).attr("stroke","black").attr("fill-opacity",.3).attr("fill",function(o){return _this.colour(o.id)});ec_boxes.exit().remove();if(this.opts.mouseover){ec_boxes.on("mouseover",this.opts.mouseover)}if(this.opts.mouseout){return ec_boxes.on("mouseout",this.opts.mouseout)}};Kegg.prototype.rect=function(o){return g.append("rect")};Kegg.prototype.xml_to_list=function(xml){var list,_this=this;list=[];$("entry[type=enzyme] graphics[type=rectangle]",xml).each(function(i,e_){var e,k,o,_i,_len,_ref;e=$(e_);o={id:e.attr("name")};if(o.id in _this.ec_colours){_ref=["x","y","width","height"];for(_i=0,_len=_ref.length;_i<_len;_i++){k=_ref[_i];o[k]=e.attr(k)}return list.push(o)}});return list};Kegg.prototype.colour=function(ec){switch(this.ec_colours[ec]){case"same":return"green";case"mixed":return"yellow";case"up":return"red";case"down":return"blue";default:return"black"}};Kegg.prototype.highlight=function(ec){if(this.svg){return this.svg.selectAll(".ec").filter(function(o){return o.id===ec}).attr("stroke-width",5).attr("stroke","red")}};Kegg.prototype.unhighlight=function(){if(this.svg){return this.svg.selectAll(".ec").attr("stroke-width",1).attr("stroke","black")}};return Kegg}();window.Kegg=Kegg},{}],7:[function(require,module,exports){(function($,window){var Tour,document;document=window.document;Tour=function(){function Tour(options){this._options=$.extend({name:"tour",steps:[],container:"body",keyboard:true,storage:window.localStorage,debug:false,backdrop:false,redirect:true,orphan:false,duration:false,basePath:"",template:"<div class='popover'>          <div class='arrow'></div>          <h3 class='popover-title'></h3>          <div class='popover-content'></div>          <div class='popover-navigation'>            <div class='btn-group'>              <button class='btn btn-sm btn-default' data-role='prev'>&laquo; Prev</button>              <button class='btn btn-sm btn-default' data-role='next'>Next &raquo;</button>              <button class='btn btn-sm btn-default' data-role='pause-resume' data-pause-text='Pause' data-resume-text='Resume'>Pause</button>            </div>            <button class='btn btn-sm btn-default' data-role='end'>End tour</button>          </div>        </div>",afterSetState:function(key,value){},afterGetState:function(key,value){},afterRemoveState:function(key){},onStart:function(tour){},onEnd:function(tour){},onShow:function(tour){},onShown:function(tour){},onHide:function(tour){},onHidden:function(tour){},onNext:function(tour){},onPrev:function(tour){},onPause:function(tour,duration){},onResume:function(tour,duration){}},options);this._force=false;this._inited=false;this.backdrop={overlay:null,$element:null,$background:null,backgroundShown:false,overlayElementShown:false};this}Tour.prototype.addSteps=function(steps){var step,_i,_len;for(_i=0,_len=steps.length;_i<_len;_i++){step=steps[_i];this.addStep(step)}return this};Tour.prototype.addStep=function(step){this._options.steps.push(step);return this};Tour.prototype.getStep=function(i){if(this._options.steps[i]!=null){return $.extend({id:"step-"+i,path:"",placement:"right",title:"",content:"<p></p>",next:i===this._options.steps.length-1?-1:i+1,prev:i-1,animation:true,container:this._options.container,backdrop:this._options.backdrop,redirect:this._options.redirect,orphan:this._options.orphan,duration:this._options.duration,template:this._options.template,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,onPause:this._options.onPause,onResume:this._options.onResume},this._options.steps[i])}};Tour.prototype.init=function(force){var _this=this;this._force=force;if(this.ended()){this._debug("Tour ended, init prevented.");return this}this.setCurrentStep();this._initMouseNavigation();this._initKeyboardNavigation();this._onResize(function(){return _this.showStep(_this._current)});if(this._current!==null){this.showStep(this._current)}this._inited=true;return this};Tour.prototype.start=function(force){var promise;if(force==null){force=false}if(!this._inited){this.init(force)}if(this._current===null){promise=this._makePromise(this._options.onStart!=null?this._options.onStart(this):void 0);this._callOnPromiseDone(promise,this.showStep,0)}return this};Tour.prototype.next=function(){var promise;promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,this._showNextStep)};Tour.prototype.prev=function(){var promise;promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,this._showPrevStep)};Tour.prototype.goTo=function(i){var promise;promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,this.showStep,i)};Tour.prototype.end=function(){var endHelper,promise,_this=this;endHelper=function(e){$(document).off("click.tour-"+_this._options.name);$(document).off("keyup.tour-"+_this._options.name);$(window).off("resize.tour-"+_this._options.name);_this._setState("end","yes");_this._inited=false;_this._force=false;_this._clearTimer();if(_this._options.onEnd!=null){return _this._options.onEnd(_this)}};promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,endHelper)};Tour.prototype.ended=function(){return!this._force&&!!this._getState("end")};Tour.prototype.restart=function(){this._removeState("current_step");this._removeState("end");this.setCurrentStep(0);return this.start()};Tour.prototype.pause=function(){var step;step=this.getStep(this._current);if(!(step&&step.duration)){return this}this._paused=true;this._duration-=(new Date).getTime()-this._start;window.clearTimeout(this._timer);this._debug("Paused/Stopped step "+(this._current+1)+" timer ("+this._duration+" remaining).");if(step.onPause!=null){return step.onPause(this,this._duration)}};Tour.prototype.resume=function(){var step,_this=this;step=this.getStep(this._current);if(!(step&&step.duration)){return this}this._paused=false;this._start=(new Date).getTime();this._duration=this._duration||step.duration;this._timer=window.setTimeout(function(){if(_this._isLast()){return _this.next()}else{return _this.end()}},this._duration);this._debug("Started step "+(this._current+1)+" timer with duration "+this._duration);if(step.onResume!=null&&this._duration!==step.duration){return step.onResume(this,this._duration)}};Tour.prototype.hideStep=function(i){var hideStepHelper,promise,step,_this=this;step=this.getStep(i);if(!step){return}this._clearTimer();promise=this._makePromise(step.onHide!=null?step.onHide(this,i):void 0);hideStepHelper=function(e){var $element;$element=$(step.element);if(!($element.data("bs.popover")||$element.data("popover"))){$element=$("body")}$element.popover("destroy");if(step.reflex){$element.css("cursor","").off("click.tour-"+_this._options.name)}if(step.backdrop){_this._hideBackdrop()}if(step.onHidden!=null){return step.onHidden(_this)}};this._callOnPromiseDone(promise,hideStepHelper);return promise};Tour.prototype.showStep=function(i){var promise,showStepHelper,skipToPrevious,step,_this=this;if(this.ended()){this._debug("Tour ended, showStep prevented.");return this}step=this.getStep(i);if(!step){return}skipToPrevious=i<this._current;promise=this._makePromise(step.onShow!=null?step.onShow(this,i):void 0);showStepHelper=function(e){var current_path,path;_this.setCurrentStep(i);path=function(){switch(toString.call(step.path)){case"[object Function]":return step.path();case"[object String]":return this._options.basePath+step.path;default:return step.path}}.call(_this);current_path=[document.location.pathname,document.location.hash].join("");if(_this._isRedirect(path,current_path)){_this._redirect(step,path);return}if(_this._isOrphan(step)){if(!step.orphan){_this._debug("Skip the orphan step "+(_this._current+1)+". Orphan option is false and the element doesn't exist or is hidden.");if(skipToPrevious){_this._showPrevStep()}else{_this._showNextStep()}return}_this._debug("Show the orphan step "+(_this._current+1)+". Orphans option is true.")}if(step.backdrop){_this._showBackdrop(!_this._isOrphan(step)?step.element:void 0)}_this._scrollIntoView(step.element,function(){if(step.element!=null&&step.backdrop){_this._showOverlayElement(step.element)}_this._showPopover(step,i);if(step.onShown!=null){step.onShown(_this)}return _this._debug("Step "+(_this._current+1)+" of "+_this._options.steps.length)});if(step.duration){return _this.resume()}};this._callOnPromiseDone(promise,showStepHelper);return promise};Tour.prototype.getCurrentStep=function(){return this._current};Tour.prototype.setCurrentStep=function(value){if(value!=null){this._current=value;this._setState("current_step",value)}else{this._current=this._getState("current_step");this._current=this._current===null?null:parseInt(this._current,10)}return this};Tour.prototype._setState=function(key,value){var e,keyName;if(this._options.storage){keyName=""+this._options.name+"_"+key;try{this._options.storage.setItem(keyName,value)}catch(_error){e=_error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR){this.debug("LocalStorage quota exceeded. State storage failed.")}}return this._options.afterSetState(keyName,value)}else{if(this._state==null){this._state={}}return this._state[key]=value}};Tour.prototype._removeState=function(key){var keyName;if(this._options.storage){keyName=""+this._options.name+"_"+key;this._options.storage.removeItem(keyName);return this._options.afterRemoveState(keyName)}else{if(this._state!=null){return delete this._state[key]}}};Tour.prototype._getState=function(key){var keyName,value;if(this._options.storage){keyName=""+this._options.name+"_"+key;value=this._options.storage.getItem(keyName)}else{if(this._state!=null){value=this._state[key]}}if(value===void 0||value==="null"){value=null}this._options.afterGetState(key,value);return value};Tour.prototype._showNextStep=function(){var promise,showNextStepHelper,step,_this=this;step=this.getStep(this._current);showNextStepHelper=function(e){return _this.showStep(step.next)};promise=this._makePromise(step.onNext!=null?step.onNext(this):void 0);return this._callOnPromiseDone(promise,showNextStepHelper)};Tour.prototype._showPrevStep=function(){var promise,showPrevStepHelper,step,_this=this;step=this.getStep(this._current);showPrevStepHelper=function(e){return _this.showStep(step.prev)};promise=this._makePromise(step.onPrev!=null?step.onPrev(this):void 0);return this._callOnPromiseDone(promise,showPrevStepHelper)};Tour.prototype._debug=function(text){if(this._options.debug){return window.console.log("Bootstrap Tour '"+this._options.name+"' | "+text)}};Tour.prototype._isRedirect=function(path,currentPath){return path!=null&&path!==""&&(toString.call(path)==="[object RegExp]"&&!path.test(currentPath)||toString.call(path)==="[object String]"&&path.replace(/\?.*$/,"").replace(/\/?$/,"")!==currentPath.replace(/\/?$/,""))};Tour.prototype._redirect=function(step,path){if($.isFunction(step.redirect)){return step.redirect.call(this,path)}else if(step.redirect===true){this._debug("Redirect to "+path);return document.location.href=path}};Tour.prototype._isOrphan=function(step){return step.element==null||!$(step.element).length||$(step.element).is(":hidden")&&$(step.element)[0].namespaceURI!=="http://www.w3.org/2000/svg"};Tour.prototype._isLast=function(){return this._current<this._options.steps.length-1};Tour.prototype._showPopover=function(step,i){var $element,$navigation,$template,$tip,isOrphan,options,_this=this;options=$.extend({},this._options);$template=$.isFunction(step.template)?$(step.template(i,step)):$(step.template);$navigation=$template.find(".popover-navigation");isOrphan=this._isOrphan(step);if(isOrphan){step.element="body";step.placement="top";$template=$template.addClass("orphan")}$element=$(step.element);$template.addClass("tour-"+this._options.name+" tour-"+this._options.name+"-"+i);if(step.options){$.extend(options,step.options)}if(step.reflex){$element.css("cursor","pointer").on("click.tour-"+this._options.name,function(){if(_this._isLast()){return _this.next()}else{return _this.end()}})}if(step.prev<0){$navigation.find("[data-role='prev']").addClass("disabled")}if(step.next<0){$navigation.find("[data-role='next']").addClass("disabled")}if(!step.duration){$navigation.find("[data-role='pause-resume']").remove()}step.template=$template.clone().wrap("<div>").parent().html();$element.popover({placement:step.placement,trigger:"manual",title:step.title,content:step.content,html:true,animation:step.animation,container:step.container,template:step.template,selector:step.element}).popover("show");$tip=$element.data("bs.popover")?$element.data("bs.popover").tip():$element.data("popover").tip();$tip.attr("id",step.id);this._reposition($tip,step);if(isOrphan){return this._center($tip)}};Tour.prototype._reposition=function($tip,step){var offsetBottom,offsetHeight,offsetRight,offsetWidth,originalLeft,originalTop,tipOffset;offsetWidth=$tip[0].offsetWidth;offsetHeight=$tip[0].offsetHeight;tipOffset=$tip.offset();originalLeft=tipOffset.left;originalTop=tipOffset.top;offsetBottom=$(document).outerHeight()-tipOffset.top-$tip.outerHeight();if(offsetBottom<0){tipOffset.top=tipOffset.top+offsetBottom}offsetRight=$("html").outerWidth()-tipOffset.left-$tip.outerWidth();if(offsetRight<0){tipOffset.left=tipOffset.left+offsetRight}if(tipOffset.top<0){tipOffset.top=0}if(tipOffset.left<0){tipOffset.left=0}$tip.offset(tipOffset);if(step.placement==="bottom"||step.placement==="top"){if(originalLeft!==tipOffset.left){return this._replaceArrow($tip,(tipOffset.left-originalLeft)*2,offsetWidth,"left")}}else{if(originalTop!==tipOffset.top){return this._replaceArrow($tip,(tipOffset.top-originalTop)*2,offsetHeight,"top")}}};Tour.prototype._center=function($tip){return $tip.css("top",window.innerHeight/2-$tip.outerHeight()/2)};Tour.prototype._replaceArrow=function($tip,delta,dimension,position){return $tip.find(".arrow").css(position,delta?50*(1-delta/dimension)+"%":"")};Tour.prototype._scrollIntoView=function(element,callback){var $element,$window,counter,offsetTop,scrollTop,windowHeight,_this=this;$element=$(element);if(!$element.length){return callback()}$window=$(window);offsetTop=$element.offset().top;windowHeight=$window.height();scrollTop=Math.max(0,offsetTop-windowHeight/2);this._debug("Scroll into view. ScrollTop: "+scrollTop+". Element offset: "+offsetTop+". Window height: "+windowHeight+".");counter=0;return $("body,html").stop(true,true).animate({scrollTop:Math.ceil(scrollTop)},function(){if(++counter===2){callback();return _this._debug("Scroll into view. Animation end element offset: "+$element.offset().top+". Window height: "+$window.height()+".")}})};Tour.prototype._onResize=function(callback,timeout){return $(window).on("resize.tour-"+this._options.name,function(){clearTimeout(timeout);return timeout=setTimeout(callback,100)})};Tour.prototype._initMouseNavigation=function(){var _this=this;_this=this;return $(document).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']:not(.disabled)").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']:not(.disabled)").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']:not(.disabled)",function(e){e.preventDefault();return _this.next()}).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']:not(.disabled)",function(e){e.preventDefault();return _this.prev()}).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']",function(e){e.preventDefault();return _this.end()}).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']",function(e){var $this;e.preventDefault();$this=$(this);$this.text(_this._paused?$this.data("pause-text"):$this.data("resume-text"));if(_this._paused){return _this.resume()}else{return _this.pause()}})};Tour.prototype._initKeyboardNavigation=function(){var _this=this;if(!this._options.keyboard){return}return $(document).on("keyup.tour-"+this._options.name,function(e){if(!e.which){return}switch(e.which){case 39:e.preventDefault();if(_this._isLast()){return _this.next()}else{return _this.end()}break;case 37:e.preventDefault();if(_this._current>0){return _this.prev()}break;case 27:e.preventDefault();return _this.end()}})};Tour.prototype._makePromise=function(result){if(result&&$.isFunction(result.then)){return result}else{return null}};Tour.prototype._callOnPromiseDone=function(promise,cb,arg){var _this=this;if(promise){return promise.then(function(e){return cb.call(_this,arg)})}else{return cb.call(this,arg)}};Tour.prototype._showBackdrop=function(element){if(this.backdrop.backgroundShown){return}this.backdrop=$("<div/>",{"class":"tour-backdrop"});this.backdrop.backgroundShown=true;return $("body").append(this.backdrop)};Tour.prototype._hideBackdrop=function(){this._hideOverlayElement();return this._hideBackground()};Tour.prototype._hideBackground=function(){this.backdrop.remove();this.backdrop.overlay=null;return this.backdrop.backgroundShown=false};Tour.prototype._showOverlayElement=function(element){var $background,$element,offset;$element=$(element);if(!$element||$element.length===0||this.backdrop.overlayElementShown){return}this.backdrop.overlayElementShown=true;$background=$("<div/>");offset=$element.offset();offset.top=offset.top;offset.left=offset.left;$background.width($element.innerWidth()).height($element.innerHeight()).addClass("tour-step-background").offset(offset);$element.addClass("tour-step-backdrop");$("body").append($background);this.backdrop.$element=$element;return this.backdrop.$background=$background};Tour.prototype._hideOverlayElement=function(){if(!this.backdrop.overlayElementShown){return}this.backdrop.$element.removeClass("tour-step-backdrop");this.backdrop.$background.remove();this.backdrop.$element=null;this.backdrop.$background=null;return this.backdrop.overlayElementShown=false};Tour.prototype._clearTimer=function(){window.clearTimeout(this._timer);this._timer=null;return this._duration=null};return Tour}();return window.Tour=Tour})(jQuery,window)},{}],8:[function(require,module,exports){var global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};"use strict";var numeric=typeof exports==="undefined"?function numeric(){}:exports;if(typeof global!=="undefined"){global.numeric=numeric}numeric.version="1.2.6";numeric.bench=function bench(f,interval){var t1,t2,n,i;if(typeof interval==="undefined"){interval=15}n=.5;t1=new Date;while(1){n*=2;for(i=n;i>3;i-=4){f();f();f();f()}while(i>0){f();i--}t2=new Date;if(t2-t1>interval)break}for(i=n;i>3;i-=4){f();f();f();f()}while(i>0){f();i--}t2=new Date;return 1e3*(3*n-1)/(t2-t1)};numeric._myIndexOf=function _myIndexOf(w){var n=this.length,k;for(k=0;k<n;++k)if(this[k]===w)return k;return-1};numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf;numeric.Function=Function;numeric.precision=4;numeric.largeArray=50;numeric.prettyPrint=function prettyPrint(x){function fmtnum(x){if(x===0){return"0"}if(isNaN(x)){return"NaN"}if(x<0){return"-"+fmtnum(-x)}if(isFinite(x)){var scale=Math.floor(Math.log(x)/Math.log(10));var normalized=x/Math.pow(10,scale);var basic=normalized.toPrecision(numeric.precision);if(parseFloat(basic)===10){scale++;normalized=1;basic=normalized.toPrecision(numeric.precision)}return parseFloat(basic).toString()+"e"+scale.toString()}return"Infinity"}var ret=[];function foo(x){var k;if(typeof x==="undefined"){ret.push(Array(numeric.precision+8).join(" "));return false}if(typeof x==="string"){ret.push('"'+x+'"');return false}if(typeof x==="boolean"){ret.push(x.toString());return false}if(typeof x==="number"){var a=fmtnum(x);var b=x.toPrecision(numeric.precision);var c=parseFloat(x.toString()).toString();var d=[a,b,c,parseFloat(b).toString(),parseFloat(c).toString()];for(k=1;k<d.length;k++){if(d[k].length<a.length)a=d[k]}ret.push(Array(numeric.precision+8-a.length).join(" ")+a);return false}if(x===null){ret.push("null");return false}if(typeof x==="function"){ret.push(x.toString());var flag=false;for(k in x){if(x.hasOwnProperty(k)){if(flag)ret.push(",\n");else ret.push("\n{");flag=true;ret.push(k);ret.push(": \n");foo(x[k])}}if(flag)ret.push("}\n");return true}if(x instanceof Array){if(x.length>numeric.largeArray){ret.push("...Large Array...");return true}var flag=false;ret.push("[");for(k=0;k<x.length;k++){if(k>0){ret.push(",");if(flag)ret.push("\n ")}flag=foo(x[k])}ret.push("]");return true}ret.push("{");var flag=false;for(k in x){if(x.hasOwnProperty(k)){if(flag)ret.push(",\n");flag=true;ret.push(k);ret.push(": \n");foo(x[k])}}ret.push("}");return true}foo(x);return ret.join("")};numeric.parseDate=function parseDate(d){function foo(d){if(typeof d==="string"){return Date.parse(d.replace(/-/g,"/"))}if(!(d instanceof Array)){throw new Error("parseDate: parameter must be arrays of strings")}var ret=[],k;for(k=0;k<d.length;k++){ret[k]=foo(d[k])}return ret}return foo(d)};numeric.parseFloat=function parseFloat_(d){function foo(d){if(typeof d==="string"){return parseFloat(d)}if(!(d instanceof Array)){throw new Error("parseFloat: parameter must be arrays of strings")}var ret=[],k;for(k=0;k<d.length;k++){ret[k]=foo(d[k])}return ret}return foo(d)};numeric.parseCSV=function parseCSV(t){var foo=t.split("\n");var j,k;var ret=[];var pat=/(([^'",]*)|('[^']*')|("[^"]*")),/g;var patnum=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/;var stripper=function(n){return n.substr(0,n.length-1)};var count=0;for(k=0;k<foo.length;k++){var bar=(foo[k]+",").match(pat),baz;if(bar.length>0){ret[count]=[];for(j=0;j<bar.length;j++){baz=stripper(bar[j]);if(patnum.test(baz)){ret[count][j]=parseFloat(baz)}else ret[count][j]=baz}count++}}return ret};numeric.toCSV=function toCSV(A){var s=numeric.dim(A);var i,j,m,n,row,ret;m=s[0];n=s[1];ret=[];for(i=0;i<m;i++){row=[];for(j=0;j<m;j++){row[j]=A[i][j].toString()}ret[i]=row.join(", ")}return ret.join("\n")+"\n"};numeric.getURL=function getURL(url){var client=new XMLHttpRequest;client.open("GET",url,false);client.send();return client};numeric.imageURL=function imageURL(img){function base64(A){var n=A.length,i,x,y,z,p,q,r,s;var key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var ret="";for(i=0;i<n;i+=3){x=A[i];y=A[i+1];z=A[i+2];p=x>>2;q=((x&3)<<4)+(y>>4);r=((y&15)<<2)+(z>>6);s=z&63;if(i+1>=n){r=s=64}else if(i+2>=n){s=64}ret+=key.charAt(p)+key.charAt(q)+key.charAt(r)+key.charAt(s)}return ret}function crc32Array(a,from,to){if(typeof from==="undefined"){from=0}if(typeof to==="undefined"){to=a.length}var table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];
var crc=-1,y=0,n=a.length,i;for(i=from;i<to;i++){y=(crc^a[i])&255;crc=crc>>>8^table[y]}return crc^-1}var h=img[0].length,w=img[0][0].length,s1,s2,next,k,length,a,b,i,j,adler32,crc32;var stream=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,w>>24&255,w>>16&255,w>>8&255,w&255,h>>24&255,h>>16&255,h>>8&255,h&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];crc32=crc32Array(stream,12,29);stream[29]=crc32>>24&255;stream[30]=crc32>>16&255;stream[31]=crc32>>8&255;stream[32]=crc32&255;s1=1;s2=0;for(i=0;i<h;i++){if(i<h-1){stream.push(0)}else{stream.push(1)}a=3*w+1+(i===0)&255;b=3*w+1+(i===0)>>8&255;stream.push(a);stream.push(b);stream.push(~a&255);stream.push(~b&255);if(i===0)stream.push(0);for(j=0;j<w;j++){for(k=0;k<3;k++){a=img[k][i][j];if(a>255)a=255;else if(a<0)a=0;else a=Math.round(a);s1=(s1+a)%65521;s2=(s2+s1)%65521;stream.push(a)}}stream.push(0)}adler32=(s2<<16)+s1;stream.push(adler32>>24&255);stream.push(adler32>>16&255);stream.push(adler32>>8&255);stream.push(adler32&255);length=stream.length-41;stream[33]=length>>24&255;stream[34]=length>>16&255;stream[35]=length>>8&255;stream[36]=length&255;crc32=crc32Array(stream,37);stream.push(crc32>>24&255);stream.push(crc32>>16&255);stream.push(crc32>>8&255);stream.push(crc32&255);stream.push(0);stream.push(0);stream.push(0);stream.push(0);stream.push(73);stream.push(69);stream.push(78);stream.push(68);stream.push(174);stream.push(66);stream.push(96);stream.push(130);return"data:image/png;base64,"+base64(stream)};numeric._dim=function _dim(x){var ret=[];while(typeof x==="object"){ret.push(x.length);x=x[0]}return ret};numeric.dim=function dim(x){var y,z;if(typeof x==="object"){y=x[0];if(typeof y==="object"){z=y[0];if(typeof z==="object"){return numeric._dim(x)}return[x.length,y.length]}return[x.length]}return[]};numeric.mapreduce=function mapreduce(body,init){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+init+";\n"+'if(typeof x === "number") { var xi = x; '+body+"; return accum; }\n"+'if(typeof _s === "undefined") _s = numeric.dim(x);\n'+'if(typeof _k === "undefined") _k = 0;\n'+"var _n = _s[_k];\n"+"var i,xi;\n"+"if(_k < _s.length-1) {\n"+"    for(i=_n-1;i>=0;i--) {\n"+"        accum = arguments.callee(x[i],accum,_s,_k+1);\n"+"    }"+"    return accum;\n"+"}\n"+"for(i=_n-1;i>=1;i-=2) { \n"+"    xi = x[i];\n"+"    "+body+";\n"+"    xi = x[i-1];\n"+"    "+body+";\n"+"}\n"+"if(i === 0) {\n"+"    xi = x[i];\n"+"    "+body+"\n"+"}\n"+"return accum;")};numeric.mapreduce2=function mapreduce2(body,setup){return Function("x","var n = x.length;\n"+"var i,xi;\n"+setup+";\n"+"for(i=n-1;i!==-1;--i) { \n"+"    xi = x[i];\n"+"    "+body+";\n"+"}\n"+"return accum;")};numeric.same=function same(x,y){var i,n;if(!(x instanceof Array)||!(y instanceof Array)){return false}n=x.length;if(n!==y.length){return false}for(i=0;i<n;i++){if(x[i]===y[i]){continue}if(typeof x[i]==="object"){if(!same(x[i],y[i]))return false}else{return false}}return true};numeric.rep=function rep(s,v,k){if(typeof k==="undefined"){k=0}var n=s[k],ret=Array(n),i;if(k===s.length-1){for(i=n-2;i>=0;i-=2){ret[i+1]=v;ret[i]=v}if(i===-1){ret[0]=v}return ret}for(i=n-1;i>=0;i--){ret[i]=numeric.rep(s,v,k+1)}return ret};numeric.dotMMsmall=function dotMMsmall(x,y){var i,j,k,p,q,r,ret,foo,bar,woo,i0,k0,p0,r0;p=x.length;q=y.length;r=y[0].length;ret=Array(p);for(i=p-1;i>=0;i--){foo=Array(r);bar=x[i];for(k=r-1;k>=0;k--){woo=bar[q-1]*y[q-1][k];for(j=q-2;j>=1;j-=2){i0=j-1;woo+=bar[j]*y[j][k]+bar[i0]*y[i0][k]}if(j===0){woo+=bar[0]*y[0][k]}foo[k]=woo}ret[i]=foo}return ret};numeric._getCol=function _getCol(A,j,x){var n=A.length,i;for(i=n-1;i>0;--i){x[i]=A[i][j];--i;x[i]=A[i][j]}if(i===0)x[0]=A[0][j]};numeric.dotMMbig=function dotMMbig(x,y){var gc=numeric._getCol,p=y.length,v=Array(p);var m=x.length,n=y[0].length,A=new Array(m),xj;var VV=numeric.dotVV;var i,j,k,z;--p;--m;for(i=m;i!==-1;--i)A[i]=Array(n);--n;for(i=n;i!==-1;--i){gc(y,i,v);for(j=m;j!==-1;--j){z=0;xj=x[j];A[j][i]=VV(xj,v)}}return A};numeric.dotMV=function dotMV(x,y){var p=x.length,q=y.length,i;var ret=Array(p),dotVV=numeric.dotVV;for(i=p-1;i>=0;i--){ret[i]=dotVV(x[i],y)}return ret};numeric.dotVM=function dotVM(x,y){var i,j,k,p,q,r,ret,foo,bar,woo,i0,k0,p0,r0,s1,s2,s3,baz,accum;p=x.length;q=y[0].length;ret=Array(q);for(k=q-1;k>=0;k--){woo=x[p-1]*y[p-1][k];for(j=p-2;j>=1;j-=2){i0=j-1;woo+=x[j]*y[j][k]+x[i0]*y[i0][k]}if(j===0){woo+=x[0]*y[0][k]}ret[k]=woo}return ret};numeric.dotVV=function dotVV(x,y){var i,n=x.length,i1,ret=x[n-1]*y[n-1];for(i=n-2;i>=1;i-=2){i1=i-1;ret+=x[i]*y[i]+x[i1]*y[i1]}if(i===0){ret+=x[0]*y[0]}return ret};numeric.dot=function dot(x,y){var d=numeric.dim;switch(d(x).length*1e3+d(y).length){case 2002:if(y.length<10)return numeric.dotMMsmall(x,y);else return numeric.dotMMbig(x,y);case 2001:return numeric.dotMV(x,y);case 1002:return numeric.dotVM(x,y);case 1001:return numeric.dotVV(x,y);case 1e3:return numeric.mulVS(x,y);case 1:return numeric.mulSV(x,y);case 0:return x*y;default:throw new Error("numeric.dot only works on vectors and matrices")}};numeric.diag=function diag(d){var i,i1,j,n=d.length,A=Array(n),Ai;for(i=n-1;i>=0;i--){Ai=Array(n);i1=i+2;for(j=n-1;j>=i1;j-=2){Ai[j]=0;Ai[j-1]=0}if(j>i){Ai[j]=0}Ai[i]=d[i];for(j=i-1;j>=1;j-=2){Ai[j]=0;Ai[j-1]=0}if(j===0){Ai[0]=0}A[i]=Ai}return A};numeric.getDiag=function(A){var n=Math.min(A.length,A[0].length),i,ret=Array(n);for(i=n-1;i>=1;--i){ret[i]=A[i][i];--i;ret[i]=A[i][i]}if(i===0){ret[0]=A[0][0]}return ret};numeric.identity=function identity(n){return numeric.diag(numeric.rep([n],1))};numeric.pointwise=function pointwise(params,body,setup){if(typeof setup==="undefined"){setup=""}var fun=[];var k;var avec=/\[i\]$/,p,thevec="";var haveret=false;for(k=0;k<params.length;k++){if(avec.test(params[k])){p=params[k].substring(0,params[k].length-3);thevec=p}else{p=params[k]}if(p==="ret")haveret=true;fun.push(p)}fun[params.length]="_s";fun[params.length+1]="_k";fun[params.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+thevec+");\n"+'if(typeof _k === "undefined") _k = 0;\n'+"var _n = _s[_k];\n"+"var i"+(haveret?"":", ret = Array(_n)")+";\n"+"if(_k < _s.length-1) {\n"+"    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+params.join(",")+",_s,_k+1);\n"+"    return ret;\n"+"}\n"+setup+"\n"+"for(i=_n-1;i!==-1;--i) {\n"+"    "+body+"\n"+"}\n"+"return ret;";return Function.apply(null,fun)};numeric.pointwise2=function pointwise2(params,body,setup){if(typeof setup==="undefined"){setup=""}var fun=[];var k;var avec=/\[i\]$/,p,thevec="";var haveret=false;for(k=0;k<params.length;k++){if(avec.test(params[k])){p=params[k].substring(0,params[k].length-3);thevec=p}else{p=params[k]}if(p==="ret")haveret=true;fun.push(p)}fun[params.length]="var _n = "+thevec+".length;\n"+"var i"+(haveret?"":", ret = Array(_n)")+";\n"+setup+"\n"+"for(i=_n-1;i!==-1;--i) {\n"+body+"\n"+"}\n"+"return ret;";return Function.apply(null,fun)};numeric._biforeach=function _biforeach(x,y,s,k,f){if(k===s.length-1){f(x,y);return}var i,n=s[k];for(i=n-1;i>=0;i--){_biforeach(typeof x==="object"?x[i]:x,typeof y==="object"?y[i]:y,s,k+1,f)}};numeric._biforeach2=function _biforeach2(x,y,s,k,f){if(k===s.length-1){return f(x,y)}var i,n=s[k],ret=Array(n);for(i=n-1;i>=0;--i){ret[i]=_biforeach2(typeof x==="object"?x[i]:x,typeof y==="object"?y[i]:y,s,k+1,f)}return ret};numeric._foreach=function _foreach(x,s,k,f){if(k===s.length-1){f(x);return}var i,n=s[k];for(i=n-1;i>=0;i--){_foreach(x[i],s,k+1,f)}};numeric._foreach2=function _foreach2(x,s,k,f){if(k===s.length-1){return f(x)}var i,n=s[k],ret=Array(n);for(i=n-1;i>=0;i--){ret[i]=_foreach2(x[i],s,k+1,f)}return ret};numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="};numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"];numeric.mathfuns2=["atan2","pow","max","min"];numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""};numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]};(function(){var i,o;for(i=0;i<numeric.mathfuns2.length;++i){o=numeric.mathfuns2[i];numeric.ops2[o]=o}for(i in numeric.ops2){if(numeric.ops2.hasOwnProperty(i)){o=numeric.ops2[i];var code,codeeq,setup="";if(numeric.myIndexOf.call(numeric.mathfuns2,i)!==-1){setup="var "+o+" = Math."+o+";\n";code=function(r,x,y){return r+" = "+o+"("+x+","+y+")"};codeeq=function(x,y){return x+" = "+o+"("+x+","+y+")"}}else{code=function(r,x,y){return r+" = "+x+" "+o+" "+y};if(numeric.opseq.hasOwnProperty(i+"eq")){codeeq=function(x,y){return x+" "+o+"= "+y}}else{codeeq=function(x,y){return x+" = "+x+" "+o+" "+y}}}numeric[i+"VV"]=numeric.pointwise2(["x[i]","y[i]"],code("ret[i]","x[i]","y[i]"),setup);numeric[i+"SV"]=numeric.pointwise2(["x","y[i]"],code("ret[i]","x","y[i]"),setup);numeric[i+"VS"]=numeric.pointwise2(["x[i]","y"],code("ret[i]","x[i]","y"),setup);numeric[i]=Function("var n = arguments.length, i, x = arguments[0], y;\n"+"var VV = numeric."+i+"VV, VS = numeric."+i+"VS, SV = numeric."+i+"SV;\n"+"var dim = numeric.dim;\n"+"for(i=1;i!==n;++i) { \n"+"  y = arguments[i];\n"+'  if(typeof x === "object") {\n'+'      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n'+"      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n"+'  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n'+"  else "+codeeq("x","y")+"\n"+"}\nreturn x;\n");numeric[o]=numeric[i];numeric[i+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],codeeq("ret[i]","x[i]"),setup);numeric[i+"eqS"]=numeric.pointwise2(["ret[i]","x"],codeeq("ret[i]","x"),setup);numeric[i+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\n"+"var V = numeric."+i+"eqV, S = numeric."+i+"eqS\n"+"var s = numeric.dim(x);\n"+"for(i=1;i!==n;++i) { \n"+"  y = arguments[i];\n"+'  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n'+"  else numeric._biforeach(x,y,s,0,S);\n"+"}\nreturn x;\n")}}for(i=0;i<numeric.mathfuns2.length;++i){o=numeric.mathfuns2[i];delete numeric.ops2[o]}for(i=0;i<numeric.mathfuns.length;++i){o=numeric.mathfuns[i];numeric.ops1[o]=o}for(i in numeric.ops1){if(numeric.ops1.hasOwnProperty(i)){setup="";o=numeric.ops1[i];if(numeric.myIndexOf.call(numeric.mathfuns,i)!==-1){if(Math.hasOwnProperty(o))setup="var "+o+" = Math."+o+";\n"}numeric[i+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+o+"(ret[i]);",setup);numeric[i+"eq"]=Function("x",'if(typeof x !== "object") return '+o+"x\n"+"var i;\n"+"var V = numeric."+i+"eqV;\n"+"var s = numeric.dim(x);\n"+"numeric._foreach(x,s,0,V);\n"+"return x;\n");numeric[i+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+o+"(x[i]);",setup);numeric[i]=Function("x",'if(typeof x !== "object") return '+o+"(x)\n"+"var i;\n"+"var V = numeric."+i+"V;\n"+"var s = numeric.dim(x);\n"+"return numeric._foreach2(x,s,0,V);\n")}}for(i=0;i<numeric.mathfuns.length;++i){o=numeric.mathfuns[i];delete numeric.ops1[o]}for(i in numeric.mapreducers){if(numeric.mapreducers.hasOwnProperty(i)){o=numeric.mapreducers[i];numeric[i+"V"]=numeric.mapreduce2(o[0],o[1]);numeric[i]=Function("x","s","k",o[1]+'if(typeof x !== "object") {'+"    xi = x;\n"+o[0]+";\n"+"    return accum;\n"+"}"+'if(typeof s === "undefined") s = numeric.dim(x);\n'+'if(typeof k === "undefined") k = 0;\n'+"if(k === s.length-1) return numeric."+i+"V(x);\n"+"var xi;\n"+"var n = x.length, i;\n"+"for(i=n-1;i!==-1;--i) {\n"+"   xi = arguments.callee(x[i]);\n"+o[0]+";\n"+"}\n"+"return accum;\n")}}})();numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;");numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;");numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;");numeric.trunc=function trunc(x,y){if(typeof x==="object"){if(typeof y==="object")return numeric.truncVV(x,y);return numeric.truncVS(x,y)}if(typeof y==="object")return numeric.truncSV(x,y);return Math.round(x/y)*y};numeric.inv=function inv(x){var s=numeric.dim(x),abs=Math.abs,m=s[0],n=s[1];var A=numeric.clone(x),Ai,Aj;var I=numeric.identity(m),Ii,Ij;var i,j,k,x;for(j=0;j<n;++j){var i0=-1;var v0=-1;for(i=j;i!==m;++i){k=abs(A[i][j]);if(k>v0){i0=i;v0=k}}Aj=A[i0];A[i0]=A[j];A[j]=Aj;Ij=I[i0];I[i0]=I[j];I[j]=Ij;x=Aj[j];for(k=j;k!==n;++k)Aj[k]/=x;for(k=n-1;k!==-1;--k)Ij[k]/=x;for(i=m-1;i!==-1;--i){if(i!==j){Ai=A[i];Ii=I[i];x=Ai[j];for(k=j+1;k!==n;++k)Ai[k]-=Aj[k]*x;for(k=n-1;k>0;--k){Ii[k]-=Ij[k]*x;--k;Ii[k]-=Ij[k]*x}if(k===0)Ii[0]-=Ij[0]*x}}}return I};numeric.det=function det(x){var s=numeric.dim(x);if(s.length!==2||s[0]!==s[1]){throw new Error("numeric: det() only works on square matrices")}var n=s[0],ret=1,i,j,k,A=numeric.clone(x),Aj,Ai,alpha,temp,k1,k2,k3;for(j=0;j<n-1;j++){k=j;for(i=j+1;i<n;i++){if(Math.abs(A[i][j])>Math.abs(A[k][j])){k=i}}if(k!==j){temp=A[k];A[k]=A[j];A[j]=temp;ret*=-1}Aj=A[j];for(i=j+1;i<n;i++){Ai=A[i];alpha=Ai[j]/Aj[j];for(k=j+1;k<n-1;k+=2){k1=k+1;Ai[k]-=Aj[k]*alpha;Ai[k1]-=Aj[k1]*alpha}if(k!==n){Ai[k]-=Aj[k]*alpha}}if(Aj[j]===0){return 0}ret*=Aj[j]}return ret*A[j][j]};numeric.transpose=function transpose(x){var i,j,m=x.length,n=x[0].length,ret=Array(n),A0,A1,Bj;for(j=0;j<n;j++)ret[j]=Array(m);for(i=m-1;i>=1;i-=2){A1=x[i];A0=x[i-1];for(j=n-1;j>=1;--j){Bj=ret[j];Bj[i]=A1[j];Bj[i-1]=A0[j];--j;Bj=ret[j];Bj[i]=A1[j];Bj[i-1]=A0[j]}if(j===0){Bj=ret[0];Bj[i]=A1[0];Bj[i-1]=A0[0]}}if(i===0){A0=x[0];for(j=n-1;j>=1;--j){ret[j][0]=A0[j];--j;ret[j][0]=A0[j]}if(j===0){ret[0][0]=A0[0]}}return ret};numeric.negtranspose=function negtranspose(x){var i,j,m=x.length,n=x[0].length,ret=Array(n),A0,A1,Bj;for(j=0;j<n;j++)ret[j]=Array(m);for(i=m-1;i>=1;i-=2){A1=x[i];A0=x[i-1];for(j=n-1;j>=1;--j){Bj=ret[j];Bj[i]=-A1[j];Bj[i-1]=-A0[j];--j;Bj=ret[j];Bj[i]=-A1[j];Bj[i-1]=-A0[j]}if(j===0){Bj=ret[0];Bj[i]=-A1[0];Bj[i-1]=-A0[0]}}if(i===0){A0=x[0];for(j=n-1;j>=1;--j){ret[j][0]=-A0[j];--j;ret[j][0]=-A0[j]}if(j===0){ret[0][0]=-A0[0]}}return ret};numeric._random=function _random(s,k){var i,n=s[k],ret=Array(n),rnd;if(k===s.length-1){rnd=Math.random;for(i=n-1;i>=1;i-=2){ret[i]=rnd();ret[i-1]=rnd()}if(i===0){ret[0]=rnd()}return ret}for(i=n-1;i>=0;i--)ret[i]=_random(s,k+1);return ret};numeric.random=function random(s){return numeric._random(s,0)};numeric.norm2=function norm2(x){return Math.sqrt(numeric.norm2Squared(x))};numeric.linspace=function linspace(a,b,n){if(typeof n==="undefined")n=Math.max(Math.round(b-a)+1,1);if(n<2){return n===1?[a]:[]}var i,ret=Array(n);n--;for(i=n;i>=0;i--){ret[i]=(i*b+(n-i)*a)/n}return ret};numeric.getBlock=function getBlock(x,from,to){var s=numeric.dim(x);function foo(x,k){var i,a=from[k],n=to[k]-a,ret=Array(n);if(k===s.length-1){for(i=n;i>=0;i--){ret[i]=x[i+a]}return ret}for(i=n;i>=0;i--){ret[i]=foo(x[i+a],k+1)}return ret}return foo(x,0)};numeric.setBlock=function setBlock(x,from,to,B){var s=numeric.dim(x);function foo(x,y,k){var i,a=from[k],n=to[k]-a;if(k===s.length-1){for(i=n;i>=0;i--){x[i+a]=y[i]}}for(i=n;i>=0;i--){foo(x[i+a],y[i],k+1)}}foo(x,B,0);return x};numeric.getRange=function getRange(A,I,J){var m=I.length,n=J.length;var i,j;var B=Array(m),Bi,AI;for(i=m-1;i!==-1;--i){B[i]=Array(n);Bi=B[i];AI=A[I[i]];for(j=n-1;j!==-1;--j)Bi[j]=AI[J[j]]}return B};numeric.blockMatrix=function blockMatrix(X){var s=numeric.dim(X);if(s.length<4)return numeric.blockMatrix([X]);var m=s[0],n=s[1],M,N,i,j,Xij;M=0;N=0;for(i=0;i<m;++i)M+=X[i][0].length;for(j=0;j<n;++j)N+=X[0][j][0].length;var Z=Array(M);for(i=0;i<M;++i)Z[i]=Array(N);var I=0,J,ZI,k,l,Xijk;for(i=0;i<m;++i){J=N;for(j=n-1;j!==-1;--j){Xij=X[i][j];J-=Xij[0].length;for(k=Xij.length-1;k!==-1;--k){Xijk=Xij[k];ZI=Z[I+k];for(l=Xijk.length-1;l!==-1;--l)ZI[J+l]=Xijk[l]}}I+=X[i][0].length}return Z};numeric.tensor=function tensor(x,y){if(typeof x==="number"||typeof y==="number")return numeric.mul(x,y);var s1=numeric.dim(x),s2=numeric.dim(y);if(s1.length!==1||s2.length!==1){throw new Error("numeric: tensor product is only defined for vectors")}var m=s1[0],n=s2[0],A=Array(m),Ai,i,j,xi;for(i=m-1;i>=0;i--){Ai=Array(n);xi=x[i];for(j=n-1;j>=3;--j){Ai[j]=xi*y[j];--j;Ai[j]=xi*y[j];--j;Ai[j]=xi*y[j];--j;Ai[j]=xi*y[j]}while(j>=0){Ai[j]=xi*y[j];--j}A[i]=Ai}return A};numeric.T=function T(x,y){this.x=x;this.y=y};numeric.t=function t(x,y){return new numeric.T(x,y)};numeric.Tbinop=function Tbinop(rr,rc,cr,cc,setup){var io=numeric.indexOf;if(typeof setup!=="string"){var k;setup="";for(k in numeric){if(numeric.hasOwnProperty(k)&&(rr.indexOf(k)>=0||rc.indexOf(k)>=0||cr.indexOf(k)>=0||cc.indexOf(k)>=0)&&k.length>1){setup+="var "+k+" = numeric."+k+";\n"}}}return Function(["y"],"var x = this;\n"+"if(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+setup+"\n"+"if(x.y) {"+"  if(y.y) {"+"    return new numeric.T("+cc+");\n"+"  }\n"+"  return new numeric.T("+cr+");\n"+"}\n"+"if(y.y) {\n"+"  return new numeric.T("+rc+");\n"+"}\n"+"return new numeric.T("+rr+");\n")};numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)");numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)");numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))");numeric.T.prototype.reciprocal=function reciprocal(){var mul=numeric.mul,div=numeric.div;if(this.y){var d=numeric.add(mul(this.x,this.x),mul(this.y,this.y));return new numeric.T(div(this.x,d),div(numeric.neg(this.y),d))}return new T(div(1,this.x))};numeric.T.prototype.div=function div(y){if(!(y instanceof numeric.T))y=new numeric.T(y);if(y.y){return this.mul(y.reciprocal())}var div=numeric.div;if(this.y){return new numeric.T(div(this.x,y.x),div(this.y,y.x))}return new numeric.T(div(this.x,y.x))};numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))");numeric.T.prototype.transpose=function transpose(){var t=numeric.transpose,x=this.x,y=this.y;if(y){return new numeric.T(t(x),t(y))}return new numeric.T(t(x))};numeric.T.prototype.transjugate=function transjugate(){var t=numeric.transpose,x=this.x,y=this.y;if(y){return new numeric.T(t(x),numeric.negtranspose(y))}return new numeric.T(t(x))};numeric.Tunop=function Tunop(r,c,s){if(typeof s!=="string"){s=""}return Function("var x = this;\n"+s+"\n"+"if(x.y) {"+"  "+c+";\n"+"}\n"+r+";\n")};numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;");numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));");numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;");numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));");numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);");numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;");numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\n"+"return new numeric.T(numeric.log(r.x),theta.x);");numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\n"+"return Math.sqrt(f(x.x)+f(x.y));");numeric.T.prototype.inv=function inv(){var A=this;if(typeof A.y==="undefined"){return new numeric.T(numeric.inv(A.x))}var n=A.x.length,i,j,k;var Rx=numeric.identity(n),Ry=numeric.rep([n,n],0);var Ax=numeric.clone(A.x),Ay=numeric.clone(A.y);var Aix,Aiy,Ajx,Ajy,Rix,Riy,Rjx,Rjy;var i,j,k,d,d1,ax,ay,bx,by,temp;for(i=0;i<n;i++){ax=Ax[i][i];ay=Ay[i][i];d=ax*ax+ay*ay;k=i;for(j=i+1;j<n;j++){ax=Ax[j][i];ay=Ay[j][i];d1=ax*ax+ay*ay;if(d1>d){k=j;d=d1}}if(k!==i){temp=Ax[i];Ax[i]=Ax[k];Ax[k]=temp;temp=Ay[i];Ay[i]=Ay[k];Ay[k]=temp;temp=Rx[i];Rx[i]=Rx[k];Rx[k]=temp;temp=Ry[i];Ry[i]=Ry[k];Ry[k]=temp}Aix=Ax[i];Aiy=Ay[i];Rix=Rx[i];Riy=Ry[i];ax=Aix[i];ay=Aiy[i];for(j=i+1;j<n;j++){bx=Aix[j];by=Aiy[j];Aix[j]=(bx*ax+by*ay)/d;Aiy[j]=(by*ax-bx*ay)/d}for(j=0;j<n;j++){bx=Rix[j];by=Riy[j];Rix[j]=(bx*ax+by*ay)/d;Riy[j]=(by*ax-bx*ay)/d}for(j=i+1;j<n;j++){Ajx=Ax[j];Ajy=Ay[j];Rjx=Rx[j];Rjy=Ry[j];ax=Ajx[i];ay=Ajy[i];for(k=i+1;k<n;k++){bx=Aix[k];by=Aiy[k];Ajx[k]-=bx*ax-by*ay;Ajy[k]-=by*ax+bx*ay}for(k=0;k<n;k++){bx=Rix[k];by=Riy[k];Rjx[k]-=bx*ax-by*ay;Rjy[k]-=by*ax+bx*ay}}}for(i=n-1;i>0;i--){Rix=Rx[i];Riy=Ry[i];for(j=i-1;j>=0;j--){Rjx=Rx[j];Rjy=Ry[j];ax=Ax[j][i];ay=Ay[j][i];for(k=n-1;k>=0;k--){bx=Rix[k];by=Riy[k];Rjx[k]-=ax*bx-ay*by;Rjy[k]-=ax*by+ay*bx}}}return new numeric.T(Rx,Ry)};numeric.T.prototype.get=function get(i){var x=this.x,y=this.y,k=0,ik,n=i.length;if(y){while(k<n){ik=i[k];x=x[ik];y=y[ik];k++}return new numeric.T(x,y)}while(k<n){ik=i[k];x=x[ik];k++}return new numeric.T(x)};numeric.T.prototype.set=function set(i,v){var x=this.x,y=this.y,k=0,ik,n=i.length,vx=v.x,vy=v.y;if(n===0){if(vy){this.y=vy}else if(y){this.y=undefined}this.x=x;return this}if(vy){if(y){}else{y=numeric.rep(numeric.dim(x),0);this.y=y}while(k<n-1){ik=i[k];x=x[ik];y=y[ik];k++}ik=i[k];x[ik]=vx;y[ik]=vy;return this}if(y){while(k<n-1){ik=i[k];x=x[ik];y=y[ik];k++}ik=i[k];x[ik]=vx;if(vx instanceof Array)y[ik]=numeric.rep(numeric.dim(vx),0);else y[ik]=0;return this}while(k<n-1){ik=i[k];x=x[ik];k++}ik=i[k];x[ik]=vx;return this};numeric.T.prototype.getRows=function getRows(i0,i1){var n=i1-i0+1,j;var rx=Array(n),ry,x=this.x,y=this.y;for(j=i0;j<=i1;j++){rx[j-i0]=x[j]}if(y){ry=Array(n);for(j=i0;j<=i1;j++){ry[j-i0]=y[j]}return new numeric.T(rx,ry)}return new numeric.T(rx)};numeric.T.prototype.setRows=function setRows(i0,i1,A){var j;var rx=this.x,ry=this.y,x=A.x,y=A.y;for(j=i0;j<=i1;j++){rx[j]=x[j-i0]}if(y){if(!ry){ry=numeric.rep(numeric.dim(rx),0);this.y=ry}for(j=i0;j<=i1;j++){ry[j]=y[j-i0]}}else if(ry){for(j=i0;j<=i1;j++){ry[j]=numeric.rep([x[j-i0].length],0)}}return this};numeric.T.prototype.getRow=function getRow(k){var x=this.x,y=this.y;if(y){return new numeric.T(x[k],y[k])}return new numeric.T(x[k])};numeric.T.prototype.setRow=function setRow(i,v){var rx=this.x,ry=this.y,x=v.x,y=v.y;rx[i]=x;if(y){if(!ry){ry=numeric.rep(numeric.dim(rx),0);this.y=ry}ry[i]=y}else if(ry){ry=numeric.rep([x.length],0)}return this};numeric.T.prototype.getBlock=function getBlock(from,to){var x=this.x,y=this.y,b=numeric.getBlock;if(y){return new numeric.T(b(x,from,to),b(y,from,to))}return new numeric.T(b(x,from,to))};numeric.T.prototype.setBlock=function setBlock(from,to,A){if(!(A instanceof numeric.T))A=new numeric.T(A);var x=this.x,y=this.y,b=numeric.setBlock,Ax=A.x,Ay=A.y;if(Ay){if(!y){this.y=numeric.rep(numeric.dim(this),0);y=this.y}b(x,from,to,Ax);b(y,from,to,Ay);return this}b(x,from,to,Ax);if(y)b(y,from,to,numeric.rep(numeric.dim(Ax),0))};numeric.T.rep=function rep(s,v){var T=numeric.T;if(!(v instanceof T))v=new T(v);var x=v.x,y=v.y,r=numeric.rep;if(y)return new T(r(s,x),r(s,y));return new T(r(s,x))};numeric.T.diag=function diag(d){if(!(d instanceof numeric.T))d=new numeric.T(d);var x=d.x,y=d.y,diag=numeric.diag;if(y)return new numeric.T(diag(x),diag(y));return new numeric.T(diag(x))};numeric.T.eig=function eig(){if(this.y){throw new Error("eig: not implemented for complex matrices.")}return numeric.eig(this.x)};numeric.T.identity=function identity(n){return new numeric.T(numeric.identity(n))};numeric.T.prototype.getDiag=function getDiag(){var n=numeric;var x=this.x,y=this.y;if(y){return new n.T(n.getDiag(x),n.getDiag(y))}return new n.T(n.getDiag(x))};numeric.house=function house(x){var v=numeric.clone(x);var s=x[0]>=0?1:-1;var alpha=s*numeric.norm2(x);v[0]+=alpha;var foo=numeric.norm2(v);if(foo===0){throw new Error("eig: internal error")}return numeric.div(v,foo)};numeric.toUpperHessenberg=function toUpperHessenberg(me){var s=numeric.dim(me);if(s.length!==2||s[0]!==s[1]){throw new Error("numeric: toUpperHessenberg() only works on square matrices")}var m=s[0],i,j,k,x,v,A=numeric.clone(me),B,C,Ai,Ci,Q=numeric.identity(m),Qi;for(j=0;j<m-2;j++){x=Array(m-j-1);for(i=j+1;i<m;i++){x[i-j-1]=A[i][j]}if(numeric.norm2(x)>0){v=numeric.house(x);B=numeric.getBlock(A,[j+1,j],[m-1,m-1]);C=numeric.tensor(v,numeric.dot(v,B));for(i=j+1;i<m;i++){Ai=A[i];Ci=C[i-j-1];for(k=j;k<m;k++)Ai[k]-=2*Ci[k-j]}B=numeric.getBlock(A,[0,j+1],[m-1,m-1]);C=numeric.tensor(numeric.dot(B,v),v);for(i=0;i<m;i++){Ai=A[i];Ci=C[i];for(k=j+1;k<m;k++)Ai[k]-=2*Ci[k-j-1]}B=Array(m-j-1);for(i=j+1;i<m;i++)B[i-j-1]=Q[i];C=numeric.tensor(v,numeric.dot(v,B));for(i=j+1;i<m;i++){Qi=Q[i];Ci=C[i-j-1];for(k=0;k<m;k++)Qi[k]-=2*Ci[k]}}}return{H:A,Q:Q}};numeric.epsilon=2.220446049250313e-16;numeric.QRFrancis=function(H,maxiter){if(typeof maxiter==="undefined"){maxiter=1e4}H=numeric.clone(H);var H0=numeric.clone(H);var s=numeric.dim(H),m=s[0],x,v,a,b,c,d,det,tr,Hloc,Q=numeric.identity(m),Qi,Hi,B,C,Ci,i,j,k,iter;if(m<3){return{Q:Q,B:[[0,m-1]]}}var epsilon=numeric.epsilon;for(iter=0;iter<maxiter;iter++){for(j=0;j<m-1;j++){if(Math.abs(H[j+1][j])<epsilon*(Math.abs(H[j][j])+Math.abs(H[j+1][j+1]))){var QH1=numeric.QRFrancis(numeric.getBlock(H,[0,0],[j,j]),maxiter);var QH2=numeric.QRFrancis(numeric.getBlock(H,[j+1,j+1],[m-1,m-1]),maxiter);B=Array(j+1);for(i=0;i<=j;i++){B[i]=Q[i]}C=numeric.dot(QH1.Q,B);for(i=0;i<=j;i++){Q[i]=C[i]}B=Array(m-j-1);for(i=j+1;i<m;i++){B[i-j-1]=Q[i]}C=numeric.dot(QH2.Q,B);for(i=j+1;i<m;i++){Q[i]=C[i-j-1]}return{Q:Q,B:QH1.B.concat(numeric.add(QH2.B,j+1))}}}a=H[m-2][m-2];b=H[m-2][m-1];c=H[m-1][m-2];d=H[m-1][m-1];tr=a+d;det=a*d-b*c;Hloc=numeric.getBlock(H,[0,0],[2,2]);if(tr*tr>=4*det){var s1,s2;s1=.5*(tr+Math.sqrt(tr*tr-4*det));s2=.5*(tr-Math.sqrt(tr*tr-4*det));Hloc=numeric.add(numeric.sub(numeric.dot(Hloc,Hloc),numeric.mul(Hloc,s1+s2)),numeric.diag(numeric.rep([3],s1*s2)))}else{Hloc=numeric.add(numeric.sub(numeric.dot(Hloc,Hloc),numeric.mul(Hloc,tr)),numeric.diag(numeric.rep([3],det)))}x=[Hloc[0][0],Hloc[1][0],Hloc[2][0]];v=numeric.house(x);B=[H[0],H[1],H[2]];C=numeric.tensor(v,numeric.dot(v,B));for(i=0;i<3;i++){Hi=H[i];Ci=C[i];for(k=0;k<m;k++)Hi[k]-=2*Ci[k]}B=numeric.getBlock(H,[0,0],[m-1,2]);C=numeric.tensor(numeric.dot(B,v),v);for(i=0;i<m;i++){Hi=H[i];Ci=C[i];for(k=0;k<3;k++)Hi[k]-=2*Ci[k]}B=[Q[0],Q[1],Q[2]];C=numeric.tensor(v,numeric.dot(v,B));for(i=0;i<3;i++){Qi=Q[i];Ci=C[i];for(k=0;k<m;k++)Qi[k]-=2*Ci[k]}var J;for(j=0;j<m-2;j++){for(k=j;k<=j+1;k++){if(Math.abs(H[k+1][k])<epsilon*(Math.abs(H[k][k])+Math.abs(H[k+1][k+1]))){var QH1=numeric.QRFrancis(numeric.getBlock(H,[0,0],[k,k]),maxiter);var QH2=numeric.QRFrancis(numeric.getBlock(H,[k+1,k+1],[m-1,m-1]),maxiter);B=Array(k+1);for(i=0;i<=k;i++){B[i]=Q[i]}C=numeric.dot(QH1.Q,B);for(i=0;i<=k;i++){Q[i]=C[i]}B=Array(m-k-1);for(i=k+1;i<m;i++){B[i-k-1]=Q[i]}C=numeric.dot(QH2.Q,B);for(i=k+1;i<m;i++){Q[i]=C[i-k-1]}return{Q:Q,B:QH1.B.concat(numeric.add(QH2.B,k+1))}}}J=Math.min(m-1,j+3);x=Array(J-j);for(i=j+1;i<=J;i++){x[i-j-1]=H[i][j]}v=numeric.house(x);B=numeric.getBlock(H,[j+1,j],[J,m-1]);C=numeric.tensor(v,numeric.dot(v,B));for(i=j+1;i<=J;i++){Hi=H[i];Ci=C[i-j-1];for(k=j;k<m;k++)Hi[k]-=2*Ci[k-j]}B=numeric.getBlock(H,[0,j+1],[m-1,J]);C=numeric.tensor(numeric.dot(B,v),v);for(i=0;i<m;i++){Hi=H[i];Ci=C[i];for(k=j+1;k<=J;k++)Hi[k]-=2*Ci[k-j-1]}B=Array(J-j);for(i=j+1;i<=J;i++)B[i-j-1]=Q[i];C=numeric.tensor(v,numeric.dot(v,B));for(i=j+1;i<=J;i++){Qi=Q[i];Ci=C[i-j-1];for(k=0;k<m;k++)Qi[k]-=2*Ci[k]}}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")};numeric.eig=function eig(A,maxiter){var QH=numeric.toUpperHessenberg(A);var QB=numeric.QRFrancis(QH.H,maxiter);var T=numeric.T;var n=A.length,i,k,flag=false,B=QB.B,H=numeric.dot(QB.Q,numeric.dot(QH.H,numeric.transpose(QB.Q)));var Q=new T(numeric.dot(QB.Q,QH.Q)),Q0;var m=B.length,j;var a,b,c,d,p1,p2,disc,x,y,p,q,n1,n2;var sqrt=Math.sqrt;for(k=0;k<m;k++){i=B[k][0];if(i===B[k][1]){}else{j=i+1;a=H[i][i];b=H[i][j];c=H[j][i];d=H[j][j];if(b===0&&c===0)continue;p1=-a-d;p2=a*d-b*c;disc=p1*p1-4*p2;if(disc>=0){if(p1<0)x=-.5*(p1-sqrt(disc));else x=-.5*(p1+sqrt(disc));n1=(a-x)*(a-x)+b*b;n2=c*c+(d-x)*(d-x);if(n1>n2){n1=sqrt(n1);p=(a-x)/n1;q=b/n1}else{n2=sqrt(n2);p=c/n2;q=(d-x)/n2}Q0=new T([[q,-p],[p,q]]);Q.setRows(i,j,Q0.dot(Q.getRows(i,j)))}else{x=-.5*p1;y=.5*sqrt(-disc);n1=(a-x)*(a-x)+b*b;n2=c*c+(d-x)*(d-x);if(n1>n2){n1=sqrt(n1+y*y);p=(a-x)/n1;q=b/n1;x=0;y/=n1}else{n2=sqrt(n2+y*y);p=c/n2;q=(d-x)/n2;x=y/n2;y=0}Q0=new T([[q,-p],[p,q]],[[x,y],[y,-x]]);Q.setRows(i,j,Q0.dot(Q.getRows(i,j)))}}}var R=Q.dot(A).dot(Q.transjugate()),n=A.length,E=numeric.T.identity(n);for(j=0;j<n;j++){if(j>0){for(k=j-1;k>=0;k--){var Rk=R.get([k,k]),Rj=R.get([j,j]);if(numeric.neq(Rk.x,Rj.x)||numeric.neq(Rk.y,Rj.y)){x=R.getRow(k).getBlock([k],[j-1]);y=E.getRow(j).getBlock([k],[j-1]);E.set([j,k],R.get([k,j]).neg().sub(x.dot(y)).div(Rk.sub(Rj)))}else{E.setRow(j,E.getRow(k));continue}}}}for(j=0;j<n;j++){x=E.getRow(j);E.setRow(j,x.div(x.norm2()))}E=E.transpose();E=Q.transjugate().dot(E);return{lambda:R.getDiag(),E:E}};numeric.ccsSparse=function ccsSparse(A){var m=A.length,n,foo,i,j,counts=[];for(i=m-1;i!==-1;--i){foo=A[i];for(j in foo){j=parseInt(j);while(j>=counts.length)counts[counts.length]=0;if(foo[j]!==0)counts[j]++}}var n=counts.length;var Ai=Array(n+1);Ai[0]=0;for(i=0;i<n;++i)Ai[i+1]=Ai[i]+counts[i];var Aj=Array(Ai[n]),Av=Array(Ai[n]);for(i=m-1;i!==-1;--i){foo=A[i];for(j in foo){if(foo[j]!==0){counts[j]--;Aj[Ai[j]+counts[j]]=i;Av[Ai[j]+counts[j]]=foo[j]}}}return[Ai,Aj,Av]};numeric.ccsFull=function ccsFull(A){var Ai=A[0],Aj=A[1],Av=A[2],s=numeric.ccsDim(A),m=s[0],n=s[1],i,j,j0,j1,k;var B=numeric.rep([m,n],0);for(i=0;i<n;i++){j0=Ai[i];j1=Ai[i+1];for(j=j0;j<j1;++j){B[Aj[j]][i]=Av[j]}}return B};numeric.ccsTSolve=function ccsTSolve(A,b,x,bj,xj){var Ai=A[0],Aj=A[1],Av=A[2],m=Ai.length-1,max=Math.max,n=0;if(typeof bj==="undefined")x=numeric.rep([m],0);if(typeof bj==="undefined")bj=numeric.linspace(0,x.length-1);if(typeof xj==="undefined")xj=[];function dfs(j){var k;if(x[j]!==0)return;x[j]=1;for(k=Ai[j];k<Ai[j+1];++k)dfs(Aj[k]);xj[n]=j;++n}var i,j,j0,j1,k,l,l0,l1,a;for(i=bj.length-1;i!==-1;--i){dfs(bj[i])}xj.length=n;for(i=xj.length-1;i!==-1;--i){x[xj[i]]=0}for(i=bj.length-1;i!==-1;--i){j=bj[i];x[j]=b[j]}for(i=xj.length-1;i!==-1;--i){j=xj[i];j0=Ai[j];j1=max(Ai[j+1],j0);for(k=j0;k!==j1;++k){if(Aj[k]===j){x[j]/=Av[k];break}}a=x[j];for(k=j0;k!==j1;++k){l=Aj[k];if(l!==j)x[l]-=a*Av[k]}}return x};numeric.ccsDFS=function ccsDFS(n){this.k=Array(n);this.k1=Array(n);this.j=Array(n)};numeric.ccsDFS.prototype.dfs=function dfs(J,Ai,Aj,x,xj,Pinv){var m=0,foo,n=xj.length;var k=this.k,k1=this.k1,j=this.j,km,k11;if(x[J]!==0)return;x[J]=1;j[0]=J;k[0]=km=Ai[J];k1[0]=k11=Ai[J+1];while(1){if(km>=k11){xj[n]=j[m];if(m===0)return;++n;--m;km=k[m];k11=k1[m]}else{foo=Pinv[Aj[km]];if(x[foo]===0){x[foo]=1;k[m]=km;++m;j[m]=foo;km=Ai[foo];k1[m]=k11=Ai[foo+1]}else++km}}};numeric.ccsLPSolve=function ccsLPSolve(A,B,x,xj,I,Pinv,dfs){var Ai=A[0],Aj=A[1],Av=A[2],m=Ai.length-1,n=0;var Bi=B[0],Bj=B[1],Bv=B[2];var i,i0,i1,j,J,j0,j1,k,l,l0,l1,a;i0=Bi[I];i1=Bi[I+1];xj.length=0;for(i=i0;i<i1;++i){dfs.dfs(Pinv[Bj[i]],Ai,Aj,x,xj,Pinv)}for(i=xj.length-1;i!==-1;--i){x[xj[i]]=0
}for(i=i0;i!==i1;++i){j=Pinv[Bj[i]];x[j]=Bv[i]}for(i=xj.length-1;i!==-1;--i){j=xj[i];j0=Ai[j];j1=Ai[j+1];for(k=j0;k<j1;++k){if(Pinv[Aj[k]]===j){x[j]/=Av[k];break}}a=x[j];for(k=j0;k<j1;++k){l=Pinv[Aj[k]];if(l!==j)x[l]-=a*Av[k]}}return x};numeric.ccsLUP1=function ccsLUP1(A,threshold){var m=A[0].length-1;var L=[numeric.rep([m+1],0),[],[]],U=[numeric.rep([m+1],0),[],[]];var Li=L[0],Lj=L[1],Lv=L[2],Ui=U[0],Uj=U[1],Uv=U[2];var x=numeric.rep([m],0),xj=numeric.rep([m],0);var i,j,k,j0,j1,a,e,c,d,K;var sol=numeric.ccsLPSolve,max=Math.max,abs=Math.abs;var P=numeric.linspace(0,m-1),Pinv=numeric.linspace(0,m-1);var dfs=new numeric.ccsDFS(m);if(typeof threshold==="undefined"){threshold=1}for(i=0;i<m;++i){sol(L,A,x,xj,i,Pinv,dfs);a=-1;e=-1;for(j=xj.length-1;j!==-1;--j){k=xj[j];if(k<=i)continue;c=abs(x[k]);if(c>a){e=k;a=c}}if(abs(x[i])<threshold*a){j=P[i];a=P[e];P[i]=a;Pinv[a]=i;P[e]=j;Pinv[j]=e;a=x[i];x[i]=x[e];x[e]=a}a=Li[i];e=Ui[i];d=x[i];Lj[a]=P[i];Lv[a]=1;++a;for(j=xj.length-1;j!==-1;--j){k=xj[j];c=x[k];xj[j]=0;x[k]=0;if(k<=i){Uj[e]=k;Uv[e]=c;++e}else{Lj[a]=P[k];Lv[a]=c/d;++a}}Li[i+1]=a;Ui[i+1]=e}for(j=Lj.length-1;j!==-1;--j){Lj[j]=Pinv[Lj[j]]}return{L:L,U:U,P:P,Pinv:Pinv}};numeric.ccsDFS0=function ccsDFS0(n){this.k=Array(n);this.k1=Array(n);this.j=Array(n)};numeric.ccsDFS0.prototype.dfs=function dfs(J,Ai,Aj,x,xj,Pinv,P){var m=0,foo,n=xj.length;var k=this.k,k1=this.k1,j=this.j,km,k11;if(x[J]!==0)return;x[J]=1;j[0]=J;k[0]=km=Ai[Pinv[J]];k1[0]=k11=Ai[Pinv[J]+1];while(1){if(isNaN(km))throw new Error("Ow!");if(km>=k11){xj[n]=Pinv[j[m]];if(m===0)return;++n;--m;km=k[m];k11=k1[m]}else{foo=Aj[km];if(x[foo]===0){x[foo]=1;k[m]=km;++m;j[m]=foo;foo=Pinv[foo];km=Ai[foo];k1[m]=k11=Ai[foo+1]}else++km}}};numeric.ccsLPSolve0=function ccsLPSolve0(A,B,y,xj,I,Pinv,P,dfs){var Ai=A[0],Aj=A[1],Av=A[2],m=Ai.length-1,n=0;var Bi=B[0],Bj=B[1],Bv=B[2];var i,i0,i1,j,J,j0,j1,k,l,l0,l1,a;i0=Bi[I];i1=Bi[I+1];xj.length=0;for(i=i0;i<i1;++i){dfs.dfs(Bj[i],Ai,Aj,y,xj,Pinv,P)}for(i=xj.length-1;i!==-1;--i){j=xj[i];y[P[j]]=0}for(i=i0;i!==i1;++i){j=Bj[i];y[j]=Bv[i]}for(i=xj.length-1;i!==-1;--i){j=xj[i];l=P[j];j0=Ai[j];j1=Ai[j+1];for(k=j0;k<j1;++k){if(Aj[k]===l){y[l]/=Av[k];break}}a=y[l];for(k=j0;k<j1;++k)y[Aj[k]]-=a*Av[k];y[l]=a}};numeric.ccsLUP0=function ccsLUP0(A,threshold){var m=A[0].length-1;var L=[numeric.rep([m+1],0),[],[]],U=[numeric.rep([m+1],0),[],[]];var Li=L[0],Lj=L[1],Lv=L[2],Ui=U[0],Uj=U[1],Uv=U[2];var y=numeric.rep([m],0),xj=numeric.rep([m],0);var i,j,k,j0,j1,a,e,c,d,K;var sol=numeric.ccsLPSolve0,max=Math.max,abs=Math.abs;var P=numeric.linspace(0,m-1),Pinv=numeric.linspace(0,m-1);var dfs=new numeric.ccsDFS0(m);if(typeof threshold==="undefined"){threshold=1}for(i=0;i<m;++i){sol(L,A,y,xj,i,Pinv,P,dfs);a=-1;e=-1;for(j=xj.length-1;j!==-1;--j){k=xj[j];if(k<=i)continue;c=abs(y[P[k]]);if(c>a){e=k;a=c}}if(abs(y[P[i]])<threshold*a){j=P[i];a=P[e];P[i]=a;Pinv[a]=i;P[e]=j;Pinv[j]=e}a=Li[i];e=Ui[i];d=y[P[i]];Lj[a]=P[i];Lv[a]=1;++a;for(j=xj.length-1;j!==-1;--j){k=xj[j];c=y[P[k]];xj[j]=0;y[P[k]]=0;if(k<=i){Uj[e]=k;Uv[e]=c;++e}else{Lj[a]=P[k];Lv[a]=c/d;++a}}Li[i+1]=a;Ui[i+1]=e}for(j=Lj.length-1;j!==-1;--j){Lj[j]=Pinv[Lj[j]]}return{L:L,U:U,P:P,Pinv:Pinv}};numeric.ccsLUP=numeric.ccsLUP0;numeric.ccsDim=function ccsDim(A){return[numeric.sup(A[1])+1,A[0].length-1]};numeric.ccsGetBlock=function ccsGetBlock(A,i,j){var s=numeric.ccsDim(A),m=s[0],n=s[1];if(typeof i==="undefined"){i=numeric.linspace(0,m-1)}else if(typeof i==="number"){i=[i]}if(typeof j==="undefined"){j=numeric.linspace(0,n-1)}else if(typeof j==="number"){j=[j]}var p,p0,p1,P=i.length,q,Q=j.length,r,jq,ip;var Bi=numeric.rep([n],0),Bj=[],Bv=[],B=[Bi,Bj,Bv];var Ai=A[0],Aj=A[1],Av=A[2];var x=numeric.rep([m],0),count=0,flags=numeric.rep([m],0);for(q=0;q<Q;++q){jq=j[q];var q0=Ai[jq];var q1=Ai[jq+1];for(p=q0;p<q1;++p){r=Aj[p];flags[r]=1;x[r]=Av[p]}for(p=0;p<P;++p){ip=i[p];if(flags[ip]){Bj[count]=p;Bv[count]=x[i[p]];++count}}for(p=q0;p<q1;++p){r=Aj[p];flags[r]=0}Bi[q+1]=count}return B};numeric.ccsDot=function ccsDot(A,B){var Ai=A[0],Aj=A[1],Av=A[2];var Bi=B[0],Bj=B[1],Bv=B[2];var sA=numeric.ccsDim(A),sB=numeric.ccsDim(B);var m=sA[0],n=sA[1],o=sB[1];var x=numeric.rep([m],0),flags=numeric.rep([m],0),xj=Array(m);var Ci=numeric.rep([o],0),Cj=[],Cv=[],C=[Ci,Cj,Cv];var i,j,k,j0,j1,i0,i1,l,p,a,b;for(k=0;k!==o;++k){j0=Bi[k];j1=Bi[k+1];p=0;for(j=j0;j<j1;++j){a=Bj[j];b=Bv[j];i0=Ai[a];i1=Ai[a+1];for(i=i0;i<i1;++i){l=Aj[i];if(flags[l]===0){xj[p]=l;flags[l]=1;p=p+1}x[l]=x[l]+Av[i]*b}}j0=Ci[k];j1=j0+p;Ci[k+1]=j1;for(j=p-1;j!==-1;--j){b=j0+j;i=xj[j];Cj[b]=i;Cv[b]=x[i];flags[i]=0;x[i]=0}Ci[k+1]=Ci[k]+p}return C};numeric.ccsLUPSolve=function ccsLUPSolve(LUP,B){var L=LUP.L,U=LUP.U,P=LUP.P;var Bi=B[0];var flag=false;if(typeof Bi!=="object"){B=[[0,B.length],numeric.linspace(0,B.length-1),B];Bi=B[0];flag=true}var Bj=B[1],Bv=B[2];var n=L[0].length-1,m=Bi.length-1;var x=numeric.rep([n],0),xj=Array(n);var b=numeric.rep([n],0),bj=Array(n);var Xi=numeric.rep([m+1],0),Xj=[],Xv=[];var sol=numeric.ccsTSolve;var i,j,j0,j1,k,J,N=0;for(i=0;i<m;++i){k=0;j0=Bi[i];j1=Bi[i+1];for(j=j0;j<j1;++j){J=LUP.Pinv[Bj[j]];bj[k]=J;b[J]=Bv[j];++k}bj.length=k;sol(L,b,x,bj,xj);for(j=bj.length-1;j!==-1;--j)b[bj[j]]=0;sol(U,x,b,xj,bj);if(flag)return b;for(j=xj.length-1;j!==-1;--j)x[xj[j]]=0;for(j=bj.length-1;j!==-1;--j){J=bj[j];Xj[N]=J;Xv[N]=b[J];b[J]=0;++N}Xi[i+1]=N}return[Xi,Xj,Xv]};numeric.ccsbinop=function ccsbinop(body,setup){if(typeof setup==="undefined")setup="";return Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\n"+"var Yi = Y[0], Yj = Y[1], Yv = Y[2];\n"+"var n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\n"+"var Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\n"+"var x = numeric.rep([m],0),y = numeric.rep([m],0);\n"+"var xk,yk,zk;\n"+"var i,j,j0,j1,k,p=0;\n"+setup+"for(i=0;i<n;++i) {\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Xj[j];\n"+"    x[k] = 1;\n"+"    Zj[p] = k;\n"+"    ++p;\n"+"  }\n"+"  j0 = Yi[i]; j1 = Yi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Yj[j];\n"+"    y[k] = Yv[j];\n"+"    if(x[k] === 0) {\n"+"      Zj[p] = k;\n"+"      ++p;\n"+"    }\n"+"  }\n"+"  Zi[i+1] = p;\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n"+"  j0 = Zi[i]; j1 = Zi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Zj[j];\n"+"    xk = x[k];\n"+"    yk = y[k];\n"+body+"\n"+"    Zv[j] = zk;\n"+"  }\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n"+"  j0 = Yi[i]; j1 = Yi[i+1];\n"+"  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n"+"}\n"+"return [Zi,Zj,Zv];")};(function(){var k,A,B,C;for(k in numeric.ops2){if(isFinite(eval("1"+numeric.ops2[k]+"0")))A="[Y[0],Y[1],numeric."+k+"(X,Y[2])]";else A="NaN";if(isFinite(eval("0"+numeric.ops2[k]+"1")))B="[X[0],X[1],numeric."+k+"(X[2],Y)]";else B="NaN";if(isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1")))C="numeric.ccs"+k+"MM(X,Y)";else C="NaN";numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;");numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+";\n"+'if(typeof Y === "number") return '+B+";\n"+"return "+C+";\n")}})();numeric.ccsScatter=function ccsScatter(A){var Ai=A[0],Aj=A[1],Av=A[2];var n=numeric.sup(Aj)+1,m=Ai.length;var Ri=numeric.rep([n],0),Rj=Array(m),Rv=Array(m);var counts=numeric.rep([n],0),i;for(i=0;i<m;++i)counts[Aj[i]]++;for(i=0;i<n;++i)Ri[i+1]=Ri[i]+counts[i];var ptr=Ri.slice(0),k,Aii;for(i=0;i<m;++i){Aii=Aj[i];k=ptr[Aii];Rj[k]=Ai[i];Rv[k]=Av[i];ptr[Aii]=ptr[Aii]+1}return[Ri,Rj,Rv]};numeric.ccsGather=function ccsGather(A){var Ai=A[0],Aj=A[1],Av=A[2];var n=Ai.length-1,m=Aj.length;var Ri=Array(m),Rj=Array(m),Rv=Array(m);var i,j,j0,j1,p;p=0;for(i=0;i<n;++i){j0=Ai[i];j1=Ai[i+1];for(j=j0;j!==j1;++j){Rj[p]=i;Ri[p]=Aj[j];Rv[p]=Av[j];++p}}return[Ri,Rj,Rv]};numeric.sdim=function dim(A,ret,k){if(typeof ret==="undefined"){ret=[]}if(typeof A!=="object")return ret;if(typeof k==="undefined"){k=0}if(!(k in ret)){ret[k]=0}if(A.length>ret[k])ret[k]=A.length;var i;for(i in A){if(A.hasOwnProperty(i))dim(A[i],ret,k+1)}return ret};numeric.sclone=function clone(A,k,n){if(typeof k==="undefined"){k=0}if(typeof n==="undefined"){n=numeric.sdim(A).length}var i,ret=Array(A.length);if(k===n-1){for(i in A){if(A.hasOwnProperty(i))ret[i]=A[i]}return ret}for(i in A){if(A.hasOwnProperty(i))ret[i]=clone(A[i],k+1,n)}return ret};numeric.sdiag=function diag(d){var n=d.length,i,ret=Array(n),i1,i2,i3;for(i=n-1;i>=1;i-=2){i1=i-1;ret[i]=[];ret[i][i]=d[i];ret[i1]=[];ret[i1][i1]=d[i1]}if(i===0){ret[0]=[];ret[0][0]=d[i]}return ret};numeric.sidentity=function identity(n){return numeric.sdiag(numeric.rep([n],1))};numeric.stranspose=function transpose(A){var ret=[],n=A.length,i,j,Ai;for(i in A){if(!A.hasOwnProperty(i))continue;Ai=A[i];for(j in Ai){if(!Ai.hasOwnProperty(j))continue;if(typeof ret[j]!=="object"){ret[j]=[]}ret[j][i]=Ai[j]}}return ret};numeric.sLUP=function LUP(A,tol){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")};numeric.sdotMM=function dotMM(A,B){var p=A.length,q=B.length,BT=numeric.stranspose(B),r=BT.length,Ai,BTk;var i,j,k,accum;var ret=Array(p),reti;for(i=p-1;i>=0;i--){reti=[];Ai=A[i];for(k=r-1;k>=0;k--){accum=0;BTk=BT[k];for(j in Ai){if(!Ai.hasOwnProperty(j))continue;if(j in BTk){accum+=Ai[j]*BTk[j]}}if(accum)reti[k]=accum}ret[i]=reti}return ret};numeric.sdotMV=function dotMV(A,x){var p=A.length,Ai,i,j;var ret=Array(p),accum;for(i=p-1;i>=0;i--){Ai=A[i];accum=0;for(j in Ai){if(!Ai.hasOwnProperty(j))continue;if(x[j])accum+=Ai[j]*x[j]}if(accum)ret[i]=accum}return ret};numeric.sdotVM=function dotMV(x,A){var i,j,Ai,alpha;var ret=[],accum;for(i in x){if(!x.hasOwnProperty(i))continue;Ai=A[i];alpha=x[i];for(j in Ai){if(!Ai.hasOwnProperty(j))continue;if(!ret[j]){ret[j]=0}ret[j]+=alpha*Ai[j]}}return ret};numeric.sdotVV=function dotVV(x,y){var i,ret=0;for(i in x){if(x[i]&&y[i])ret+=x[i]*y[i]}return ret};numeric.sdot=function dot(A,B){var m=numeric.sdim(A).length,n=numeric.sdim(B).length;var k=m*1e3+n;switch(k){case 0:return A*B;case 1001:return numeric.sdotVV(A,B);case 2001:return numeric.sdotMV(A,B);case 1002:return numeric.sdotVM(A,B);case 2002:return numeric.sdotMM(A,B);default:throw new Error("numeric.sdot not implemented for tensors of order "+m+" and "+n)}};numeric.sscatter=function scatter(V){var n=V[0].length,Vij,i,j,m=V.length,A=[],Aj;for(i=n-1;i>=0;--i){if(!V[m-1][i])continue;Aj=A;for(j=0;j<m-2;j++){Vij=V[j][i];if(!Aj[Vij])Aj[Vij]=[];Aj=Aj[Vij]}Aj[V[j][i]]=V[j+1][i]}return A};numeric.sgather=function gather(A,ret,k){if(typeof ret==="undefined")ret=[];if(typeof k==="undefined")k=[];var n,i,Ai;n=k.length;for(i in A){if(A.hasOwnProperty(i)){k[n]=parseInt(i);Ai=A[i];if(typeof Ai==="number"){if(Ai){if(ret.length===0){for(i=n+1;i>=0;--i)ret[i]=[]}for(i=n;i>=0;--i)ret[i].push(k[i]);ret[n+1].push(Ai)}}else gather(Ai,ret,k)}}if(k.length>n)k.pop();return ret};numeric.cLU=function LU(A){var I=A[0],J=A[1],V=A[2];var p=I.length,m=0,i,j,k,a,b,c;for(i=0;i<p;i++)if(I[i]>m)m=I[i];m++;var L=Array(m),U=Array(m),left=numeric.rep([m],Infinity),right=numeric.rep([m],-Infinity);var Ui,Uj,alpha;for(k=0;k<p;k++){i=I[k];j=J[k];if(j<left[i])left[i]=j;if(j>right[i])right[i]=j}for(i=0;i<m-1;i++){if(right[i]>right[i+1])right[i+1]=right[i]}for(i=m-1;i>=1;i--){if(left[i]<left[i-1])left[i-1]=left[i]}var countL=0,countU=0;for(i=0;i<m;i++){U[i]=numeric.rep([right[i]-left[i]+1],0);L[i]=numeric.rep([i-left[i]],0);countL+=i-left[i]+1;countU+=right[i]-i+1}for(k=0;k<p;k++){i=I[k];U[i][J[k]-left[i]]=V[k]}for(i=0;i<m-1;i++){a=i-left[i];Ui=U[i];for(j=i+1;left[j]<=i&&j<m;j++){b=i-left[j];c=right[i]-i;Uj=U[j];alpha=Uj[b]/Ui[a];if(alpha){for(k=1;k<=c;k++){Uj[k+b]-=alpha*Ui[k+a]}L[j][i-left[j]]=alpha}}}var Ui=[],Uj=[],Uv=[],Li=[],Lj=[],Lv=[];var p,q,foo;p=0;q=0;for(i=0;i<m;i++){a=left[i];b=right[i];foo=U[i];for(j=i;j<=b;j++){if(foo[j-a]){Ui[p]=i;Uj[p]=j;Uv[p]=foo[j-a];p++}}foo=L[i];for(j=a;j<i;j++){if(foo[j-a]){Li[q]=i;Lj[q]=j;Lv[q]=foo[j-a];q++}}Li[q]=i;Lj[q]=i;Lv[q]=1;q++}return{U:[Ui,Uj,Uv],L:[Li,Lj,Lv]}};numeric.cLUsolve=function LUsolve(lu,b){var L=lu.L,U=lu.U,ret=numeric.clone(b);var Li=L[0],Lj=L[1],Lv=L[2];var Ui=U[0],Uj=U[1],Uv=U[2];var p=Ui.length,q=Li.length;var m=ret.length,i,j,k;k=0;for(i=0;i<m;i++){while(Lj[k]<i){ret[i]-=Lv[k]*ret[Lj[k]];k++}k++}k=p-1;for(i=m-1;i>=0;i--){while(Uj[k]>i){ret[i]-=Uv[k]*ret[Uj[k]];k--}ret[i]/=Uv[k];k--}return ret};numeric.cgrid=function grid(n,shape){if(typeof n==="number")n=[n,n];var ret=numeric.rep(n,-1);var i,j,count;if(typeof shape!=="function"){switch(shape){case"L":shape=function(i,j){return i>=n[0]/2||j<n[1]/2};break;default:shape=function(i,j){return true};break}}count=0;for(i=1;i<n[0]-1;i++)for(j=1;j<n[1]-1;j++)if(shape(i,j)){ret[i][j]=count;count++}return ret};numeric.cdelsq=function delsq(g){var dir=[[-1,0],[0,-1],[0,1],[1,0]];var s=numeric.dim(g),m=s[0],n=s[1],i,j,k,p,q;var Li=[],Lj=[],Lv=[];for(i=1;i<m-1;i++)for(j=1;j<n-1;j++){if(g[i][j]<0)continue;for(k=0;k<4;k++){p=i+dir[k][0];q=j+dir[k][1];if(g[p][q]<0)continue;Li.push(g[i][j]);Lj.push(g[p][q]);Lv.push(-1)}Li.push(g[i][j]);Lj.push(g[i][j]);Lv.push(4)}return[Li,Lj,Lv]};numeric.cdotMV=function dotMV(A,x){var ret,Ai=A[0],Aj=A[1],Av=A[2],k,p=Ai.length,N;N=0;for(k=0;k<p;k++){if(Ai[k]>N)N=Ai[k]}N++;ret=numeric.rep([N],0);for(k=0;k<p;k++){ret[Ai[k]]+=Av[k]*x[Aj[k]]}return ret};numeric.Spline=function Spline(x,yl,yr,kl,kr){this.x=x;this.yl=yl;this.yr=yr;this.kl=kl;this.kr=kr};numeric.Spline.prototype._at=function _at(x1,p){var x=this.x;var yl=this.yl;var yr=this.yr;var kl=this.kl;var kr=this.kr;var x1,a,b,t;var add=numeric.add,sub=numeric.sub,mul=numeric.mul;a=sub(mul(kl[p],x[p+1]-x[p]),sub(yr[p+1],yl[p]));b=add(mul(kr[p+1],x[p]-x[p+1]),sub(yr[p+1],yl[p]));t=(x1-x[p])/(x[p+1]-x[p]);var s=t*(1-t);return add(add(add(mul(1-t,yl[p]),mul(t,yr[p+1])),mul(a,s*(1-t))),mul(b,s*t))};numeric.Spline.prototype.at=function at(x0){if(typeof x0==="number"){var x=this.x;var n=x.length;var p,q,mid,floor=Math.floor,a,b,t;p=0;q=n-1;while(q-p>1){mid=floor((p+q)/2);if(x[mid]<=x0)p=mid;else q=mid}return this._at(x0,p)}var n=x0.length,i,ret=Array(n);for(i=n-1;i!==-1;--i)ret[i]=this.at(x0[i]);return ret};numeric.Spline.prototype.diff=function diff(){var x=this.x;var yl=this.yl;var yr=this.yr;var kl=this.kl;var kr=this.kr;var n=yl.length;var i,dx,dy;var zl=kl,zr=kr,pl=Array(n),pr=Array(n);var add=numeric.add,mul=numeric.mul,div=numeric.div,sub=numeric.sub;for(i=n-1;i!==-1;--i){dx=x[i+1]-x[i];dy=sub(yr[i+1],yl[i]);pl[i]=div(add(mul(dy,6),mul(kl[i],-4*dx),mul(kr[i+1],-2*dx)),dx*dx);pr[i+1]=div(add(mul(dy,-6),mul(kl[i],2*dx),mul(kr[i+1],4*dx)),dx*dx)}return new numeric.Spline(x,zl,zr,pl,pr)};numeric.Spline.prototype.roots=function roots(){function sqr(x){return x*x}function heval(y0,y1,k0,k1,x){var A=k0*2-(y1-y0);var B=-k1*2+(y1-y0);var t=(x+1)*.5;var s=t*(1-t);return(1-t)*y0+t*y1+A*s*(1-t)+B*s*t}var ret=[];var x=this.x,yl=this.yl,yr=this.yr,kl=this.kl,kr=this.kr;if(typeof yl[0]==="number"){yl=[yl];yr=[yr];kl=[kl];kr=[kr]}var m=yl.length,n=x.length-1,i,j,k,y,s,t;var ai,bi,ci,di,ret=Array(m),ri,k0,k1,y0,y1,A,B,D,dx,cx,stops,z0,z1,zm,t0,t1,tm;var sqrt=Math.sqrt;for(i=0;i!==m;++i){ai=yl[i];bi=yr[i];ci=kl[i];di=kr[i];ri=[];for(j=0;j!==n;j++){if(j>0&&bi[j]*ai[j]<0)ri.push(x[j]);dx=x[j+1]-x[j];cx=x[j];y0=ai[j];y1=bi[j+1];k0=ci[j]/dx;k1=di[j+1]/dx;D=sqr(k0-k1+3*(y0-y1))+12*k1*y0;A=k1+3*y0+2*k0-3*y1;B=3*(k1+k0+2*(y0-y1));if(D<=0){z0=A/B;if(z0>x[j]&&z0<x[j+1])stops=[x[j],z0,x[j+1]];else stops=[x[j],x[j+1]]}else{z0=(A-sqrt(D))/B;z1=(A+sqrt(D))/B;stops=[x[j]];if(z0>x[j]&&z0<x[j+1])stops.push(z0);if(z1>x[j]&&z1<x[j+1])stops.push(z1);stops.push(x[j+1])}t0=stops[0];z0=this._at(t0,j);for(k=0;k<stops.length-1;k++){t1=stops[k+1];z1=this._at(t1,j);if(z0===0){ri.push(t0);t0=t1;z0=z1;continue}if(z1===0||z0*z1>0){t0=t1;z0=z1;continue}var side=0;while(1){tm=(z0*t1-z1*t0)/(z0-z1);if(tm<=t0||tm>=t1){break}zm=this._at(tm,j);if(zm*z1>0){t1=tm;z1=zm;if(side===-1)z0*=.5;side=-1}else if(zm*z0>0){t0=tm;z0=zm;if(side===1)z1*=.5;side=1}else break}ri.push(tm);t0=stops[k+1];z0=this._at(t0,j)}if(z1===0)ri.push(t1)}ret[i]=ri}if(typeof this.yl[0]==="number")return ret[0];return ret};numeric.spline=function spline(x,y,k1,kn){var n=x.length,b=[],dx=[],dy=[];var i;var sub=numeric.sub,mul=numeric.mul,add=numeric.add;for(i=n-2;i>=0;i--){dx[i]=x[i+1]-x[i];dy[i]=sub(y[i+1],y[i])}if(typeof k1==="string"||typeof kn==="string"){k1=kn="periodic"}var T=[[],[],[]];switch(typeof k1){case"undefined":b[0]=mul(3/(dx[0]*dx[0]),dy[0]);T[0].push(0,0);T[1].push(0,1);T[2].push(2/dx[0],1/dx[0]);break;case"string":b[0]=add(mul(3/(dx[n-2]*dx[n-2]),dy[n-2]),mul(3/(dx[0]*dx[0]),dy[0]));T[0].push(0,0,0);T[1].push(n-2,0,1);T[2].push(1/dx[n-2],2/dx[n-2]+2/dx[0],1/dx[0]);break;default:b[0]=k1;T[0].push(0);T[1].push(0);T[2].push(1);break}for(i=1;i<n-1;i++){b[i]=add(mul(3/(dx[i-1]*dx[i-1]),dy[i-1]),mul(3/(dx[i]*dx[i]),dy[i]));T[0].push(i,i,i);T[1].push(i-1,i,i+1);T[2].push(1/dx[i-1],2/dx[i-1]+2/dx[i],1/dx[i])}switch(typeof kn){case"undefined":b[n-1]=mul(3/(dx[n-2]*dx[n-2]),dy[n-2]);T[0].push(n-1,n-1);T[1].push(n-2,n-1);T[2].push(1/dx[n-2],2/dx[n-2]);break;case"string":T[1][T[1].length-1]=0;break;default:b[n-1]=kn;T[0].push(n-1);T[1].push(n-1);T[2].push(1);break}if(typeof b[0]!=="number")b=numeric.transpose(b);else b=[b];var k=Array(b.length);if(typeof k1==="string"){for(i=k.length-1;i!==-1;--i){k[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(T)),b[i]);k[i][n-1]=k[i][0]}}else{for(i=k.length-1;i!==-1;--i){k[i]=numeric.cLUsolve(numeric.cLU(T),b[i])}}if(typeof y[0]==="number")k=k[0];else k=numeric.transpose(k);return new numeric.Spline(x,y,y,k,k)};numeric.fftpow2=function fftpow2(x,y){var n=x.length;if(n===1)return;var cos=Math.cos,sin=Math.sin,i,j;var xe=Array(n/2),ye=Array(n/2),xo=Array(n/2),yo=Array(n/2);j=n/2;for(i=n-1;i!==-1;--i){--j;xo[j]=x[i];yo[j]=y[i];--i;xe[j]=x[i];ye[j]=y[i]}fftpow2(xe,ye);fftpow2(xo,yo);j=n/2;var t,k=-6.283185307179586/n,ci,si;for(i=n-1;i!==-1;--i){--j;if(j===-1)j=n/2-1;t=k*i;ci=cos(t);si=sin(t);x[i]=xe[j]+ci*xo[j]-si*yo[j];y[i]=ye[j]+ci*yo[j]+si*xo[j]}};numeric._ifftpow2=function _ifftpow2(x,y){var n=x.length;if(n===1)return;var cos=Math.cos,sin=Math.sin,i,j;var xe=Array(n/2),ye=Array(n/2),xo=Array(n/2),yo=Array(n/2);j=n/2;for(i=n-1;i!==-1;--i){--j;xo[j]=x[i];yo[j]=y[i];--i;xe[j]=x[i];ye[j]=y[i]}_ifftpow2(xe,ye);_ifftpow2(xo,yo);j=n/2;var t,k=6.283185307179586/n,ci,si;for(i=n-1;i!==-1;--i){--j;if(j===-1)j=n/2-1;t=k*i;ci=cos(t);si=sin(t);x[i]=xe[j]+ci*xo[j]-si*yo[j];y[i]=ye[j]+ci*yo[j]+si*xo[j]}};numeric.ifftpow2=function ifftpow2(x,y){numeric._ifftpow2(x,y);numeric.diveq(x,x.length);numeric.diveq(y,y.length)};numeric.convpow2=function convpow2(ax,ay,bx,by){numeric.fftpow2(ax,ay);numeric.fftpow2(bx,by);var i,n=ax.length,axi,bxi,ayi,byi;for(i=n-1;i!==-1;--i){axi=ax[i];ayi=ay[i];bxi=bx[i];byi=by[i];ax[i]=axi*bxi-ayi*byi;ay[i]=axi*byi+ayi*bxi}numeric.ifftpow2(ax,ay)};numeric.T.prototype.fft=function fft(){var x=this.x,y=this.y;var n=x.length,log=Math.log,log2=log(2),p=Math.ceil(log(2*n-1)/log2),m=Math.pow(2,p);var cx=numeric.rep([m],0),cy=numeric.rep([m],0),cos=Math.cos,sin=Math.sin;var k,c=-3.141592653589793/n,t;var a=numeric.rep([m],0),b=numeric.rep([m],0),nhalf=Math.floor(n/2);for(k=0;k<n;k++)a[k]=x[k];if(typeof y!=="undefined")for(k=0;k<n;k++)b[k]=y[k];cx[0]=1;for(k=1;k<=m/2;k++){t=c*k*k;cx[k]=cos(t);cy[k]=sin(t);cx[m-k]=cos(t);cy[m-k]=sin(t)}var X=new numeric.T(a,b),Y=new numeric.T(cx,cy);X=X.mul(Y);numeric.convpow2(X.x,X.y,numeric.clone(Y.x),numeric.neg(Y.y));X=X.mul(Y);X.x.length=n;X.y.length=n;return X};numeric.T.prototype.ifft=function ifft(){var x=this.x,y=this.y;var n=x.length,log=Math.log,log2=log(2),p=Math.ceil(log(2*n-1)/log2),m=Math.pow(2,p);var cx=numeric.rep([m],0),cy=numeric.rep([m],0),cos=Math.cos,sin=Math.sin;var k,c=3.141592653589793/n,t;var a=numeric.rep([m],0),b=numeric.rep([m],0),nhalf=Math.floor(n/2);for(k=0;k<n;k++)a[k]=x[k];if(typeof y!=="undefined")for(k=0;k<n;k++)b[k]=y[k];cx[0]=1;for(k=1;k<=m/2;k++){t=c*k*k;cx[k]=cos(t);cy[k]=sin(t);cx[m-k]=cos(t);cy[m-k]=sin(t)}var X=new numeric.T(a,b),Y=new numeric.T(cx,cy);X=X.mul(Y);numeric.convpow2(X.x,X.y,numeric.clone(Y.x),numeric.neg(Y.y));X=X.mul(Y);X.x.length=n;X.y.length=n;return X.div(n)};numeric.gradient=function gradient(f,x){var n=x.length;var f0=f(x);if(isNaN(f0))throw new Error("gradient: f(x) is a NaN!");var max=Math.max;var i,x0=numeric.clone(x),f1,f2,J=Array(n);var div=numeric.div,sub=numeric.sub,errest,roundoff,max=Math.max,eps=.001,abs=Math.abs,min=Math.min;var t0,t1,t2,it=0,d1,d2,N;for(i=0;i<n;i++){var h=max(1e-6*f0,1e-8);while(1){++it;if(it>20){throw new Error("Numerical gradient fails")}x0[i]=x[i]+h;f1=f(x0);x0[i]=x[i]-h;f2=f(x0);x0[i]=x[i];if(isNaN(f1)||isNaN(f2)){h/=16;continue}J[i]=(f1-f2)/(2*h);t0=x[i]-h;t1=x[i];t2=x[i]+h;d1=(f1-f0)/h;d2=(f0-f2)/h;N=max(abs(J[i]),abs(f0),abs(f1),abs(f2),abs(t0),abs(t1),abs(t2),1e-8);errest=min(max(abs(d1-J[i]),abs(d2-J[i]),abs(d1-d2))/N,h/N);if(errest>eps){h/=16}else break}}return J};numeric.uncmin=function uncmin(f,x0,tol,gradient,maxit,callback,options){var grad=numeric.gradient;if(typeof options==="undefined"){options={}}if(typeof tol==="undefined"){tol=1e-8}if(typeof gradient==="undefined"){gradient=function(x){return grad(f,x)}}if(typeof maxit==="undefined")maxit=1e3;x0=numeric.clone(x0);var n=x0.length;var f0=f(x0),f1,df0;if(isNaN(f0))throw new Error("uncmin: f(x0) is a NaN!");var max=Math.max,norm2=numeric.norm2;tol=max(tol,numeric.epsilon);var step,g0,g1,H1=options.Hinv||numeric.identity(n);var dot=numeric.dot,inv=numeric.inv,sub=numeric.sub,add=numeric.add,ten=numeric.tensor,div=numeric.div,mul=numeric.mul;var all=numeric.all,isfinite=numeric.isFinite,neg=numeric.neg;var it=0,i,s,x1,y,Hy,Hs,ys,i0,t,nstep,t1,t2;var msg="";g0=gradient(x0);while(it<maxit){if(typeof callback==="function"){if(callback(it,x0,f0,g0,H1)){msg="Callback returned true";break}}if(!all(isfinite(g0))){msg="Gradient has Infinity or NaN";break}step=neg(dot(H1,g0));if(!all(isfinite(step))){msg="Search direction has Infinity or NaN";break}nstep=norm2(step);if(nstep<tol){msg="Newton step smaller than tol";break}t=1;df0=dot(g0,step);x1=x0;while(it<maxit){if(t*nstep<tol){break}s=mul(step,t);x1=add(x0,s);f1=f(x1);if(f1-f0>=.1*t*df0||isNaN(f1)){t*=.5;++it;continue}break}if(t*nstep<tol){msg="Line search step size smaller than tol";break}if(it===maxit){msg="maxit reached during line search";break}g1=gradient(x1);y=sub(g1,g0);ys=dot(y,s);Hy=dot(H1,y);H1=sub(add(H1,mul((ys+dot(y,Hy))/(ys*ys),ten(s,s))),div(add(ten(Hy,s),ten(s,Hy)),ys));x0=x1;f0=f1;g0=g1;++it}return{solution:x0,f:f0,gradient:g0,invHessian:H1,iterations:it,message:msg}};numeric.Dopri=function Dopri(x,y,f,ymid,iterations,msg,events){this.x=x;this.y=y;this.f=f;this.ymid=ymid;this.iterations=iterations;this.events=events;this.message=msg};numeric.Dopri.prototype._at=function _at(xi,j){function sqr(x){return x*x}var sol=this;var xs=sol.x;var ys=sol.y;var k1=sol.f;var ymid=sol.ymid;var n=xs.length;var x0,x1,xh,y0,y1,yh,xi;var floor=Math.floor,h;var c=.5;var add=numeric.add,mul=numeric.mul,sub=numeric.sub,p,q,w;x0=xs[j];x1=xs[j+1];y0=ys[j];y1=ys[j+1];h=x1-x0;xh=x0+c*h;yh=ymid[j];p=sub(k1[j],mul(y0,1/(x0-xh)+2/(x0-x1)));q=sub(k1[j+1],mul(y1,1/(x1-xh)+2/(x1-x0)));w=[sqr(xi-x1)*(xi-xh)/sqr(x0-x1)/(x0-xh),sqr(xi-x0)*sqr(xi-x1)/sqr(x0-xh)/sqr(x1-xh),sqr(xi-x0)*(xi-xh)/sqr(x1-x0)/(x1-xh),(xi-x0)*sqr(xi-x1)*(xi-xh)/sqr(x0-x1)/(x0-xh),(xi-x1)*sqr(xi-x0)*(xi-xh)/sqr(x0-x1)/(x1-xh)];return add(add(add(add(mul(y0,w[0]),mul(yh,w[1])),mul(y1,w[2])),mul(p,w[3])),mul(q,w[4]))};numeric.Dopri.prototype.at=function at(x){var i,j,k,floor=Math.floor;if(typeof x!=="number"){var n=x.length,ret=Array(n);for(i=n-1;i!==-1;--i){ret[i]=this.at(x[i])}return ret}var x0=this.x;i=0;j=x0.length-1;while(j-i>1){k=floor(.5*(i+j));if(x0[k]<=x)i=k;else j=k}return this._at(x,i)};numeric.dopri=function dopri(x0,x1,y0,f,tol,maxit,event){if(typeof tol==="undefined"){tol=1e-6}if(typeof maxit==="undefined"){maxit=1e3}var xs=[x0],ys=[y0],k1=[f(x0,y0)],k2,k3,k4,k5,k6,k7,ymid=[];var A2=1/5;var A3=[3/40,9/40];var A4=[44/45,-56/15,32/9];var A5=[19372/6561,-25360/2187,64448/6561,-212/729];var A6=[9017/3168,-355/33,46732/5247,49/176,-5103/18656];var b=[35/384,0,500/1113,125/192,-2187/6784,11/84];var bm=[.5*6025192743/30085553152,0,.5*51252292925/65400821598,.5*-2691868925/45128329728,.5*187940372067/1594534317056,.5*-1776094331/19743644256,.5*11237099/235043384];var c=[1/5,3/10,4/5,8/9,1,1];var e=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40];var i=0,er,j;var h=(x1-x0)/10;var it=0;var add=numeric.add,mul=numeric.mul,y1,erinf;var max=Math.max,min=Math.min,abs=Math.abs,norminf=numeric.norminf,pow=Math.pow;var any=numeric.any,lt=numeric.lt,and=numeric.and,sub=numeric.sub;var e0,e1,ev;var ret=new numeric.Dopri(xs,ys,k1,ymid,-1,"");if(typeof event==="function")e0=event(x0,y0);while(x0<x1&&it<maxit){++it;if(x0+h>x1)h=x1-x0;k2=f(x0+c[0]*h,add(y0,mul(A2*h,k1[i])));k3=f(x0+c[1]*h,add(add(y0,mul(A3[0]*h,k1[i])),mul(A3[1]*h,k2)));k4=f(x0+c[2]*h,add(add(add(y0,mul(A4[0]*h,k1[i])),mul(A4[1]*h,k2)),mul(A4[2]*h,k3)));k5=f(x0+c[3]*h,add(add(add(add(y0,mul(A5[0]*h,k1[i])),mul(A5[1]*h,k2)),mul(A5[2]*h,k3)),mul(A5[3]*h,k4)));k6=f(x0+c[4]*h,add(add(add(add(add(y0,mul(A6[0]*h,k1[i])),mul(A6[1]*h,k2)),mul(A6[2]*h,k3)),mul(A6[3]*h,k4)),mul(A6[4]*h,k5)));y1=add(add(add(add(add(y0,mul(k1[i],h*b[0])),mul(k3,h*b[2])),mul(k4,h*b[3])),mul(k5,h*b[4])),mul(k6,h*b[5]));k7=f(x0+h,y1);er=add(add(add(add(add(mul(k1[i],h*e[0]),mul(k3,h*e[2])),mul(k4,h*e[3])),mul(k5,h*e[4])),mul(k6,h*e[5])),mul(k7,h*e[6]));if(typeof er==="number")erinf=abs(er);else erinf=norminf(er);if(erinf>tol){h=.2*h*pow(tol/erinf,.25);if(x0+h===x0){ret.msg="Step size became too small";break}continue}ymid[i]=add(add(add(add(add(add(y0,mul(k1[i],h*bm[0])),mul(k3,h*bm[2])),mul(k4,h*bm[3])),mul(k5,h*bm[4])),mul(k6,h*bm[5])),mul(k7,h*bm[6]));++i;xs[i]=x0+h;ys[i]=y1;k1[i]=k7;if(typeof event==="function"){var yi,xl=x0,xr=x0+.5*h,xi;e1=event(xr,ymid[i-1]);ev=and(lt(e0,0),lt(0,e1));if(!any(ev)){xl=xr;xr=x0+h;e0=e1;e1=event(xr,y1);ev=and(lt(e0,0),lt(0,e1))}if(any(ev)){var xc,yc,en,ei;var side=0,sl=1,sr=1;while(1){if(typeof e0==="number")xi=(sr*e1*xl-sl*e0*xr)/(sr*e1-sl*e0);else{xi=xr;for(j=e0.length-1;j!==-1;--j){if(e0[j]<0&&e1[j]>0)xi=min(xi,(sr*e1[j]*xl-sl*e0[j]*xr)/(sr*e1[j]-sl*e0[j]))}}if(xi<=xl||xi>=xr)break;yi=ret._at(xi,i-1);ei=event(xi,yi);en=and(lt(e0,0),lt(0,ei));if(any(en)){xr=xi;e1=ei;ev=en;sr=1;if(side===-1)sl*=.5;else sl=1;side=-1}else{xl=xi;e0=ei;sl=1;if(side===1)sr*=.5;else sr=1;side=1}}y1=ret._at(.5*(x0+xi),i-1);ret.f[i]=f(xi,yi);ret.x[i]=xi;ret.y[i]=yi;ret.ymid[i-1]=y1;ret.events=ev;ret.iterations=it;return ret}}x0+=h;y0=y1;e0=e1;h=min(.8*h*pow(tol/erinf,.25),4*h)}ret.iterations=it;return ret};numeric.LU=function(A,fast){fast=fast||false;var abs=Math.abs;var i,j,k,absAjk,Akk,Ak,Pk,Ai;var max;var n=A.length,n1=n-1;var P=new Array(n);if(!fast)A=numeric.clone(A);for(k=0;k<n;++k){Pk=k;Ak=A[k];max=abs(Ak[k]);for(j=k+1;j<n;++j){absAjk=abs(A[j][k]);if(max<absAjk){max=absAjk;Pk=j}}P[k]=Pk;if(Pk!=k){A[k]=A[Pk];A[Pk]=Ak;Ak=A[k]}Akk=Ak[k];for(i=k+1;i<n;++i){A[i][k]/=Akk}for(i=k+1;i<n;++i){Ai=A[i];for(j=k+1;j<n1;++j){Ai[j]-=Ai[k]*Ak[j];++j;Ai[j]-=Ai[k]*Ak[j]}if(j===n1)Ai[j]-=Ai[k]*Ak[j]}}return{LU:A,P:P}};numeric.LUsolve=function LUsolve(LUP,b){var i,j;var LU=LUP.LU;var n=LU.length;var x=numeric.clone(b);var P=LUP.P;var Pi,LUi,LUii,tmp;for(i=n-1;i!==-1;--i)x[i]=b[i];for(i=0;i<n;++i){Pi=P[i];if(P[i]!==i){tmp=x[i];x[i]=x[Pi];x[Pi]=tmp}LUi=LU[i];for(j=0;j<i;++j){x[i]-=x[j]*LUi[j]}}for(i=n-1;i>=0;--i){LUi=LU[i];for(j=i+1;j<n;++j){x[i]-=x[j]*LUi[j]}x[i]/=LUi[i]}return x};numeric.solve=function solve(A,b,fast){return numeric.LUsolve(numeric.LU(A,fast),b)};numeric.echelonize=function echelonize(A){var s=numeric.dim(A),m=s[0],n=s[1];var I=numeric.identity(m);var P=Array(m);var i,j,k,l,Ai,Ii,Z,a;var abs=Math.abs;var diveq=numeric.diveq;A=numeric.clone(A);for(i=0;i<m;++i){k=0;Ai=A[i];Ii=I[i];for(j=1;j<n;++j)if(abs(Ai[k])<abs(Ai[j]))k=j;P[i]=k;diveq(Ii,Ai[k]);diveq(Ai,Ai[k]);for(j=0;j<m;++j)if(j!==i){Z=A[j];a=Z[k];for(l=n-1;l!==-1;--l)Z[l]-=Ai[l]*a;Z=I[j];for(l=m-1;l!==-1;--l)Z[l]-=Ii[l]*a}}return{I:I,A:A,P:P}};numeric.__solveLP=function __solveLP(c,A,b,tol,maxit,x,flag){var sum=numeric.sum,log=numeric.log,mul=numeric.mul,sub=numeric.sub,dot=numeric.dot,div=numeric.div,add=numeric.add;var m=c.length,n=b.length,y;var unbounded=false,cb,i0=0;var alpha=1;var f0,df0,AT=numeric.transpose(A),svd=numeric.svd,transpose=numeric.transpose,leq=numeric.leq,sqrt=Math.sqrt,abs=Math.abs;var muleq=numeric.muleq;var norm=numeric.norminf,any=numeric.any,min=Math.min;var all=numeric.all,gt=numeric.gt;var p=Array(m),A0=Array(n),e=numeric.rep([n],1),H;var solve=numeric.solve,z=sub(b,dot(A,x)),count;var dotcc=dot(c,c);var g;for(count=i0;count<maxit;++count){var i,j,d;for(i=n-1;i!==-1;--i)A0[i]=div(A[i],z[i]);var A1=transpose(A0);for(i=m-1;i!==-1;--i)p[i]=sum(A1[i]);alpha=.25*abs(dotcc/dot(c,p));var a1=100*sqrt(dotcc/dot(p,p));if(!isFinite(alpha)||alpha>a1)alpha=a1;g=add(c,mul(alpha,p));H=dot(A1,A0);for(i=m-1;i!==-1;--i)H[i][i]+=1;d=solve(H,div(g,alpha),true);var t0=div(z,dot(A,d));var t=1;for(i=n-1;i!==-1;--i)if(t0[i]<0)t=min(t,-.999*t0[i]);y=sub(x,mul(d,t));z=sub(b,dot(A,y));if(!all(gt(z,0)))return{solution:x,message:"",iterations:count};x=y;if(alpha<tol)return{solution:y,message:"",iterations:count};if(flag){var s=dot(c,g),Ag=dot(A,g);unbounded=true;for(i=n-1;i!==-1;--i)if(s*Ag[i]<0){unbounded=false;break}}else{if(x[m-1]>=0)unbounded=false;else unbounded=true}if(unbounded)return{solution:y,message:"Unbounded",iterations:count}}return{solution:x,message:"maximum iteration count exceeded",iterations:count}};numeric._solveLP=function _solveLP(c,A,b,tol,maxit){var m=c.length,n=b.length,y;var sum=numeric.sum,log=numeric.log,mul=numeric.mul,sub=numeric.sub,dot=numeric.dot,div=numeric.div,add=numeric.add;var c0=numeric.rep([m],0).concat([1]);var J=numeric.rep([n,1],-1);var A0=numeric.blockMatrix([[A,J]]);var b0=b;var y=numeric.rep([m],0).concat(Math.max(0,numeric.sup(numeric.neg(b)))+1);var x0=numeric.__solveLP(c0,A0,b0,tol,maxit,y,false);var x=numeric.clone(x0.solution);x.length=m;var foo=numeric.inf(sub(b,dot(A,x)));if(foo<0){return{solution:NaN,message:"Infeasible",iterations:x0.iterations}}var ret=numeric.__solveLP(c,A,b,tol,maxit-x0.iterations,x,true);ret.iterations+=x0.iterations;return ret};numeric.solveLP=function solveLP(c,A,b,Aeq,beq,tol,maxit){if(typeof maxit==="undefined")maxit=1e3;if(typeof tol==="undefined")tol=numeric.epsilon;if(typeof Aeq==="undefined")return numeric._solveLP(c,A,b,tol,maxit);var m=Aeq.length,n=Aeq[0].length,o=A.length;var B=numeric.echelonize(Aeq);var flags=numeric.rep([n],0);var P=B.P;var Q=[];var i;for(i=P.length-1;i!==-1;--i)flags[P[i]]=1;for(i=n-1;i!==-1;--i)if(flags[i]===0)Q.push(i);var g=numeric.getRange;var I=numeric.linspace(0,m-1),J=numeric.linspace(0,o-1);var Aeq2=g(Aeq,I,Q),A1=g(A,J,P),A2=g(A,J,Q),dot=numeric.dot,sub=numeric.sub;var A3=dot(A1,B.I);var A4=sub(A2,dot(A3,Aeq2)),b4=sub(b,dot(A3,beq));var c1=Array(P.length),c2=Array(Q.length);for(i=P.length-1;i!==-1;--i)c1[i]=c[P[i]];for(i=Q.length-1;i!==-1;--i)c2[i]=c[Q[i]];var c4=sub(c2,dot(c1,dot(B.I,Aeq2)));var S=numeric._solveLP(c4,A4,b4,tol,maxit);var x2=S.solution;if(x2!==x2)return S;var x1=dot(B.I,sub(beq,dot(Aeq2,x2)));var x=Array(c.length);for(i=P.length-1;i!==-1;--i)x[P[i]]=x1[i];for(i=Q.length-1;i!==-1;--i)x[Q[i]]=x2[i];return{solution:x,message:S.message,iterations:S.iterations}};numeric.MPStoLP=function MPStoLP(MPS){if(MPS instanceof String){MPS.split("\n")}var state=0;var states=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"];var n=MPS.length;var i,j,z,N=0,rows={},sign=[],rl=0,vars={},nv=0;var name;var c=[],A=[],b=[];function err(e){throw new Error("MPStoLP: "+e+"\nLine "+i+": "+MPS[i]+"\nCurrent state: "+states[state]+"\n")}for(i=0;i<n;++i){z=MPS[i];var w0=z.match(/\S*/g);var w=[];for(j=0;j<w0.length;++j)if(w0[j]!=="")w.push(w0[j]);if(w.length===0)continue;for(j=0;j<states.length;++j)if(z.substr(0,states[j].length)===states[j])break;if(j<states.length){state=j;
if(j===1){name=w[1]}if(j===6)return{name:name,c:c,A:numeric.transpose(A),b:b,rows:rows,vars:vars};continue}switch(state){case 0:case 1:err("Unexpected line");case 2:switch(w[0]){case"N":if(N===0)N=w[1];else err("Two or more N rows");break;case"L":rows[w[1]]=rl;sign[rl]=1;b[rl]=0;++rl;break;case"G":rows[w[1]]=rl;sign[rl]=-1;b[rl]=0;++rl;break;case"E":rows[w[1]]=rl;sign[rl]=0;b[rl]=0;++rl;break;default:err("Parse error "+numeric.prettyPrint(w))}break;case 3:if(!vars.hasOwnProperty(w[0])){vars[w[0]]=nv;c[nv]=0;A[nv]=numeric.rep([rl],0);++nv}var p=vars[w[0]];for(j=1;j<w.length;j+=2){if(w[j]===N){c[p]=parseFloat(w[j+1]);continue}var q=rows[w[j]];A[p][q]=(sign[q]<0?-1:1)*parseFloat(w[j+1])}break;case 4:for(j=1;j<w.length;j+=2)b[rows[w[j]]]=(sign[rows[w[j]]]<0?-1:1)*parseFloat(w[j+1]);break;case 5:break;case 6:err("Internal error")}}err("Reached end of file without ENDATA")};numeric.seedrandom={pow:Math.pow,random:Math.random};(function(pool,math,width,chunks,significance,overflow,startdenom){math["seedrandom"]=function seedrandom(seed,use_entropy){var key=[];var arc4;seed=mixkey(flatten(use_entropy?[seed,pool]:arguments.length?seed:[(new Date).getTime(),pool,window],3),key);arc4=new ARC4(key);mixkey(arc4.S,pool);math["random"]=function random(){var n=arc4.g(chunks);var d=startdenom;var x=0;while(n<significance){n=(n+x)*width;d*=width;x=arc4.g(1)}while(n>=overflow){n/=2;d/=2;x>>>=1}return(n+x)/d};return seed};function ARC4(key){var t,u,me=this,keylen=key.length;var i=0,j=me.i=me.j=me.m=0;me.S=[];me.c=[];if(!keylen){key=[keylen++]}while(i<width){me.S[i]=i++}for(i=0;i<width;i++){t=me.S[i];j=lowbits(j+t+key[i%keylen]);u=me.S[j];me.S[i]=u;me.S[j]=t}me.g=function getnext(count){var s=me.S;var i=lowbits(me.i+1);var t=s[i];var j=lowbits(me.j+t);var u=s[j];s[i]=u;s[j]=t;var r=s[lowbits(t+u)];while(--count){i=lowbits(i+1);t=s[i];j=lowbits(j+t);u=s[j];s[i]=u;s[j]=t;r=r*width+s[lowbits(t+u)]}me.i=i;me.j=j;return r};me.g(width)}function flatten(obj,depth,result,prop,typ){result=[];typ=typeof obj;if(depth&&typ=="object"){for(prop in obj){if(prop.indexOf("S")<5){try{result.push(flatten(obj[prop],depth-1))}catch(e){}}}}return result.length?result:obj+(typ!="string"?"\x00":"")}function mixkey(seed,key,smear,j){seed+="";smear=0;for(j=0;j<seed.length;j++){key[lowbits(j)]=lowbits((smear^=key[lowbits(j)]*19)+seed.charCodeAt(j))}seed="";for(j in key){seed+=String.fromCharCode(key[j])}return seed}function lowbits(n){return n&width-1}startdenom=math.pow(width,chunks);significance=math.pow(2,significance);overflow=significance*2;mixkey(math.random(),pool)})([],numeric.seedrandom,256,6,52);(function(exports){function base0to1(A){if(typeof A!=="object"){return A}var ret=[],i,n=A.length;for(i=0;i<n;i++)ret[i+1]=base0to1(A[i]);return ret}function base1to0(A){if(typeof A!=="object"){return A}var ret=[],i,n=A.length;for(i=1;i<n;i++)ret[i-1]=base1to0(A[i]);return ret}function dpori(a,lda,n){var i,j,k,kp1,t;for(k=1;k<=n;k=k+1){a[k][k]=1/a[k][k];t=-a[k][k];for(i=1;i<k;i=i+1){a[i][k]=t*a[i][k]}kp1=k+1;if(n<kp1){break}for(j=kp1;j<=n;j=j+1){t=a[k][j];a[k][j]=0;for(i=1;i<=k;i=i+1){a[i][j]=a[i][j]+t*a[i][k]}}}}function dposl(a,lda,n,b){var i,k,kb,t;for(k=1;k<=n;k=k+1){t=0;for(i=1;i<k;i=i+1){t=t+a[i][k]*b[i]}b[k]=(b[k]-t)/a[k][k]}for(kb=1;kb<=n;kb=kb+1){k=n+1-kb;b[k]=b[k]/a[k][k];t=-b[k];for(i=1;i<k;i=i+1){b[i]=b[i]+t*a[i][k]}}}function dpofa(a,lda,n,info){var i,j,jm1,k,t,s;for(j=1;j<=n;j=j+1){info[1]=j;s=0;jm1=j-1;if(jm1<1){s=a[j][j]-s;if(s<=0){break}a[j][j]=Math.sqrt(s)}else{for(k=1;k<=jm1;k=k+1){t=a[k][j];for(i=1;i<k;i=i+1){t=t-a[i][j]*a[i][k]}t=t/a[k][k];a[k][j]=t;s=s+t*t}s=a[j][j]-s;if(s<=0){break}a[j][j]=Math.sqrt(s)}info[1]=0}}function qpgen2(dmat,dvec,fddmat,n,sol,crval,amat,bvec,fdamat,q,meq,iact,nact,iter,work,ierr){var i,j,l,l1,info,it1,iwzv,iwrv,iwrm,iwsv,iwuv,nvl,r,iwnbv,temp,sum,t1,tt,gc,gs,nu,t1inf,t2min,vsmall,tmpa,tmpb,go;r=Math.min(n,q);l=2*n+r*(r+5)/2+2*q+1;vsmall=1e-60;do{vsmall=vsmall+vsmall;tmpa=1+.1*vsmall;tmpb=1+.2*vsmall}while(tmpa<=1||tmpb<=1);for(i=1;i<=n;i=i+1){work[i]=dvec[i]}for(i=n+1;i<=l;i=i+1){work[i]=0}for(i=1;i<=q;i=i+1){iact[i]=0}info=[];if(ierr[1]===0){dpofa(dmat,fddmat,n,info);if(info[1]!==0){ierr[1]=2;return}dposl(dmat,fddmat,n,dvec);dpori(dmat,fddmat,n)}else{for(j=1;j<=n;j=j+1){sol[j]=0;for(i=1;i<=j;i=i+1){sol[j]=sol[j]+dmat[i][j]*dvec[i]}}for(j=1;j<=n;j=j+1){dvec[j]=0;for(i=j;i<=n;i=i+1){dvec[j]=dvec[j]+dmat[j][i]*sol[i]}}}crval[1]=0;for(j=1;j<=n;j=j+1){sol[j]=dvec[j];crval[1]=crval[1]+work[j]*sol[j];work[j]=0;for(i=j+1;i<=n;i=i+1){dmat[i][j]=0}}crval[1]=-crval[1]/2;ierr[1]=0;iwzv=n;iwrv=iwzv+n;iwuv=iwrv+r;iwrm=iwuv+r+1;iwsv=iwrm+r*(r+1)/2;iwnbv=iwsv+q;for(i=1;i<=q;i=i+1){sum=0;for(j=1;j<=n;j=j+1){sum=sum+amat[j][i]*amat[j][i]}work[iwnbv+i]=Math.sqrt(sum)}nact=0;iter[1]=0;iter[2]=0;function fn_goto_50(){iter[1]=iter[1]+1;l=iwsv;for(i=1;i<=q;i=i+1){l=l+1;sum=-bvec[i];for(j=1;j<=n;j=j+1){sum=sum+amat[j][i]*sol[j]}if(Math.abs(sum)<vsmall){sum=0}if(i>meq){work[l]=sum}else{work[l]=-Math.abs(sum);if(sum>0){for(j=1;j<=n;j=j+1){amat[j][i]=-amat[j][i]}bvec[i]=-bvec[i]}}}for(i=1;i<=nact;i=i+1){work[iwsv+iact[i]]=0}nvl=0;temp=0;for(i=1;i<=q;i=i+1){if(work[iwsv+i]<temp*work[iwnbv+i]){nvl=i;temp=work[iwsv+i]/work[iwnbv+i]}}if(nvl===0){return 999}return 0}function fn_goto_55(){for(i=1;i<=n;i=i+1){sum=0;for(j=1;j<=n;j=j+1){sum=sum+dmat[j][i]*amat[j][nvl]}work[i]=sum}l1=iwzv;for(i=1;i<=n;i=i+1){work[l1+i]=0}for(j=nact+1;j<=n;j=j+1){for(i=1;i<=n;i=i+1){work[l1+i]=work[l1+i]+dmat[i][j]*work[j]}}t1inf=true;for(i=nact;i>=1;i=i-1){sum=work[i];l=iwrm+i*(i+3)/2;l1=l-i;for(j=i+1;j<=nact;j=j+1){sum=sum-work[l]*work[iwrv+j];l=l+j}sum=sum/work[l1];work[iwrv+i]=sum;if(iact[i]<meq){break}if(sum<0){break}t1inf=false;it1=i}if(!t1inf){t1=work[iwuv+it1]/work[iwrv+it1];for(i=1;i<=nact;i=i+1){if(iact[i]<meq){break}if(work[iwrv+i]<0){break}temp=work[iwuv+i]/work[iwrv+i];if(temp<t1){t1=temp;it1=i}}}sum=0;for(i=iwzv+1;i<=iwzv+n;i=i+1){sum=sum+work[i]*work[i]}if(Math.abs(sum)<=vsmall){if(t1inf){ierr[1]=1;return 999}else{for(i=1;i<=nact;i=i+1){work[iwuv+i]=work[iwuv+i]-t1*work[iwrv+i]}work[iwuv+nact+1]=work[iwuv+nact+1]+t1;return 700}}else{sum=0;for(i=1;i<=n;i=i+1){sum=sum+work[iwzv+i]*amat[i][nvl]}tt=-work[iwsv+nvl]/sum;t2min=true;if(!t1inf){if(t1<tt){tt=t1;t2min=false}}for(i=1;i<=n;i=i+1){sol[i]=sol[i]+tt*work[iwzv+i];if(Math.abs(sol[i])<vsmall){sol[i]=0}}crval[1]=crval[1]+tt*sum*(tt/2+work[iwuv+nact+1]);for(i=1;i<=nact;i=i+1){work[iwuv+i]=work[iwuv+i]-tt*work[iwrv+i]}work[iwuv+nact+1]=work[iwuv+nact+1]+tt;if(t2min){nact=nact+1;iact[nact]=nvl;l=iwrm+(nact-1)*nact/2+1;for(i=1;i<=nact-1;i=i+1){work[l]=work[i];l=l+1}if(nact===n){work[l]=work[n]}else{for(i=n;i>=nact+1;i=i-1){if(work[i]===0){break}gc=Math.max(Math.abs(work[i-1]),Math.abs(work[i]));gs=Math.min(Math.abs(work[i-1]),Math.abs(work[i]));if(work[i-1]>=0){temp=Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc)))}else{temp=-Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc)))}gc=work[i-1]/temp;gs=work[i]/temp;if(gc===1){break}if(gc===0){work[i-1]=gs*temp;for(j=1;j<=n;j=j+1){temp=dmat[j][i-1];dmat[j][i-1]=dmat[j][i];dmat[j][i]=temp}}else{work[i-1]=temp;nu=gs/(1+gc);for(j=1;j<=n;j=j+1){temp=gc*dmat[j][i-1]+gs*dmat[j][i];dmat[j][i]=nu*(dmat[j][i-1]+temp)-dmat[j][i];dmat[j][i-1]=temp}}}work[l]=work[nact]}}else{sum=-bvec[nvl];for(j=1;j<=n;j=j+1){sum=sum+sol[j]*amat[j][nvl]}if(nvl>meq){work[iwsv+nvl]=sum}else{work[iwsv+nvl]=-Math.abs(sum);if(sum>0){for(j=1;j<=n;j=j+1){amat[j][nvl]=-amat[j][nvl]}bvec[nvl]=-bvec[nvl]}}return 700}}return 0}function fn_goto_797(){l=iwrm+it1*(it1+1)/2+1;l1=l+it1;if(work[l1]===0){return 798}gc=Math.max(Math.abs(work[l1-1]),Math.abs(work[l1]));gs=Math.min(Math.abs(work[l1-1]),Math.abs(work[l1]));if(work[l1-1]>=0){temp=Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc)))}else{temp=-Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc)))}gc=work[l1-1]/temp;gs=work[l1]/temp;if(gc===1){return 798}if(gc===0){for(i=it1+1;i<=nact;i=i+1){temp=work[l1-1];work[l1-1]=work[l1];work[l1]=temp;l1=l1+i}for(i=1;i<=n;i=i+1){temp=dmat[i][it1];dmat[i][it1]=dmat[i][it1+1];dmat[i][it1+1]=temp}}else{nu=gs/(1+gc);for(i=it1+1;i<=nact;i=i+1){temp=gc*work[l1-1]+gs*work[l1];work[l1]=nu*(work[l1-1]+temp)-work[l1];work[l1-1]=temp;l1=l1+i}for(i=1;i<=n;i=i+1){temp=gc*dmat[i][it1]+gs*dmat[i][it1+1];dmat[i][it1+1]=nu*(dmat[i][it1]+temp)-dmat[i][it1+1];dmat[i][it1]=temp}}return 0}function fn_goto_798(){l1=l-it1;for(i=1;i<=it1;i=i+1){work[l1]=work[l];l=l+1;l1=l1+1}work[iwuv+it1]=work[iwuv+it1+1];iact[it1]=iact[it1+1];it1=it1+1;if(it1<nact){return 797}return 0}function fn_goto_799(){work[iwuv+nact]=work[iwuv+nact+1];work[iwuv+nact+1]=0;iact[nact]=0;nact=nact-1;iter[2]=iter[2]+1;return 0}go=0;while(true){go=fn_goto_50();if(go===999){return}while(true){go=fn_goto_55();if(go===0){break}if(go===999){return}if(go===700){if(it1===nact){fn_goto_799()}else{while(true){fn_goto_797();go=fn_goto_798();if(go!==797){break}}fn_goto_799()}}}}}function solveQP(Dmat,dvec,Amat,bvec,meq,factorized){Dmat=base0to1(Dmat);dvec=base0to1(dvec);Amat=base0to1(Amat);var i,n,q,nact,r,crval=[],iact=[],sol=[],work=[],iter=[],message;meq=meq||0;factorized=factorized?base0to1(factorized):[undefined,0];bvec=bvec?base0to1(bvec):[];n=Dmat.length-1;q=Amat[1].length-1;if(!bvec){for(i=1;i<=q;i=i+1){bvec[i]=0}}for(i=1;i<=q;i=i+1){iact[i]=0}nact=0;r=Math.min(n,q);for(i=1;i<=n;i=i+1){sol[i]=0}crval[1]=0;for(i=1;i<=2*n+r*(r+5)/2+2*q+1;i=i+1){work[i]=0}for(i=1;i<=2;i=i+1){iter[i]=0}qpgen2(Dmat,dvec,n,n,sol,crval,Amat,bvec,n,q,meq,iact,nact,iter,work,factorized);message="";if(factorized[1]===1){message="constraints are inconsistent, no solution!"}if(factorized[1]===2){message="matrix D in quadratic function is not positive definite!"}return{solution:base1to0(sol),value:base1to0(crval),unconstrained_solution:base1to0(dvec),iterations:base1to0(iter),iact:base1to0(iact),message:message}}exports.solveQP=solveQP})(numeric);numeric.svd=function svd(A){var temp;var prec=numeric.epsilon;var tolerance=1e-64/prec;var itmax=50;var c=0;var i=0;var j=0;var k=0;var l=0;var u=numeric.clone(A);var m=u.length;var n=u[0].length;if(m<n)throw"Need more rows than columns";var e=new Array(n);var q=new Array(n);for(i=0;i<n;i++)e[i]=q[i]=0;var v=numeric.rep([n,n],0);function pythag(a,b){a=Math.abs(a);b=Math.abs(b);if(a>b)return a*Math.sqrt(1+b*b/a/a);else if(b==0)return a;return b*Math.sqrt(1+a*a/b/b)}var f=0;var g=0;var h=0;var x=0;var y=0;var z=0;var s=0;for(i=0;i<n;i++){e[i]=g;s=0;l=i+1;for(j=i;j<m;j++)s+=u[j][i]*u[j][i];if(s<=tolerance)g=0;else{f=u[i][i];g=Math.sqrt(s);if(f>=0)g=-g;h=f*g-s;u[i][i]=f-g;for(j=l;j<n;j++){s=0;for(k=i;k<m;k++)s+=u[k][i]*u[k][j];f=s/h;for(k=i;k<m;k++)u[k][j]+=f*u[k][i]}}q[i]=g;s=0;for(j=l;j<n;j++)s=s+u[i][j]*u[i][j];if(s<=tolerance)g=0;else{f=u[i][i+1];g=Math.sqrt(s);if(f>=0)g=-g;h=f*g-s;u[i][i+1]=f-g;for(j=l;j<n;j++)e[j]=u[i][j]/h;for(j=l;j<m;j++){s=0;for(k=l;k<n;k++)s+=u[j][k]*u[i][k];for(k=l;k<n;k++)u[j][k]+=s*e[k]}}y=Math.abs(q[i])+Math.abs(e[i]);if(y>x)x=y}for(i=n-1;i!=-1;i+=-1){if(g!=0){h=g*u[i][i+1];for(j=l;j<n;j++)v[j][i]=u[i][j]/h;for(j=l;j<n;j++){s=0;for(k=l;k<n;k++)s+=u[i][k]*v[k][j];for(k=l;k<n;k++)v[k][j]+=s*v[k][i]}}for(j=l;j<n;j++){v[i][j]=0;v[j][i]=0}v[i][i]=1;g=e[i];l=i}for(i=n-1;i!=-1;i+=-1){l=i+1;g=q[i];for(j=l;j<n;j++)u[i][j]=0;if(g!=0){h=u[i][i]*g;for(j=l;j<n;j++){s=0;for(k=l;k<m;k++)s+=u[k][i]*u[k][j];f=s/h;for(k=i;k<m;k++)u[k][j]+=f*u[k][i]}for(j=i;j<m;j++)u[j][i]=u[j][i]/g}else for(j=i;j<m;j++)u[j][i]=0;u[i][i]+=1}prec=prec*x;for(k=n-1;k!=-1;k+=-1){for(var iteration=0;iteration<itmax;iteration++){var test_convergence=false;for(l=k;l!=-1;l+=-1){if(Math.abs(e[l])<=prec){test_convergence=true;break}if(Math.abs(q[l-1])<=prec)break}if(!test_convergence){c=0;s=1;var l1=l-1;for(i=l;i<k+1;i++){f=s*e[i];e[i]=c*e[i];if(Math.abs(f)<=prec)break;g=q[i];h=pythag(f,g);q[i]=h;c=g/h;s=-f/h;for(j=0;j<m;j++){y=u[j][l1];z=u[j][i];u[j][l1]=y*c+z*s;u[j][i]=-y*s+z*c}}}z=q[k];if(l==k){if(z<0){q[k]=-z;for(j=0;j<n;j++)v[j][k]=-v[j][k]}break}if(iteration>=itmax-1)throw"Error: no convergence.";x=q[l];y=q[k-1];g=e[k-1];h=e[k];f=((y-z)*(y+z)+(g-h)*(g+h))/(2*h*y);g=pythag(f,1);if(f<0)f=((x-z)*(x+z)+h*(y/(f-g)-h))/x;else f=((x-z)*(x+z)+h*(y/(f+g)-h))/x;c=1;s=1;for(i=l+1;i<k+1;i++){g=e[i];y=q[i];h=s*g;g=c*g;z=pythag(f,h);e[i-1]=z;c=f/z;s=h/z;f=x*c+g*s;g=-x*s+g*c;h=y*s;y=y*c;for(j=0;j<n;j++){x=v[j][i-1];z=v[j][i];v[j][i-1]=x*c+z*s;v[j][i]=-x*s+z*c}z=pythag(f,h);q[i-1]=z;c=f/z;s=h/z;f=c*g+s*y;x=-s*g+c*y;for(j=0;j<m;j++){y=u[j][i-1];z=u[j][i];u[j][i-1]=y*c+z*s;u[j][i]=-y*s+z*c}}e[l]=0;e[k]=f;q[k]=x}}for(i=0;i<q.length;i++)if(q[i]<prec)q[i]=0;for(i=0;i<n;i++){for(j=i-1;j>=0;j--){if(q[j]<q[i]){c=q[j];q[j]=q[i];q[i]=c;for(k=0;k<u.length;k++){temp=u[k][i];u[k][i]=u[k][j];u[k][j]=temp}for(k=0;k<v.length;k++){temp=v[k][i];v[k][i]=v[k][j];v[k][j]=temp}i=j}}}return{U:u,S:q,V:v}}},{}],9:[function(require,module,exports){var MAPlot;MAPlot=function(){function MAPlot(opts){var _base,_base1,_base2,_this=this;this.opts=opts;if((_base=this.opts).height==null){_base.height=300}if((_base1=this.opts).width==null){_base1.width=600}if((_base2=this.opts).padding==null){_base2.padding=30}this.gDot=d3.select(this.opts.elem).append("canvas");this.gDot.attr("width",this.opts.width).attr("height",this.opts.height);this.svg=d3.select(this.opts.elem).append("svg");this.svg.attr("width",this.opts.width).attr("height",this.opts.height);this.gBrush=this.svg.append("g");this.gBrush.on("mousemove",function(){return _this._mouse_move()});this.gBrush.on("mouseout",function(){return _this._mouse_out()});this.gHighlight=this.svg.append("g");this.tooltip=d3.select(this.opts.elem).append("div").attr("class","tooltip").style("opacity",0);this.dispatch=d3.dispatch("brush")}MAPlot.prototype.update_data=function(data,fc_dim,ave_dim,coloring,info_cols,fdr_col){var a_dim,m_dim,xAxis,xScale,yAxis,yScale,_this=this;this.data=data;this.coloring=coloring;this.info_cols=info_cols;this.fdr_col=fdr_col;if(fc_dim.length!==1||ave_dim.length!==1){log_info("Only support 2 dimensions for ma-plot",fc_dim,ave_dim);return}this.svg.select("g.brush").remove();this.svg.selectAll(".axis").remove();this.m_dim=m_dim=function(d){return d[fc_dim[0].idx]};this.a_dim=a_dim=function(d){return d[ave_dim[0].idx]};this.xScale=xScale=d3.scale.linear().domain(d3.extent(data,function(d){return a_dim(d)}).map(function(x){return x*1.05})).range([this.opts.padding,this.opts.width-this.opts.padding]);this.yScale=yScale=d3.scale.linear().domain(d3.extent(data,function(d){return m_dim(d)}).map(function(x){return x*1.05})).range([this.opts.height-this.opts.padding,this.opts.padding]);xAxis=d3.svg.axis().scale(xScale).orient("bottom");yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(5);this.mybrush=d3.svg.brush().x(xScale).y(yScale).clamp([false,false]).on("brush",function(){return _this._brushed()});this.gBrush.call(this.mybrush);this._draw_dots();this.svg.append("g").attr("class","axis").attr("transform","translate(0,"+yScale(0)+")").call(xAxis).append("text").attr("x",xScale.range()[1]).attr("y",-6).style("text-anchor","end").text("Avg log expr");return this.svg.append("g").attr("class","axis").attr("transform","translate("+this.opts.padding+",0)").call(yAxis).append("text").attr("transform","rotate(-90)").attr("x",-5).attr("y",5).attr("dy",".71em").style("text-anchor","end").text("logFC")};MAPlot.prototype._draw_dots=function(){var ctx,i,_results,_this=this;ctx=this.gDot[0][0].getContext("2d");ctx.clearRect(0,0,this.opts.width,this.opts.height);i=this.data.length;_results=[];while(i--){_results.push(function(i){var d;d=_this.data[i];if(_this.opts.filter(d)){ctx.fillStyle=_this.coloring(d);ctx.globalAlpha=.7;ctx.beginPath();ctx.arc(_this.xScale(_this.a_dim(d)),_this.yScale(_this.m_dim(d)),3,0,Math.PI*2);return ctx.fill()}}(i))}return _results};MAPlot.prototype._mouse_move=function(){var loc,_this=this;loc=d3.mouse(this.gDot[0][0]);this._hide_info();return scheduler.schedule("maplot.tooltip",function(){return _this._handle_tooltip(loc)},20)};MAPlot.prototype._mouse_out=function(){var _this=this;this._hide_info();return scheduler.schedule("maplot.tooltip",function(){})};MAPlot.prototype._handle_tooltip=function(loc){var ex,m,sz,x,y;x=loc[0],y=loc[1];sz=3;ex=[[this.xScale.invert(x-sz),this.yScale.invert(y+sz)],[this.xScale.invert(x+sz),this.yScale.invert(y-sz)]];m=this._in_extent(ex);if(m.length>0){return this._show_info(loc,m)}else{return this._hide_info()}};MAPlot.prototype._show_info=function(loc,rows){var fmt,fmt2,info,row;fmt=function(val){return val.toFixed(2)};fmt2=function(val){if(val<.01){return val.toExponential(2)}else{return val.toFixed(2)}};this.tooltip.transition().duration(200).style("opacity",.8);info="<table>";row=rows[0];this.info_cols.forEach(function(c){return info+="<tr><td><b>"+c.name+"</b>:<td>"+row[c.idx]});info+="<tr><td><b>A</b>:<td>"+fmt(this.a_dim(row));info+="<tr><td><b>M</b>:<td>"+fmt(this.m_dim(row));info+="<tr><td><b>FDR</b>:<td>"+fmt2(row[this.fdr_col]);info+="</table>";if(rows.length>1){info+="(And "+(rows.length-1)+" other"+(rows.length>2?"s":"")+")"}return this.tooltip.html(info).style("left",loc[0]+10+"px").style("top",loc[1]+15+"px")};MAPlot.prototype._hide_info=function(){return this.tooltip.style("opacity",0)};MAPlot.prototype._brushed=function(){var sel;sel=this._selected();return this.dispatch.brush(sel)};MAPlot.prototype._in_extent=function(ex){var _this=this;return this.data.filter(function(d){var x,y;y=_this.m_dim(d);x=_this.a_dim(d);return _this.opts.filter(d)&&x>=ex[0][0]&&x<=ex[1][0]&&y>=ex[0][1]&&y<=ex[1][1]})};MAPlot.prototype._selected=function(){var _this=this;if(this.mybrush.empty()){return this.data.filter(function(d){return _this.opts.filter(d)})}else{return this._in_extent(this.mybrush.extent())}};MAPlot.prototype.highlight=function(rows){var hi,_this=this;hi=this.gHighlight.selectAll(".highlight").data(rows,function(d){return d.id});hi.exit().remove();hi.enter().insert("circle").attr("class","highlight").attr("opacity",1).style("fill-opacity",0).style("stroke","black").style("stroke-width",3);return hi.attr("r",15).attr("cx",function(d){return _this.xScale(_this.a_dim(d))}).attr("cy",function(d){return _this.yScale(_this.m_dim(d))}).transition().duration(500).attr("r",7)};MAPlot.prototype.unhighlight=function(){return this.svg.selectAll(".highlight").remove()};MAPlot.prototype.on=function(t,func){return this.dispatch.on(t,func)};MAPlot.prototype.brush=function(){this._draw_dots();return this._brushed()};return MAPlot}();window.MAPlot=MAPlot},{}],10:[function(require,module,exports){var ParCoords;ParCoords=function(){function ParCoords(opts){this.opts=opts;if(this.opts.width!=null){d3.select(this.opts.elem).style("width",this.opts.width)}this.parcoords=d3.parcoords()(this.opts.elem).alpha(.4).reorderable().brushable().mode("queue");this.parcoords.setFilter(this.opts.filter)}ParCoords.prototype.update_data=function(data,dims,extent,coloring){var dim_names,h,_this=this;dim_names={};dims.forEach(function(k){return dim_names[k.idx]=k.name});this.parcoords.data(data).dimensions(dims.map(function(c){return c.idx})).dimension_names(dim_names).autoscale();if(coloring){this.parcoords.color(coloring)}if(extent==null){extent=ParCoords.calc_extent(data,dims)}h=this.parcoords.height()-this.parcoords.margin().top-this.parcoords.margin().bottom;this.parcoords.dimensions().forEach(function(k){return _this.parcoords.yscale[k]=d3.scale.linear().domain(extent).range([h+1,1])});this.parcoords.createAxes().render().reorderable().brushable();this.parcoords.render();return this.parcoords.brush()};ParCoords.calc_extent=function(data,dims){var extent,extents;extents=[];dims.forEach(function(k){return extents.push(d3.extent(data,function(v){return+v[k.idx]}))});extent=d3.extent(d3.merge(extents));return extent.map(function(v){return v*1.05})};ParCoords.prototype.highlight=function(d){return this.parcoords.highlight(d)};ParCoords.prototype.unhighlight=function(){return this.parcoords.unhighlight()};ParCoords.prototype.on=function(t,func){return this.parcoords.on(t,func)};ParCoords.prototype.brush=function(){return this.parcoords.brush()};return ParCoords}();window.ParCoords=ParCoords},{}],11:[function(require,module,exports){var BarGraph,GenePCA,PCA,ScatterPlot,log_moderation,transform_key,variance_key;ScatterPlot=function(){function ScatterPlot(elem,tot_width,tot_height){var margin;if(tot_width==null){tot_width=570}if(tot_height==null){tot_height=400}margin={top:20,right:180,bottom:40,left:60};this.width=tot_width-margin.left-margin.right;this.height=tot_height-margin.top-margin.bottom;this.x=d3.scale.linear().range([0,this.width]);this.y=d3.scale.linear().range([this.height,0]);this.color=d3.scale.category10();this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(8,1);this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(8,1);this.svg=d3.select(elem).append("svg").attr("class","scatter").attr("width",this.width+margin.left+margin.right).attr("height",this.height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")")}ScatterPlot.prototype.draw=function(data,labels,dims){var dim1,dim2,dot_g,dots,locs,_this=this;dim1=dims[0],dim2=dims[1];this.x.domain(d3.extent(data[dim1-1]));this.y.domain(d3.extent(data[dim2-1]));locs=d3.transpose(data);this.svg.selectAll(".axis").remove();this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis).append("text").attr("class","label").attr("x",this.width/2).attr("y",40).style("text-anchor","middle").text("MDS Dimension "+dim1);this.svg.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",-100).attr("y",-50).style("text-anchor","end").text("MDS Dimension "+dim2);dots=this.svg.selectAll(".dot").data(locs);dots.exit().remove();dot_g=dots.enter().append("g").attr("class","dot");dot_g.append("circle").attr("r",3.5).attr("cx",0).attr("cy",0);dot_g.append("text").attr("class","labels").attr("x",3).attr("y",-3);dots.select("circle").style("fill",function(d,i){return _this.color(labels[i].parent)});dots.select("text").style("fill",function(d,i){return _this.color(labels[i].parent)}).text(function(d,i){return labels[i].name});return dots.transition().attr("transform",function(d){return"translate("+_this.x(d[dim1-1])+","+_this.y(d[dim2-1])+")"})};return ScatterPlot}();BarGraph=function(){function BarGraph(opts){var margin,_base,_base1;this.opts=opts;(_base=this.opts).tot_width||(_base.tot_width=200);(_base1=this.opts).tot_height||(_base1.tot_height=200);margin={top:20,right:10,bottom:30,left:40};this.width=this.opts.tot_width-margin.left-margin.right;this.height=this.opts.tot_height-margin.top-margin.bottom;this.x=d3.scale.ordinal().rangeRoundBands([0,this.width],.1);this.y=d3.scale.linear().range([this.height,0]);this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(8,1);this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(8,1);this.svg=d3.select(this.opts.elem).append("svg").attr("class","bar-chart").attr("width",this.width+margin.left+margin.right).attr("height",this.height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")")}BarGraph.prototype.draw=function(data){var _this=this;this.svg.selectAll("*").remove();this.x.domain(data.map(function(d){return d.lbl}));this.y.domain([0,d3.max(data,function(d){return d.val})]);this.svg.append("text").attr("class","title").attr("x",this.width/2).attr("y",-10).style("text-anchor","middle").text("Magnitude of each MDS dimension");this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis).append("text").attr("class","label").attr("x",this.width/2).attr("y",30).style("text-anchor","middle").text("Dimension");this.svg.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",-60).attr("y",-30).style("text-anchor","end").text("Magnitude");return this.svg.selectAll(".bar").data(data).enter().append("rect").attr("class","bar").attr("x",function(d){return _this.x(d.lbl)}).attr("width",this.x.rangeBand()).attr("y",function(d){return _this.y(d.val)}).attr("height",function(d){return _this.height-_this.y(d.val)}).on("click",function(d){if(_this.opts.click!=null){return _this.opts.click(d)}})};return BarGraph}();PCA=function(){function PCA(){}PCA.pca=function(matrix){var X,r,sigma,svd;X=numeric.transpose(numeric.transpose(matrix).map(function(r){var mean;mean=1*numeric.sum(r)/r.length;return numeric.sub(r,mean)}));sigma=numeric.dot(X,numeric.transpose(X));svd=numeric.svd(sigma);r=numeric.dot(svd.V,numeric.sqrt(numeric.diag(svd.S)));r=numeric.div(r,Math.sqrt(matrix[0].length));return r};PCA.variance=function(X){var sz;sz=X.length;return numeric.sum(numeric.pow(X,2))/sz-Math.pow(numeric.sum(X),2)/(sz*sz)};return PCA}();log_moderation=10;variance_key="_variance";transform_key="_transformed_";GenePCA=function(){function GenePCA(opts){var _this=this;this.opts=opts;this.scatter=new ScatterPlot(this.opts.elem);this.barGraph=new BarGraph({elem:this.opts.elem,click:function(d){if(_this.opts.sel_dimension!=null){return _this.opts.sel_dimension(d.lbl)}}})}GenePCA.prototype.update_data=function(data,columns){var _this=this;this.data=data;this.columns=columns;this.lib_size={};this.columns.forEach(function(c){return _this.lib_size[c.idx]=0});this.data.forEach(function(row){return _this.columns.forEach(function(c){return _this.lib_size[c.idx]+=row[c.idx]})});return this.redraw()};GenePCA.prototype._compute_variance=function(row){var transformed,_this=this;transformed=this.columns.map(function(col){var norm,t_val,val;norm=_this.lib_size[col.idx]/1e6;val=row[col.idx]/norm;t_val=Math.log(log_moderation+val)/Math.log(2);row[transform_key+col.idx]=t_val;return t_val});return row[variance_key]=PCA.variance(transformed)};GenePCA.prototype.redraw=function(){var by_gene,comp,dims,kept_data,num_genes,skip_genes,top_genes,transformed,_ref,_this=this;_ref=this.opts.params(),skip_genes=_ref.skip,num_genes=_ref.num,dims=_ref.dims;if(dims.length!==2){dims=[1,2]}kept_data=this.data.filter(function(d){return _this.opts.filter(d)});kept_data.forEach(function(row){return _this._compute_variance(row)});top_genes=kept_data.sort(function(a,b){return b[variance_key]-a[variance_key]});top_genes=top_genes.slice(skip_genes,skip_genes+num_genes);if(this.opts.gene_table){this.opts.gene_table.set_data(top_genes)}transformed=top_genes.map(function(row){return _this.columns.map(function(col){return row[transform_key+col.idx]})});by_gene=numeric.transpose(transformed);comp=numeric.transpose(PCA.pca(by_gene));this.scatter.draw(comp,this.columns,dims);return this.barGraph.draw(comp.slice(0,10).map(function(v,i){var range;range=d3.max(v)-d3.min(v);return{lbl:""+(i+1),val:range}}))};GenePCA.prototype.brush=function(){return this.redraw()};GenePCA.prototype.highlight=function(){};GenePCA.prototype.unhighlight=function(){};return GenePCA}();window.GenePCA=GenePCA},{}],12:[function(require,module,exports){var Slider;Slider=function(){Slider.prototype.set_slider=function(v){var set_i;set_i=0;$.each(this.stepValues,function(i,v2){if(v2<=v){return set_i=i}});return this.slider.slider("value",set_i)};Slider.prototype.fmt=function(v){var n;if(this.opts.fmt!=null){return this.opts.fmt(v)}n=Number(v);if(n===void 0){return v}else if(n>0&&n<.001){return n.toExponential(0)}else{return v}};Slider.prototype.set_max=function(val,min,max,log){var x;if(!log){this.stepValues=function(){var _i,_results;_results=[];for(x=_i=min;_i<=max;x=_i+=10){_results.push(x)}return _results}()}else{this.stepValues=[0,1,2,3,4,5,10,20,100,200,Math.floor(max/3),Math.floor(max/2),max];this.stepValues=this.stepValues.filter(function(v){return v>=min&&v<=max})}this.slider.slider("option","max",this.stepValues.length-1);this.set_slider(val);$(this.opts.input_id).val(this.fmt(val));return this.opts.on_change(val)};Slider.prototype.set_val=function(val,fire_change){$(this.opts.input_id).val(this.fmt(val));this.set_slider(val);if(fire_change!=null){return this.opts.on_change(val)}};function Slider(opts){var self,_this=this;this.opts=opts;this.stepValues=opts.step_values||[0,1,2,3,4,5,6,7,8,9,10];this.slider=$(opts.id).slider({animate:true,min:0,max:this.stepValues.length-1,value:1,slide:function(event,ui){var v;v=_this.stepValues[ui.value];$(opts.input_id).val(_this.fmt(v));return opts.on_change(v)}});if(this.opts.val!=null){this.set_val(this.opts.val)}self=this;$(opts.input_id).keyup(function(){var v;v=$(this).val();if(opts.validator(v)){$(this).removeClass("error");self.set_slider(v);return opts.on_change(v)}else{return $(this).addClass("error")}})}return Slider}();window.Slider=Slider},{}],13:[function(require,module,exports){var template,tour_steps;jQuery.fn.d3Click=function(){return this.each(function(i,e){var evt;evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);return e.dispatchEvent(evt)})};template="<div class='popover'>          <div class='arrow'></div>          <h3 class='popover-title'></h3>          <div class='popover-content'></div>          <nav class='popover-navigation'>            <div class='btn-group'>              <button class='btn btn-sm btn-default' data-role='prev'>&laquo; Prev</button>              <button class='btn btn-sm btn-default' data-role='next'>Next &raquo;</button>            </div>            <button class='btn btn-sm btn-default' data-role='end'>End tour</button>          </nav>        </div>";tour_steps=[{title:"<strong>Degust</strong>",content:"Degust allows you to explore your Differential Gene Expression data.  You can apply various filters for significance, and see the MA-plot/parallel coordinates plot/heatmap update dynamically.  You can search for specific genes, and download a filtered gene-list.",orphan:true,backdrop:true},{element:".conditions",placement:"right",title:"<strong>Condition selector</strong>",content:"Select/deselect the conditions you wish to compare.  Changing these causes the server to re-analyse your data"},{element:"#expression .nav",placement:"bottom",title:"<strong>Select plot type</strong>",content:"Select 'Parallel Coordinates' or 'MA plot'.  An 'MA plot' is great for visualising data with just 2 conditions.  The parallel coordinates plot is particuarly useful for more than 2 conditions"},{element:"#heatmap",placement:"top",title:"<strong>Heatmap</strong>",content:"<p>The heatmap shows the log fold-change for each gene shown in the plot above.  Each 'vertical strip' corresonds to a gene.  The heatmap may be slow to display when there are many genes to cluster.</p><p>Hovering the mouse over the heatmap will show the corresponding gene in the plot above.</p>"},{element:"#grid",placement:"top",title:"<strong>Gene table</strong>",content:"A table of genes filtered to show the same genes as plotted above.  <ul><li>The table may be sorted by clicking on the column headers.<li>Specific genes may be found using the search box<li>Double click a row to open a page for that gene.</ul>",template:function(){return $(template).addClass("wide")}},{element:".fdr-fld",placement:"left",title:"<strong>FDR threshold</strong>",content:"Modify the threshold for False Discovery Rate.  This dynamically filters the plots and gene table below"},{element:".fc-fld",placement:"left",title:"<strong>Log fold-change threshold</strong>",content:"Modify the threshold for absolute log fold-change.  This dynamically filters the plots and gene table below.  For example, a setting of '1.0' will only show genes that have an absolute log fold-change greater than 1.0 (that is 2x up or down) between any pair of conditions."},{element:"#csv-download",placement:"left",backdrop:true,title:"Gene list download",content:"Anything displayed in the gene list table can be downloaded as a CSV file."},{onShow:function(){return $("#select-ma a").click()},element:"#dge-ma",placement:"bottom",title:"<strong>MA plot</strong>",content:"<p>An MA plot shows expression for 2 conditions only (as selected in Options).  Each dot on this plot shows a gene.  The x-axis is the average expression, and the y-axis is the log fold-change between the conditions.</p><p>You can click and drag on the plot to select genes within a rectangle - the heatmap and table below will be filtered to only those genes. Click anywhere on the plot to remove a selection rectangle.</p><p>Each dot is coloured by FDR with red being more significant and blue less significant.</p>",template:function(){return $(template).addClass("wide")
}},{onShow:function(){return $("#select-pc a").click()},element:"#dge-pc",placement:"bottom",title:"<strong>Parallel Coordinates</strong>",content:"<p>Each blue/red line on this plot shows a gene and each axis corresponds to a conditions.  So each line shows the relative expression for a gene across conditions.</p><p>You can select a region of an axis by clicking and dragging vertically on that axis.  This will filter for only genes that fall within the selected fold-change.  Click outside the selection to clear.  Each axis may have an active select region.</p><p>Conditions can be re-ordered by dragging the column header</p><p>Each line is coloured by FDR with red being more significant and blue less significant.</p>",template:function(){return $(template).addClass("wide")}},{element:".kegg-filter",placement:"left",title:"<strong>Kegg filter</strong>",content:'<p>Filter genes by an annotated KEGG pathway.</p><p>The numbers beside each pathway show the number of genes in your dataset annotated in that pathway.  Selecting a pathway will filter to show only those genes, and display the pathway image.  The image may be resized, and you can hover the mouse over EC elements to see genes annotated with that EC.</p><p>The EC elements are coloured: blue = unchanged, green = all up, red = all down, yellow = mixed.</p><p>This KEGG data is from 2007.  If you find this functionality useful, I recommend you purchase a <a href="http://www.bioinformatics.jp/en/keggftp.html">KEGG subscription</a> and run your own local degust server.</p>',template:function(){return $(template).addClass("wide")}}];window.setup_tour=function(show_tour){var tour;tour=new Tour({steps:tour_steps});tour.init();$("a#tour").click(function(){return tour.restart()});if(show_tour){return tour.start()}}},{}],14:[function(require,module,exports){var Handlebars=require("handlebars-runtime");module.exports=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];helpers=this.merge(helpers,Handlebars.helpers);data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+='    <div class="navbar navbar-inverse navbar-static-top">\n      <div class="container">\n        <div class="navbar-header">\n          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#right-navbar-collapse">\n            <span class="sr-only">Toggle navigation</span>\n            <span class="icon-bar"></span>\n            <span class="icon-bar"></span>\n            <span class="icon-bar"></span>\n          </button>\n\n          <a class="navbar-brand" href="';if(stack1=helpers.home_link){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.home_link;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"\">Degust : </a>\n          <span class=\"navbar-brand exp-name\"></span>\n        </div>\n\n        <ul class=\"nav navbar-nav navbar-right navbar-collapse collapse\" id=\"right-navbar-collapse\">\n          <li><a class=\"log-link\" href=\"#\">Logs</a>\n          <li><a id=\"tour\" href=\"#\">Tour</a>\n          <li><a class=\"config hide\" href=\"#\">Configure</a>\n          <li><a href=\"#about-modal\" data-toggle=\"modal\">About</a>\n        </ul>\n      </div>\n    </div>\n\n    <div class='log-list'>\n      <h4>Log messages</h4>\n    </div>\n    \n    <div class='container'>\n      <div class='right'>\n        <div class='filter'>\n          <h4>Options</h4>\n          <div title='Filter genes by False Discovery Rate' data-placement='left'>\n            <label>FDR cut-off</label>\n            <input class=\"fdr-fld\" type=\"text\" value=\"0.01\" />\n            <div id='fdrSlider'></div>\n            <span class=\"dropdown\">\n              <button class=\"btn-link dropdown-toggle\" type=\"button\" id=\"dropFDR\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"true\">\n                <span class=\"caret\"></span>\n              </button>\n              <ul class=\"dropdown-menu shortcut-fdr\" aria-labelledby=\"dropFDR\">\n                <li><a href=\"#\" data-val='1'>1</a></li>\n                <li><a href=\"#\" data-val='0.05'>0.05</a></li>\n                <li><a href=\"#\" data-val='0.01'>0.01</a></li>\n                <li><a href=\"#\" data-val='0.001'>0.001</a></li>\n                <li><a href=\"#\" data-val='0.0001'>0.0001</a></li>\n              </ul>\n            </span>\n          </div>\n          <div title='Filter genes by absolute log fold change between any pair of samples' data-placement='left'>\n            <label>abs log FC</label>\n            <input class=\"fc-fld\" type=\"text\" value=\"0\" />\n            <div id='fcSlider'></div>\n            <span class=\"dropdown\">\n              <button class=\"btn-link dropdown-toggle\" type=\"button\" id=\"dropFC\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"true\">\n                <span class=\"caret\"></span>\n              </button>\n              <ul class=\"dropdown-menu shortcut-fc\" aria-labelledby=\"dropFC\">\n                <li><a href=\"#\" data-val='0'>0 (all)</a></li>\n                <li><a href=\"#\" data-val='0.585'>0.585 (&gt; 1.5x)</a></li>\n                <li><a href=\"#\" data-val='1'>1 (&gt; 2x)</a></li>\n                <li><a href=\"#\" data-val='2'>2 (&gt; 4x)</a></li>\n                <li><a href=\"#\" data-val='3'>3 (&gt; 8x)</a></li>\n                <li><a href=\"#\" data-val='4'>4 (&gt; 16x)</a></li>\n              </ul>\n            </span>\n          </div>\n          <div title='Show FC from selected condition' data-placement='left'>\n            <label for='fc-relative'>FC relative to</label>\n            <select id='fc-relative'></select>\n          </div>\n          <div title='FC for the MA-plot' data-placement='left' class='ma-fc-col-opt'>\n            <label for='ma-fc-col'>MA-Plot FC</label>\n            <select id='ma-fc-col'></select>\n          </div>\n          <div title='Show raw counts (or counts-per-million) in the table' data-placement='left' class='show-counts-opt'>\n            <label for='show-counts'>Show Counts</label>\n            <select id='show-counts'>\n              <option value='no'>No</option>\n              <option value='yes'>Yes</option>\n              <option value='cpm'>As counts-per-million</option>\n            </select>\n          </div>\n          <div class='pca-opts'>\n            <div class='pca-title'>MDS options</div>\n            <div title='Number of genes to use for the MDS plot' data-placement='left' class='pca-num-genes-opt'>\n              <label>Num genes</label>\n              <input class=\"num-genes-fld\" type=\"text\" value=\"50\" />\n              <div id='numGenesSlider'></div>\n            </div>\n            <div title='Number of genes to ignore for the MDS plot' data-placement='left' class='pca-skip-genes-opt'>\n              <label>Skip genes</label>\n              <input class=\"skip-genes-fld\" type=\"text\" value=\"50\" />\n              <div id='skipGenesSlider'></div>\n            </div>\n            <div title='MDS dimensions to plot' data-placement='left' class='pca-dims-opt'>\n              <label>Dimensions</label>\n              <input class=\"pca-dims-fld\" type=\"text\" value=\"50\" disabled />\n              <div id='pcaDimsSlider'></div>\n            </div>\n          </div><!-- div.pca-opts -->\n        </div>\n\n        <div class='filter kegg-filter'>\n          <h4>Kegg Pathway</h4>\n          <select id='kegg'></select>\n        </div>\n\n        <div class='right'>\n          <a class='show-r-code' href='#'>Show R code</a>\n        </div>\n      </div>\n\n      <div class='row'>\n        <div class='col-xs-2 conditions'>\n          <h3>Conditions</h3>\n          <div id='files'></div>\n          <label for='dge-method'>Method</label>\n          <select id='dge-method'>\n            <option value='voom'>Voom/Limma</option>\n            <option value='edgeR'>edgeR</option>\n          </select>\n        </div>\n\n        <div class='col-xs-6' id='expression'>\n          <div id='loading'><img src='";if(stack1=helpers.asset_base){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.asset_base;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"images/ajax-loader.gif'></div>\n          <ul class=\"nav nav-tabs\">\n            <li id='select-pc'><a href=\"#\">Expression : Parallel Coordinates</a></li>\n            <li id='select-ma'><a href=\"#\">Expression : MA plot</a></li>\n            <li id='select-pca'><a href=\"#\">MDS plot</a></li>\n          </ul>\n          <div id=\"dge-pc\" class=\"parcoords\"></div>\n          <div id=\"dge-ma\" class=\"dge-ma\"></div>\n          <div id=\"dge-pca\"></div>\n        </div><!-- expression -->\n      </div><!-- row -->\n\n      <div class='row'>\n        <div id=\"heatmap-info\"></div>\n        <div id='heatmap'></div>\n      </div>\n\n      <div class='row'>\n        <h2>Genes</h2>\n        <div>\n          <div class=\"tab-search\">\n            Search:\n            <input type=\"text\">\n          </div>\n          <a id='csv-download' href='#'>Download CSV</a>\n          <div id=\"grid-info\"></div>\n        </div>\n        <div id=\"grid\"></div>\n        <div id=\"gene-info\"></div>\n      </div>\n\n    </div>\n\n    <div id='kegg-image'></div>\n\n    <!-- About box Modal -->\n    <div id=\"about-modal\"></div>\n\n    <!-- Modal for showing R code -->\n    <div id='code-modal' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>\n      <div class='modal-dialog'>\n        <div class='modal-content'>\n          <div class='modal-header'>\n            <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>x</button>\n            <h3>DGE R Code</h3>\n          </div>\n          <div class='modal-body'>\n            This is the R code the backend used to perform the DGE analysis for the current page.\n            <pre class='r-code'>\n            </pre>\n          </div>\n          <div class='modal-footer'>\n            <button class='btn btn-primary' data-dismiss='modal' aria-hidden='true'>Close</button>\n          </div>\n        </div><!-- /.modal-content -->\n      </div><!-- /.modal-dialog -->\n    </div><!-- /.modal -->\n";return buffer})},{"handlebars-runtime":16}],15:[function(require,module,exports){var Handlebars=require("handlebars-runtime");module.exports=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];helpers=this.merge(helpers,Handlebars.helpers);data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+='<div class="container">\n  <div class="jumbotron">\n    <h1>Degust</h1>\n    <p><a href=\'';if(stack1=helpers.home_link){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.home_link;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"'>Degust</a> failed to load your data :(</p>\n    <p>Error</p>\n    <div class='error-msg'></div>\n  </div>\n</div>\n";return buffer})},{"handlebars-runtime":16}],16:[function(require,module,exports){var Handlebars={};module.exports=Handlebars;(function(Handlebars,undefined){Handlebars.VERSION="1.0.0";Handlebars.COMPILER_REVISION=4;Handlebars.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};Handlebars.helpers={};Handlebars.partials={};var toString=Object.prototype.toString,functionType="[object Function]",objectType="[object Object]";Handlebars.registerHelper=function(name,fn,inverse){if(toString.call(name)===objectType){if(inverse||fn){throw new Handlebars.Exception("Arg not supported with multiple helpers")}Handlebars.Utils.extend(this.helpers,name)}else{if(inverse){fn.not=inverse}this.helpers[name]=fn}};Handlebars.registerPartial=function(name,str){if(toString.call(name)===objectType){Handlebars.Utils.extend(this.partials,name)}else{this.partials[name]=str}};Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2){return undefined}else{throw new Error("Missing helper: '"+arg+"'")}});Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var type=toString.call(context);if(type===functionType){context=context.call(this)}if(context===true){return fn(this)}else if(context===false||context==null){return inverse(this)}else if(type==="[object Array]"){if(context.length>0){return Handlebars.helpers.each(context,options)}else{return inverse(this)}}else{return fn(context)}});Handlebars.K=function(){};Handlebars.createFrame=Object.create||function(object){Handlebars.K.prototype=object;var obj=new Handlebars.K;Handlebars.K.prototype=null;return obj};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(level,obj){if(Handlebars.logger.level<=level){var method=Handlebars.logger.methodMap[level];if(typeof console!=="undefined"&&console[method]){console[method].call(console,obj)}}}};Handlebars.log=function(level,obj){Handlebars.logger.log(level,obj)};Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse;var i=0,ret="",data;var type=toString.call(context);if(type===functionType){context=context.call(this)}if(options.data){data=Handlebars.createFrame(options.data)}if(context&&typeof context==="object"){if(context instanceof Array){for(var j=context.length;i<j;i++){if(data){data.index=i}ret=ret+fn(context[i],{data:data})}}else{for(var key in context){if(context.hasOwnProperty(key)){if(data){data.key=key}ret=ret+fn(context[key],{data:data});i++}}}}if(i===0){ret=inverse(this)}return ret});Handlebars.registerHelper("if",function(conditional,options){var type=toString.call(conditional);if(type===functionType){conditional=conditional.call(this)}if(!conditional||Handlebars.Utils.isEmpty(conditional)){return options.inverse(this)}else{return options.fn(this)}});Handlebars.registerHelper("unless",function(conditional,options){return Handlebars.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn})});Handlebars.registerHelper("with",function(context,options){var type=toString.call(context);if(type===functionType){context=context.call(this)}if(!Handlebars.Utils.isEmpty(context))return options.fn(context)});Handlebars.registerHelper("log",function(context,options){var level=options.data&&options.data.level!=null?parseInt(options.data.level,10):1;Handlebars.log(level,context)});var errorProps=["description","fileName","lineNumber","message","name","number","stack"];Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]]}};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={extend:function(obj,value){for(var key in value){if(value.hasOwnProperty(key)){obj[key]=value[key]}}},escapeExpression:function(string){if(string instanceof Handlebars.SafeString){return string.toString()}else if(string==null||string===false){return""}string=string.toString();if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)},isEmpty:function(value){if(!value&&value!==0){return true}else if(toString.call(value)==="[object Array]"&&value.length===0){return true}else{return false}}};Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];if(data){programWrapper=Handlebars.VM.program(i,fn,data)}else if(!programWrapper){programWrapper=this.programs[i]=Handlebars.VM.program(i,fn)}return programWrapper},merge:function(param,common){var ret=param||common;if(param&&common){ret={};Handlebars.Utils.extend(ret,common);Handlebars.Utils.extend(ret,param)}return ret},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(context,options){options=options||{};var result=templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data);var compilerInfo=container.compilerInfo||[],compilerRevision=compilerInfo[0]||1,currentRevision=Handlebars.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=Handlebars.REVISION_CHANGES[currentRevision],compilerVersions=Handlebars.REVISION_CHANGES[compilerRevision];throw"Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+")."}}return result}},programWithDepth:function(i,fn,data){var args=Array.prototype.slice.call(arguments,3);var program=function(context,options){options=options||{};return fn.apply(this,[context,options.data||data].concat(args))};program.program=i;program.depth=args.length;return program},program:function(i,fn,data){var program=function(context,options){options=options||{};return fn(context,options.data||data)};program.program=i;program.depth=0;return program},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){var options={helpers:helpers,partials:partials,data:data};if(partial===undefined){throw new Handlebars.Exception("The partial "+name+" could not be found")}else if(partial instanceof Function){return partial(context,options)}else if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode")}else{partials[name]=Handlebars.compile(partial,{data:data!==undefined});return partials[name](context,options)}}};Handlebars.template=Handlebars.VM.template})(Handlebars)},{}]},{},[1]);